<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>æ™ºèƒ½æŒ‡é’ˆè¯¦è§£</title>
    <url>/2020/04/01/C-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/</url>
    <content><![CDATA[<p>æ™ºèƒ½æŒ‡é’ˆåˆ†ä¸ºä¸‰ç§ï¼šshared_ptr, unique_ptr, weak_ptrã€‚æœ¬æ–‡å°±æ˜¯è¯¦ç»†ä»‹ç»ä¸€ä¸‹æ™ºèƒ½æŒ‡é’ˆï¼Œä½œä¸ºç¬”è®°ï¼Œæ–¹ä¾¿ç†è§£ã€‚</p>
<p>æ™ºèƒ½æŒ‡é’ˆçš„ä½œç”¨æ˜¯åŠ¨æ€åˆ†é…å†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<a id="more"></a>
<pre><code>PS:
å†…å­˜æ³„æ¼ï¼š
    ç¨‹åºæ²¡æœ‰é‡Šæ”¾å·²ç»ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œç”±äºè®¾è®¡é”™è¯¯ï¼Œå¯¼è‡´åœ¨é‡Šæ”¾è¯¥æ®µå†…å­˜
    ä¹‹å‰å°±å¤±å»äº†å¯¹è¯¥æ®µå†…å­˜çš„æ§åˆ¶ï¼Œå› æ­¤è¿™æ®µå†…å­˜ä¸€ç›´è¢«å ç”¨ï¼Œæ— æ³•é‡Šæ”¾ï¼Œé€ 
    æˆç©ºé—´çš„æµªè´¹ã€‚

å†…å­˜æº¢å‡ºï¼š
    è¦æ±‚åˆ†é…çš„å†…å­˜è¶…è¿‡äº†ç³»ç»Ÿæ‰€èƒ½ç»™æˆ‘çš„ï¼Œç³»ç»Ÿä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚å†…å­˜æ³„æ¼çš„å †
    ç§¯å¦‚æœä¸åŠæ—¶å¤„ç†æœ€ç»ˆä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚</code></pre><h2 id="shared-pträ»‹ç»"><a href="#shared-pträ»‹ç»" class="headerlink" title="shared_pträ»‹ç»"></a>shared_pträ»‹ç»</h2><p>shared_ptræ˜¯ä¸€ä¸ªå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼Œç”¨äºå…±äº«å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå…è®¸å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡</p>
<h3 id="shared-ptrçš„ç®€å•ä½¿ç”¨ï¼š"><a href="#shared-ptrçš„ç®€å•ä½¿ç”¨ï¼š" class="headerlink" title="shared_ptrçš„ç®€å•ä½¿ç”¨ï¼š"></a>shared_ptrçš„ç®€å•ä½¿ç”¨ï¼š</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span>  <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        Example() : e(<span class="number">1</span>) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"Example Constructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">        ~Example() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"Example Destructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> e;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;Example&gt; <span class="title">pInt</span><span class="params">(<span class="keyword">new</span> Example())</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; (*pInt).e &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"pIntå¼•ç”¨è®¡æ•°: "</span> &lt;&lt; pInt.use_count() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;Example&gt; pInt2 = pInt;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"pIntå¼•ç”¨è®¡æ•°: "</span> &lt;&lt; pInt.use_count() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"pInt2å¼•ç”¨è®¡æ•°: "</span> &lt;&lt; pInt2.use_count() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Example Constructor...</span><br><span class="line">pInt: <span class="number">1</span></span><br><span class="line">pIntå¼•ç”¨è®¡æ•°: <span class="number">1</span></span><br><span class="line">pIntå¼•ç”¨è®¡æ•°: <span class="number">2</span></span><br><span class="line">pInt2å¼•ç”¨è®¡æ•°: <span class="number">2</span></span><br><span class="line">Example Destructor...</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¹shared_ptræŒ‡é’ˆæœ‰äº†ä¸€äº›ç›´è§‚çš„äº†è§£ã€‚ä¸€æ–¹é¢ï¼Œè·ŸSTLä¸­å¤§å¤šæ•°å®¹å™¨ç±»å‹ä¸€æ ·ï¼Œshared_pträ¹Ÿæ˜¯æ¨¡æ¿ç±»ï¼Œå› æ­¤åœ¨åˆ›å»ºshared_ptræ—¶éœ€è¦æŒ‡å®šå…¶æŒ‡å‘çš„ç±»å‹ã€‚å¦ä¸€æ–¹é¢ï¼Œæ­£å¦‚å…¶åä¸€æ ·ï¼Œshared_ptræŒ‡é’ˆå…è®¸è®©å¤šä¸ªè¯¥ç±»å‹çš„æŒ‡é’ˆå…±äº«åŒä¸€å †åˆ†é…å¯¹è±¡ã€‚åŒæ—¶shared_pträ½¿ç”¨ç»å…¸çš„â€œå¼•ç”¨è®¡æ•°â€æ–¹æ³•æ¥ç®¡ç†å¯¹è±¡èµ„æºï¼Œæ¯ä¸ªshared_ptrå¯¹è±¡å…³è”ä¸€ä¸ªå…±äº«çš„å¼•ç”¨è®¡æ•°ã€‚</p>
<p>å¯¹äºshared_ptråœ¨æ‹·è´å’Œèµ‹å€¼æ—¶çš„è¡Œä¸ºï¼Œã€ŠC++Primerç¬¬äº”ç‰ˆã€‹ä¸­æœ‰è¯¦ç»†çš„æè¿°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¯ä¸ªshared_ptréƒ½æœ‰ä¸€ä¸ªå…³è”çš„è®¡æ•°å€¼ï¼Œé€šå¸¸ç§°ä¸ºå¼•ç”¨è®¡æ•°ã€‚æ— è®ºä½•æ—¶æˆ‘ä»¬æ‹·è´ä¸€ä¸ªshared_ptrï¼Œè®¡æ•°å™¨éƒ½ä¼šé€’å¢ã€‚</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼Œå½“ç”¨ä¸€ä¸ªshared_ptråˆå§‹åŒ–å¦ä¸€ä¸ªshred_ptrï¼Œæˆ–å°†å®ƒå½“åšå‚æ•°ä¼ é€’ç»™ä¸€</span><br><span class="line">ä¸ªå‡½æ•°ä»¥åŠä½œä¸ºå‡½æ•°çš„è¿”å›å€¼æ—¶ï¼Œå®ƒæ‰€å…³è”çš„è®¡æ•°å™¨å°±ä¼šé€’å¢ã€‚</span><br><span class="line"></span><br><span class="line">å½“æˆ‘ä»¬ç»™shared_ptrèµ‹äºˆä¸€ä¸ªæ–°å€¼æˆ–æ˜¯shared_ptrè¢«é”€æ¯ï¼ˆä¾‹å¦‚ä¸€ä¸ªå±€éƒ¨çš„</span><br><span class="line">shared_ptrç¦»å¼€å…¶ä½œç”¨åŸŸï¼‰æ—¶ï¼Œè®¡æ•°å™¨å°±ä¼šé€’å‡ã€‚ä¸€æ—¦ä¸€ä¸ªshared_ptrçš„è®¡æ•°</span><br><span class="line">å™¨å˜ä¸º0ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨é‡Šæ”¾è‡ªå·±æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚</span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯”æˆ‘ä»¬ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼šå½“æˆ‘ä»¬å°†ä¸€ä¸ªæŒ‡å‘Exampleå¯¹è±¡çš„æŒ‡é’ˆäº¤ç»™pIntç®¡ç†åï¼Œå…¶å…³è”çš„å¼•ç”¨è®¡æ•°ä¸º1ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨pIntåˆå§‹åŒ–pInt2ï¼Œä¸¤è€…å…³è”çš„å¼•ç”¨è®¡æ•°å€¼å¢åŠ ä¸º2ã€‚éšåï¼Œå‡½æ•°ç»“æŸï¼ŒpIntå’ŒPInt2ç›¸ç»§ç¦»å¼€å‡½æ•°ä½œç”¨äºï¼Œç›¸åº”çš„å¼•ç”¨è®¡æ•°å€¼åˆ†åˆ«è‡ªå‡1æœ€åå˜ä¸º0ï¼Œäºæ˜¯Exampleå¯¹è±¡è¢«è‡ªåŠ¨é‡Šæ”¾ï¼ˆè°ƒç”¨å…¶ææ„å‡½æ•°ï¼‰ã€‚</p>
<h3 id="shared-ptrçš„å¸¸è§ç”¨æ³•"><a href="#shared-ptrçš„å¸¸è§ç”¨æ³•" class="headerlink" title="shared_ptrçš„å¸¸è§ç”¨æ³•"></a>shared_ptrçš„å¸¸è§ç”¨æ³•</h3><h4 id="1ã€åˆ›å»ºshared-ptrå®ä¾‹"><a href="#1ã€åˆ›å»ºshared-ptrå®ä¾‹" class="headerlink" title="1ã€åˆ›å»ºshared_ptrå®ä¾‹"></a>1ã€åˆ›å»ºshared_ptrå®ä¾‹</h4><p>æœ€å®‰å…¨å’Œé«˜æ•ˆçš„æ–¹æ³•æ˜¯è°ƒç”¨make_sharedåº“å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨å †ä¸­åˆ†é…ä¸€ä¸ªå¯¹è±¡å¹¶åˆå§‹åŒ–ï¼Œæœ€åè¿”å›æŒ‡å‘æ­¤å¯¹è±¡çš„share_ptrå®ä¾‹ã€‚å¦‚æœä½ ä¸æƒ³ä½¿ç”¨make_ptrï¼Œä¹Ÿå¯ä»¥å…ˆæ˜ç¡®newå‡ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åæŠŠå…¶åŸå§‹æŒ‡é’ˆä¼ é€’ç»™share_ptrçš„æ„é€ å‡½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼ é€’ç»™make_sharedå‡½æ•°çš„å‚æ•°å¿…é¡»å’Œshared_ptræ‰€æŒ‡å‘ç±»å‹çš„æŸä¸ªæ„é€ å‡½æ•°ç›¸åŒ¹é…</span></span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;<span class="built_in">string</span>&gt; pStr = make_shared&lt;<span class="built_in">string</span>&gt;(<span class="number">10</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *pStr &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">//  aaaaaaaaaa</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *p = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt; <span class="title">pInt</span><span class="params">(p)</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *pInt &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2ã€è®¿é—®æ‰€æŒ‡å¯¹è±¡"><a href="#2ã€è®¿é—®æ‰€æŒ‡å¯¹è±¡" class="headerlink" title="2ã€è®¿é—®æ‰€æŒ‡å¯¹è±¡"></a>2ã€è®¿é—®æ‰€æŒ‡å¯¹è±¡</h4><p>shared_ptrçš„ä½¿ç”¨æ–¹å¼ä¸æ™®é€šæŒ‡é’ˆçš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼ï¼Œæ—¢å¯ä»¥ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦*è·å¾—åŸå§‹å¯¹è±¡è¿›è€Œè®¿é—®å…¶å„ä¸ªæˆå‘˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŒ‡é’ˆè®¿é—®ç¬¦-&gt;æ¥è®¿é—®åŸå§‹å¯¹è±¡çš„å„ä¸ªæˆå‘˜ã€‚</p>
<h4 id="3ã€æ‹·è´å’Œèµ‹å€¼æ“ä½œ"><a href="#3ã€æ‹·è´å’Œèµ‹å€¼æ“ä½œ" class="headerlink" title="3ã€æ‹·è´å’Œèµ‹å€¼æ“ä½œ"></a>3ã€æ‹·è´å’Œèµ‹å€¼æ“ä½œ</h4><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªshared_ptrå¯¹è±¡æ¥åˆå§‹åŒ–å¦ä¸€ä¸ªshare_ptrå®ä¾‹ï¼Œè¯¥æ“ä½œä¼šå¢åŠ å…¶å¼•ç”¨è®¡æ•°å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;<span class="built_in">string</span>&gt; pStr = make_shared&lt;<span class="built_in">string</span>&gt;(<span class="number">10</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr.use_count() &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">//  1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;<span class="built_in">string</span>&gt; <span class="title">pStr2</span><span class="params">(pStr)</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr.use_count() &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">//  2</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr2.use_count() &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">//  2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœshared_ptrå®ä¾‹på’Œå¦ä¸€ä¸ªshared_ptrå®ä¾‹qæ‰€æŒ‡å‘çš„ç±»å‹ç›¸åŒæˆ–è€…å¯ä»¥ç›¸äº’è½¬æ¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿›è¡Œè¯¸å¦‚p = qè¿™æ ·èµ‹å€¼æ“ä½œã€‚è¯¥æ“ä½œä¼šé€’å‡pçš„å¼•ç”¨è®¡æ•°å€¼ï¼Œé€’å¢qçš„å¼•ç”¨è®¡æ•°å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Example(<span class="built_in">string</span> n) : name(n) &#123; <span class="built_in">cout</span> &lt;&lt; n &lt;&lt; <span class="string">" constructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    ~Example() &#123; <span class="built_in">cout</span> &lt;&lt; name &lt;&lt; <span class="string">" destructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;Example&gt; pStr = make_shared&lt;Example&gt;(<span class="string">"a object"</span>);</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;Example&gt; pStr2 = make_shared&lt;Example&gt;(<span class="string">"b object"</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr.use_count() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr2.use_count() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    pStr = pStr2;   <span class="comment">// æ­¤åpStrå’ŒpStræŒ‡å‘ç›¸åŒå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr-&gt;name &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr2-&gt;name &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">a object constructor...</span><br><span class="line">b object constructor...</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">a object destructor...</span><br><span class="line">b object</span><br><span class="line">b object</span><br><span class="line">b object destructor...</span><br></pre></td></tr></table></figure>

<h4 id="4ã€æ£€æŸ¥å¼•ç”¨è®¡æ•°"><a href="#4ã€æ£€æŸ¥å¼•ç”¨è®¡æ•°" class="headerlink" title="4ã€æ£€æŸ¥å¼•ç”¨è®¡æ•°"></a>4ã€æ£€æŸ¥å¼•ç”¨è®¡æ•°</h4><p>shared_ptræä¾›äº†ä¸¤ä¸ªå‡½æ•°æ¥æ£€æŸ¥å…¶å…±äº«çš„å¼•ç”¨è®¡æ•°å€¼ï¼Œåˆ†åˆ«æ˜¯unique()å’Œuse_count()ã€‚</p>
<p>åœ¨å‰é¢ï¼Œæˆ‘ä»¬å·²ç»å¤šæ¬¡ä½¿ç”¨è¿‡use_count()å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›å½“å‰æŒ‡é’ˆçš„å¼•ç”¨è®¡æ•°å€¼ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯use_count()å‡½æ•°å¯èƒ½æ•ˆç‡å¾ˆä½ï¼Œåº”è¯¥åªæŠŠå®ƒç”¨äºæµ‹è¯•æˆ–è°ƒè¯•ã€‚</p>
<p>unique()å‡½æ•°ç”¨æ¥æµ‹è¯•è¯¥shared_ptræ˜¯å¦æ˜¯åŸå§‹æŒ‡é’ˆå”¯ä¸€æ‹¥æœ‰è€…ï¼Œä¹Ÿå°±æ˜¯use_count()çš„è¿”å›å€¼ä¸º1æ—¶è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;<span class="built_in">string</span>&gt; pStr = make_shared&lt;<span class="built_in">string</span>&gt;(<span class="number">10</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr.unique() &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;<span class="built_in">string</span>&gt; <span class="title">pStr2</span><span class="params">(pStr)</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; pStr2.unique() &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// false;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="weak-pträ»‹ç»"><a href="#weak-pträ»‹ç»" class="headerlink" title="weak_pträ»‹ç»"></a>weak_pträ»‹ç»</h2><p>åœ¨æ­£å¼ä»‹ç»weak_pträ¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å›å¿†ä¸€ä¸‹shared_ptrçš„ä¸€äº›çŸ¥è¯†ã€‚æˆ‘ä»¬çŸ¥é“shared_ptræ˜¯é‡‡ç”¨å¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå¤šä¸ªshared_ptrå®ä¾‹å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªåŠ¨æ€å¯¹è±¡ï¼Œå¹¶ç»´æŠ¤äº†ä¸€ä¸ªå…±äº«çš„å¼•ç”¨è®¡æ•°å™¨ã€‚å¯¹äºå¼•ç”¨è®¡æ•°æ³•å®ç°çš„è®¡æ•°ï¼Œæ€»æ˜¯é¿å…ä¸äº†å¾ªç¯å¼•ç”¨ï¼ˆæˆ–ç¯å½¢å¼•ç”¨ï¼‰çš„é—®é¢˜ï¼Œshared_pträ¹Ÿä¸ä¾‹å¤–ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassB</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassA</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ClassA() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"ClassA Constructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    ~ClassA() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"ClassA Destructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;ClassB&gt; pb;  <span class="comment">// åœ¨Aä¸­å¼•ç”¨B</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassB</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ClassB() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"ClassB Constructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    ~ClassB() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"ClassB Destructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;ClassA&gt; pa;  <span class="comment">// åœ¨Bä¸­å¼•ç”¨A</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;ClassA&gt; spa = make_shared&lt;ClassA&gt;();</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;ClassB&gt; spb = make_shared&lt;ClassB&gt;();</span><br><span class="line">    spa-&gt;pb = spb;</span><br><span class="line">    spb-&gt;pa = spa;</span><br><span class="line">    <span class="comment">// å‡½æ•°ç»“æŸï¼Œæ€è€ƒä¸€ä¸‹ï¼šspaå’Œspbä¼šé‡Šæ”¾èµ„æºä¹ˆï¼Ÿ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">ClassA Constructor...</span><br><span class="line">ClassB Constructor...</span><br><span class="line">Program ended with <span class="built_in">exit</span> code: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢ä»£ç ä¸­ï¼ŒClassAå’ŒClassBé—´å­˜åœ¨ç€å¾ªç¯å¼•ç”¨ï¼Œä»è¿è¡Œç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šå½“mainå‡½æ•°è¿è¡Œç»“æŸåï¼Œspaå’Œspbç®¡ç†çš„åŠ¨æ€èµ„æºå¹¶æ²¡æœ‰å¾—åˆ°é‡Šæ”¾ï¼Œäº§ç”Ÿäº†å†…å­˜æ³„æ¼ã€‚</p>
<p>ä¸ºäº†è§£å†³ç±»ä¼¼è¿™æ ·çš„é—®é¢˜ï¼ŒC++11å¼•å…¥äº†weak_ptrï¼Œæ¥æ‰“ç ´è¿™ç§å¾ªç¯å¼•ç”¨ã€‚</p>
<p>weak_ptræ˜¯ä¸ºäº†é…åˆshared_ptrè€Œå¼•å…¥çš„ä¸€ç§æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªç”±shared_ptrç®¡ç†çš„å¯¹è±¡è€Œä¸å½±å“æ‰€æŒ‡å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯å°†ä¸€ä¸ªweak_ptrç»‘å®šåˆ°ä¸€ä¸ªshared_pträ¸ä¼šæ”¹å˜shared_ptrçš„å¼•ç”¨è®¡æ•°ã€‚ä¸è®ºæ˜¯å¦æœ‰weak_ptræŒ‡å‘ï¼Œä¸€æ—¦æœ€åä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„shared_ptrè¢«é”€æ¯ï¼Œå¯¹è±¡å°±ä¼šè¢«é‡Šæ”¾ã€‚</p>
<h3 id="weak-ptrç”¨æ³•"><a href="#weak-ptrç”¨æ³•" class="headerlink" title="weak_ptrç”¨æ³•"></a>weak_ptrç”¨æ³•</h3><h4 id="1ã€åˆ›å»ºweak-ptrå®ä¾‹"><a href="#1ã€åˆ›å»ºweak-ptrå®ä¾‹" class="headerlink" title="1ã€åˆ›å»ºweak_ptrå®ä¾‹"></a>1ã€åˆ›å»ºweak_ptrå®ä¾‹</h4><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªweak_ptræ—¶ï¼Œéœ€è¦ç”¨ä¸€ä¸ªshared_ptrå®ä¾‹æ¥åˆå§‹åŒ–weak_ptrï¼Œç”±äºæ˜¯å¼±å…±äº«ï¼Œweak_ptrçš„åˆ›å»ºå¹¶ä¸ä¼šå½±å“shared_ptrçš„å¼•ç”¨è®¡æ•°å€¼ã€‚</p>
<p>ç¤ºä¾‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt; <span class="title">sp</span><span class="params">(<span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">5</span>))</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"åˆ›å»ºå‰spçš„å¼•ç”¨è®¡æ•°ï¼š"</span> &lt;&lt; sp.use_count() &lt;&lt; <span class="built_in">endl</span>;    <span class="comment">// use_count = 1</span></span><br><span class="line"></span><br><span class="line">    <span class="function">weak_ptr&lt;<span class="keyword">int</span>&gt; <span class="title">wp</span><span class="params">(sp)</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"åˆ›å»ºåspçš„å¼•ç”¨è®¡æ•°ï¼š"</span> &lt;&lt; sp.use_count() &lt;&lt; <span class="built_in">endl</span>;    <span class="comment">// use_count = 1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2ã€åˆ¤æ–­weak-ptræŒ‡å‘å¯¹è±¡æ˜¯å¦å­˜åœ¨"><a href="#2ã€åˆ¤æ–­weak-ptræŒ‡å‘å¯¹è±¡æ˜¯å¦å­˜åœ¨" class="headerlink" title="2ã€åˆ¤æ–­weak_ptræŒ‡å‘å¯¹è±¡æ˜¯å¦å­˜åœ¨"></a>2ã€åˆ¤æ–­weak_ptræŒ‡å‘å¯¹è±¡æ˜¯å¦å­˜åœ¨</h4><p>æ—¢ç„¶weak_ptrå¹¶ä¸æ”¹å˜å…¶æ‰€å…±äº«çš„shared_ptrå®ä¾‹çš„å¼•ç”¨è®¡æ•°ï¼Œé‚£å°±å¯èƒ½å­˜åœ¨weak_ptræŒ‡å‘çš„å¯¹è±¡è¢«é‡Šæ”¾æ‰è¿™ç§æƒ…å†µã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨weak_ptrç›´æ¥è®¿é—®å¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åˆ¤æ–­weak_ptræŒ‡å‘å¯¹è±¡æ˜¯å¦å­˜åœ¨å‘¢ï¼ŸC++ä¸­æä¾›äº†lockå‡½æ•°æ¥å®ç°è¯¥åŠŸèƒ½ã€‚å¦‚æœå¯¹è±¡å­˜åœ¨ï¼Œlock()å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘å…±äº«å¯¹è±¡çš„shared_ptrï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºshared_ptrã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() : a(<span class="number">3</span>) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"A Constructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"A Destructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;A&gt; <span class="title">sp</span><span class="params">(<span class="keyword">new</span> A())</span></span>;</span><br><span class="line">    <span class="function">weak_ptr&lt;A&gt; <span class="title">wp</span><span class="params">(sp)</span></span>;</span><br><span class="line">    <span class="comment">//sp.reset();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">shared_ptr</span>&lt;A&gt; pa = wp.lock())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; pa-&gt;a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"wpæŒ‡å‘å¯¹è±¡ä¸ºç©º"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæŠŠsp.reset()è¿™è¡Œçš„æ³¨é‡Šå»æ‰ä¼šå¯¼è‡´wpæŒ‡å‘å¯¹è±¡ä¸ºç©ºã€‚</p>
<p>weak_ptrè¿˜æä¾›äº†expired()å‡½æ•°æ¥åˆ¤æ–­æ‰€æŒ‡å¯¹è±¡æ˜¯å¦å·²ç»è¢«é”€æ¯ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() : a(<span class="number">3</span>) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"A Constructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"A Destructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;A&gt; <span class="title">sp</span><span class="params">(<span class="keyword">new</span> A())</span></span>;</span><br><span class="line">    <span class="function">weak_ptr&lt;A&gt; <span class="title">wp</span><span class="params">(sp)</span></span>;</span><br><span class="line">    sp.reset(); <span class="comment">// æ­¤æ—¶spè¢«é”€æ¯</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; wp.expired() &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// trueè¡¨ç¤ºå·²è¢«é”€æ¯ï¼Œå¦åˆ™ä¸ºfalse</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">A Constructor...</span><br><span class="line">A Destructor...</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="3ã€å…·ä½“ä½¿ç”¨weak-ptr"><a href="#3ã€å…·ä½“ä½¿ç”¨weak-ptr" class="headerlink" title="3ã€å…·ä½“ä½¿ç”¨weak_ptr"></a>3ã€å…·ä½“ä½¿ç”¨weak_ptr</h4><p>weak_ptrå¹¶æ²¡æœ‰é‡è½½operator-&gt;å’Œoperator *æ“ä½œç¬¦ï¼Œå› æ­¤ä¸å¯ç›´æ¥é€šè¿‡weak_pträ½¿ç”¨å¯¹è±¡ï¼Œå…¸å‹çš„ç”¨æ³•æ˜¯è°ƒç”¨å…¶lockå‡½æ•°æ¥è·å¾—shared_ptrç¤ºä¾‹ï¼Œè¿›è€Œè®¿é—®åŸå§‹å¯¹è±¡.</p>
<p>ä¸‹é¢ä½¿ç”¨weak_ptræ¥æ”¹é€ æœ€å‰é¢çš„ä»£ç ï¼Œæ‰“ç ´å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassB</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassA</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ClassA() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"ClassA Constructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    ~ClassA() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"ClassA Destructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    weak_ptr&lt;ClassB&gt; pb;  <span class="comment">// åœ¨Aä¸­å¼•ç”¨B</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassB</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ClassB() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"ClassB Constructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    ~ClassB() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"ClassB Destructor..."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    weak_ptr&lt;ClassA&gt; pa;  <span class="comment">// åœ¨Bä¸­å¼•ç”¨A</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;ClassA&gt; spa = make_shared&lt;ClassA&gt;();</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;ClassB&gt; spb = make_shared&lt;ClassB&gt;();</span><br><span class="line">    spa-&gt;pb = spb;</span><br><span class="line">    spb-&gt;pa = spa;</span><br><span class="line">    <span class="comment">// å‡½æ•°ç»“æŸï¼Œæ€è€ƒä¸€ä¸‹ï¼šspaå’Œspbä¼šé‡Šæ”¾èµ„æºä¹ˆï¼Ÿ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»è¿è¡Œç»“æœå¯ä»¥çœ‹åˆ°spaå’ŒspbæŒ‡å‘çš„å¯¹è±¡éƒ½å¾—åˆ°é‡Šæ”¾ã€‚</p>
<h2 id="unique-pträ»‹ç»"><a href="#unique-pträ»‹ç»" class="headerlink" title="unique_pträ»‹ç»"></a>unique_pträ»‹ç»</h2><p>uniqueæ˜¯ç‹¬ç‰¹çš„ã€å”¯ä¸€çš„æ„æ€ï¼Œæ•…åæ€è®®ï¼Œunique_ptrå¯ä»¥â€œç‹¬å â€åœ°æ‹¥æœ‰å®ƒæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œå®ƒæä¾›ä¸€ç§ä¸¥æ ¼æ„ä¹‰ä¸Šçš„æ‰€æœ‰æƒã€‚è¿™ä¸€ç‚¹å’Œæˆ‘ä»¬å‰é¢ä»‹ç»çš„shared_ptrç±»å‹æŒ‡é’ˆæœ‰å¾ˆå¤§çš„ä¸åŒï¼šshared_ptrå…è®¸å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€å¯¹è±¡ï¼Œè€Œunique_ptråœ¨æŸä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¯¥å¯¹è±¡ã€‚unique_pträ¿å­˜æŒ‡å‘æŸä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼Œå½“å®ƒæœ¬èº«è¢«åˆ é™¤æˆ–è€…ç¦»å¼€å…¶ä½œç”¨åŸŸæ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾å…¶æŒ‡å‘å¯¹è±¡æ‰€å ç”¨çš„èµ„æºã€‚</p>
<p>ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ª unique_ptr å®ä¾‹ä¹‹é—´çš„æ‰€æœ‰æƒè½¬æ¢ã€‚</p>
<p><img src="/2020/04/01/C-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/unique_ptr.png" alt></p>
<h3 id="unique-ptrçš„åŸºæœ¬ç‰¹æ€§"><a href="#unique-ptrçš„åŸºæœ¬ç‰¹æ€§" class="headerlink" title="unique_ptrçš„åŸºæœ¬ç‰¹æ€§"></a>unique_ptrçš„åŸºæœ¬ç‰¹æ€§</h3><h4 id="1ã€åˆ›å»ºunique-ptr"><a href="#1ã€åˆ›å»ºunique-ptr" class="headerlink" title="1ã€åˆ›å»ºunique_ptr"></a>1ã€åˆ›å»ºunique_ptr</h4><p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªunique_ptrå®ä¾‹</span></span><br><span class="line">    <span class="comment">// unique_ptr&lt;int&gt; pInt(new int(5));</span></span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; pInt = make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *pInt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2ã€æ— æ³•è¿›è¡Œå¤åˆ¶æ„é€ å’Œèµ‹å€¼æ“ä½œ"><a href="#2ã€æ— æ³•è¿›è¡Œå¤åˆ¶æ„é€ å’Œèµ‹å€¼æ“ä½œ" class="headerlink" title="2ã€æ— æ³•è¿›è¡Œå¤åˆ¶æ„é€ å’Œèµ‹å€¼æ“ä½œ"></a>2ã€æ— æ³•è¿›è¡Œå¤åˆ¶æ„é€ å’Œèµ‹å€¼æ“ä½œ</h4><p>unique_ptræ²¡æœ‰copyæ„é€ å‡½æ•°ï¼Œä¸æ”¯æŒæ™®é€šçš„æ‹·è´å’Œèµ‹å€¼æ“ä½œã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªunique_ptrå®ä¾‹</span></span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; pInt = make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">5</span>);</span><br><span class="line">    <span class="function"><span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; <span class="title">pInt2</span><span class="params">(pInt)</span></span>;    <span class="comment">// æŠ¥é”™</span></span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; pInt3 = pInt;   <span class="comment">// æŠ¥é”™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3ã€å¯ä»¥è¿›è¡Œç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼æ“ä½œ"><a href="#3ã€å¯ä»¥è¿›è¡Œç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼æ“ä½œ" class="headerlink" title="3ã€å¯ä»¥è¿›è¡Œç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼æ“ä½œ"></a>3ã€å¯ä»¥è¿›è¡Œç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼æ“ä½œ</h4><p>unique_ptrè™½ç„¶æ²¡æœ‰æ”¯æŒæ™®é€šçš„æ‹·è´å’Œèµ‹å€¼æ“ä½œï¼Œä½†å´æä¾›äº†ä¸€ç§ç§»åŠ¨æœºåˆ¶æ¥å°†æŒ‡é’ˆçš„æ‰€æœ‰æƒä»ä¸€ä¸ªunique_ptrè½¬ç§»ç»™å¦ä¸€ä¸ªunique_ptrã€‚å¦‚æœéœ€è¦è½¬ç§»æ‰€æœ‰æƒï¼Œå¯ä»¥ä½¿ç”¨std::move()å‡½æ•°ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; pInt = make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; pInt2 = <span class="built_in">std</span>::<span class="built_in">move</span>(pInt);    <span class="comment">// è½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line">    <span class="comment">//cout &lt;&lt; *pInt &lt;&lt; endl; // å‡ºé”™ï¼ŒpIntä¸ºç©º</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *pInt2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="function"><span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; <span class="title">pInt3</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">move</span>(pInt2))</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4ã€å¯ä»¥è¿”å›unique-ptr"><a href="#4ã€å¯ä»¥è¿”å›unique-ptr" class="headerlink" title="4ã€å¯ä»¥è¿”å›unique_ptr"></a>4ã€å¯ä»¥è¿”å›unique_ptr</h4><p>unique_pträ¸æ”¯æŒæ‹·è´æ“ä½œï¼Œä½†å´æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šå¯ä»¥ä»å‡½æ•°ä¸­è¿”å›ä¸€ä¸ªunique_ptrã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; <span class="title">clone</span><span class="params">(<span class="keyword">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; pInt = make_unique&lt;<span class="keyword">int</span>&gt;(p);</span><br><span class="line">    <span class="keyword">return</span> pInt;    <span class="comment">// è¿”å›unique_ptr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; ret = clone(p);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *ret &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="unique-pträ½¿ç”¨åœºæ™¯"><a href="#unique-pträ½¿ç”¨åœºæ™¯" class="headerlink" title="unique_pträ½¿ç”¨åœºæ™¯"></a>unique_pträ½¿ç”¨åœºæ™¯</h3><h4 id="1ã€ä¸ºåŠ¨æ€ç”³è¯·çš„èµ„æºæä¾›å¼‚å¸¸å®‰å…¨ä¿è¯"><a href="#1ã€ä¸ºåŠ¨æ€ç”³è¯·çš„èµ„æºæä¾›å¼‚å¸¸å®‰å…¨ä¿è¯" class="headerlink" title="1ã€ä¸ºåŠ¨æ€ç”³è¯·çš„èµ„æºæä¾›å¼‚å¸¸å®‰å…¨ä¿è¯"></a>1ã€ä¸ºåŠ¨æ€ç”³è¯·çš„èµ„æºæä¾›å¼‚å¸¸å®‰å…¨ä¿è¯</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *p = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...ï¼ˆå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æˆ‘ä»¬ä¼ ç»Ÿçš„å†™æ³•ï¼šå½“æˆ‘ä»¬åŠ¨æ€ç”³è¯·å†…å­˜åï¼Œæœ‰å¯èƒ½æˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»£ç ç”±äºæŠ›å‡ºå¼‚å¸¸æˆ–è€…æå‰é€€å‡ºï¼ˆifè¯­å¥ï¼‰è€Œæ²¡æœ‰æ‰§è¡Œdeleteæ“ä½œã€‚</p>
<p>è§£å†³çš„æ–¹æ³•æ˜¯ä½¿ç”¨unique_ptræ¥ç®¡ç†åŠ¨æ€å†…å­˜ï¼Œåªè¦unique_ptræŒ‡é’ˆåˆ›å»ºæˆåŠŸï¼Œå…¶ææ„å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚ç¡®ä¿åŠ¨æ€èµ„æºè¢«é‡Šæ”¾ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; pInt = make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...ï¼ˆå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2ã€è¿”å›å‡½æ•°å†…åŠ¨æ€ç”³è¯·èµ„æºçš„æ‰€æœ‰æƒ"><a href="#2ã€è¿”å›å‡½æ•°å†…åŠ¨æ€ç”³è¯·èµ„æºçš„æ‰€æœ‰æƒ" class="headerlink" title="2ã€è¿”å›å‡½æ•°å†…åŠ¨æ€ç”³è¯·èµ„æºçš„æ‰€æœ‰æƒ"></a>2ã€è¿”å›å‡½æ•°å†…åŠ¨æ€ç”³è¯·èµ„æºçš„æ‰€æœ‰æƒ</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; <span class="title">Func</span><span class="params">(<span class="keyword">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; pInt = make_unique&lt;<span class="keyword">int</span>&gt;(p);</span><br><span class="line">    <span class="keyword">return</span> pInt;    <span class="comment">// è¿”å›unique_ptr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; ret = Func(p);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *ret &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// å‡½æ•°ç»“æŸåï¼Œè‡ªåŠ¨é‡Šæ”¾èµ„æº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3ã€åœ¨å®¹å™¨ä¸­ä¿å­˜æŒ‡é’ˆ"><a href="#3ã€åœ¨å®¹å™¨ä¸­ä¿å­˜æŒ‡é’ˆ" class="headerlink" title="3ã€åœ¨å®¹å™¨ä¸­ä¿å­˜æŒ‡é’ˆ"></a>3ã€åœ¨å®¹å™¨ä¸­ä¿å­˜æŒ‡é’ˆ</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt;&gt; vec;</span><br><span class="line">    <span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; p= make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">5</span>);</span><br><span class="line">    vec.push_back(<span class="built_in">std</span>::<span class="built_in">move</span>(p));    <span class="comment">// ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4ã€ç®¡ç†åŠ¨æ€æ•°ç»„"><a href="#4ã€ç®¡ç†åŠ¨æ€æ•°ç»„" class="headerlink" title="4ã€ç®¡ç†åŠ¨æ€æ•°ç»„"></a>4ã€ç®¡ç†åŠ¨æ€æ•°ç»„</h4><p>æ ‡å‡†åº“æä¾›äº†ä¸€ä¸ªå¯ä»¥ç®¡ç†åŠ¨æ€æ•°ç»„çš„unique_ptrç‰ˆæœ¬ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨make_uniqueæ¥åˆ›å»ºä¸€ä¸ªåˆ°æ•°ç»„çš„ unique_ptrï¼Œä½†ä¸èƒ½ä½¿ç”¨ make_unique æ¥åˆå§‹åŒ–æ•°ç»„å…ƒç´ </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// unique_ptr&lt;int[]&gt; p(new int[5] &#123;1, 2, 3, 4, 5&#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a unique_ptr to an array of 5 integers.</span></span><br><span class="line">    <span class="keyword">auto</span> p = make_unique&lt;<span class="keyword">int</span>[]&gt;(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize the array.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        p[i] = i;</span><br><span class="line">        wcout &lt;&lt; p[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    p[<span class="number">0</span>] = <span class="number">0</span>;   <span class="comment">// é‡è½½äº†operator[]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5ã€ä½œä¸ºauto-ptrçš„æ›¿ä»£å“"><a href="#5ã€ä½œä¸ºauto-ptrçš„æ›¿ä»£å“" class="headerlink" title="5ã€ä½œä¸ºauto_ptrçš„æ›¿ä»£å“"></a>5ã€ä½œä¸ºauto_ptrçš„æ›¿ä»£å“</h4>]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯­éŸ³è¯†åˆ«</title>
    <url>/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/</url>
    <content><![CDATA[<p>æ•´ä¸ªè¯­éŸ³è¯†åˆ«ç³»ç»Ÿä¸»è¦æ„æˆæœ‰å››ä¸ªéƒ¨åˆ†ï¼šè¯­éŸ³ä¿¡å·å¤„ç†å’Œç‰¹å¾çš„æå–æ¨¡å—ï¼›è¯­éŸ³è¯†åˆ«çš„å£°å­¦æ¨¡å‹ï¼›è¯­éŸ³è¯†åˆ«çš„è¯­è¨€æ¨¡å‹ï¼›è¯­éŸ³è¯†åˆ«çš„è§£ç å’Œæœç´¢éƒ¨åˆ†ã€‚ç³»ç»Ÿæµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/1.png" alt></p>
<a id="more"></a>
<p>æ•´ä¸ªè¯­éŸ³è¯†åˆ«çš„è¿‡ç¨‹å¯ä»¥ç”¨è´å¶æ–¯ç†è®ºæ¥æè¿°ï¼Œå‡è®¾è¾“å…¥çš„éŸ³é¢‘åºåˆ—ä¸º$O={o_{1}, o_{2}, \cdots, o_{n}}$ï¼Œè¾“å‡ºä¸ºæ–‡æœ¬åºåˆ—ä¸º$W={w_{1}, w_{2}, \cdots, w_{n}}$ã€‚ç›®çš„æ˜¯æ„å»ºä¸€ä¸ªæ¨¡å‹ï¼Œä½¿å¾—$\prod_{n} P\left(W_{n} | O_{n}\right)$æœ€å¤§ï¼Œä¹Ÿå°±æ˜¯è®­ç»ƒé›†ä¸­nä¸ªæ ·æœ¬çš„åéªŒæ¦‚ç‡æœ€å¤§ã€‚å•ç‹¬æ‹¿å‡ºä¸€ä¸ªæ ·æœ¬çš„åéªŒæ¦‚ç‡ä½¿ç”¨è´å¶æ–¯å…¬å¼å¯ä»¥å¾—åˆ°ï¼š</p>
<p>$$P(W | O)=\frac{P(O | W) * P(W)}{P(O)}$$</p>
<p>è¿›ä¸€æ­¥å¯å¾—:</p>
<p>$$W^{*}=\operatorname{argmax}_{W} P(O | W) * P(W)$$</p>
<p>è¿™é‡Œ$P(W)$æ˜¯è¾“å‡ºè¯åºåˆ—çš„æ¦‚ç‡ï¼Œç”¨è¯­è¨€æ¨¡å‹æ¥åˆ»ç”»ï¼Œ$P(O | W)$ä¸ºä¼¼ç„¶æ¦‚ç‡ï¼Œä½¿ç”¨å£°å­¦æ¨¡å‹æ¥è¡¨è¾¾ã€‚</p>
<h3 id="æ•°æ®é›†æ„å»º"><a href="#æ•°æ®é›†æ„å»º" class="headerlink" title="æ•°æ®é›†æ„å»º"></a>æ•°æ®é›†æ„å»º</h3><p>è¯­éŸ³æ•°æ®æ„å»ºä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼Œä¸€æ˜¯å…¬å¼€æ•°æ®é›†â€”&gt;æ—¥å¸¸å¯¹è¯ï¼ŒäºŒæ˜¯ç‰¹å®šæ•°æ®é›†â€”&gt;æ§åˆ¶å‘½ä»¤ã€‚</p>
<p>æ‰€æœé›†çš„å…¬å¼€è¯­éŸ³æ•°æ®é›†æ˜¯<a href="http://www.openslr.org/18/" target="_blank" rel="noopener external nofollow noreferrer">THCHS30</a>ã€<a href="http://cn-mirror.openslr.org/resources/38/ST-CMDS-20170001_1-OS.tar.gz" target="_blank" rel="noopener external nofollow noreferrer">ST-CMDS</a>ã€<a href="http://cn-mirror.openslr.org/resources/33/data_aishell.tgz" target="_blank" rel="noopener external nofollow noreferrer">AIShell</a>ç­‰æ•°æ®é›†ï¼Œè¿™å‡ ä¸ªæ•°æ®é›†æ˜¯ä¸­æ–‡è¯­éŸ³æ•°æ®é›†ï¼ŒåŸºæœ¬æ•°æ®æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/2.png" alt></p>
<p>åŸºæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/3.png" alt></p>
<p>é’ˆå¯¹å®é™…çš„å·¥ä¸šæ§åˆ¶å‘½ä»¤ï¼Œæˆ‘ä»¬è¿›è¡Œä¸“é—¨çš„è¯­éŸ³é‡‡é›†å’Œå½•åˆ¶ã€‚ç¯å¢ƒæ˜¯å’Œå®é™…çš„æ³µç«™æ§åˆ¶å®¤ä¸€è‡´ï¼Œå®‰é™ã€è¿‘åœºã€‚è¿™é‡Œä½¿ç”¨å•ç²’éº¦å…‹é£è¿›è¡Œå½•åˆ¶ï¼Œå½•åˆ¶çš„æ ¼å¼ä¸ä¸Šè¾¹æ ¼å¼ä¸€è‡´ã€‚</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/4.png" alt></p>
<h3 id="è¯­éŸ³ä¿¡å·é¢„å¤„ç†"><a href="#è¯­éŸ³ä¿¡å·é¢„å¤„ç†" class="headerlink" title="è¯­éŸ³ä¿¡å·é¢„å¤„ç†"></a>è¯­éŸ³ä¿¡å·é¢„å¤„ç†</h3><p>è¯­éŸ³ä¿¡å·é¢„å¤„ç†æ˜¯ä¸ºäº†å°†åŸå§‹è¯­éŸ³ä¿¡å·è½¬æ¢æˆCNNç½‘ç»œè¾“å…¥çš„è¯­è°±å›¾ã€‚CNNçš„è¾“å…¥å±‚æ˜¯200ç»´çš„ç‰¹å¾å€¼åºåˆ—ã€‚è¾“å‡ºæ‹¼éŸ³çš„è¡¨ç¤ºå¤§å°æ˜¯1422ï¼Œå³1421ä¸ªæ‹¼éŸ³+1ä¸ªç©ºç™½å—ã€‚é¢„æµ‹ç»“æœæ˜¯è¿”å›è¯­éŸ³è¯†åˆ«åçš„æ‹¼éŸ³ç¬¦å·åˆ—è¡¨ã€‚</p>
<p>è¯­éŸ³ä¿¡å·çš„é¢„å¤„ç†è¿‡ç¨‹ç”¨åˆ°çš„æŠ€æœ¯æ˜¯ï¼šé¢„åŠ é‡ï¼ˆpre-emphasisï¼‰ã€<br>åˆ†å¸§ï¼ˆenframingï¼‰ã€åŠ çª—ï¼ˆwindowing)</p>
<h4 id="é¢„åŠ é‡"><a href="#é¢„åŠ é‡" class="headerlink" title="é¢„åŠ é‡"></a>é¢„åŠ é‡</h4><p>é¢„åŠ é‡å¯ä»¥ä½¿å¾—è¯­éŸ³ä¿¡å·çš„é¢‘è°±ä¿¡å·åˆ†å¸ƒæ›´åŠ å‡è¡¡ã€‚é¢„åŠ é‡ä¸€èˆ¬æ˜¯ç”¨<br>60db/octaveæ•°å­—æ»¤æ³¢å™¨é¢‘ç‡ç‰¹æ€§å®Œæˆçš„ã€‚è¿‡æ»¤å™¨å…¬å¼ç»™å‡ºï¼š</p>
<p>$$H(z)=1-u z^{-1}$$</p>
<p>å…¶ä¸­$u$æ˜¯é¢„åŠ é‡ç³»æ•°ã€‚</p>
<h4 id="åˆ†å¸§"><a href="#åˆ†å¸§" class="headerlink" title="åˆ†å¸§"></a>åˆ†å¸§</h4><p>ä½¿ç”¨é¢„å…ˆè®¾è®¡å¥½çš„çª—å‡½æ•°å¤„ç†è¢«åˆ†å¸§åˆ†æˆçš„å¤šä¸ªå°ç‰‡æ®µã€‚é€šè¿‡è¿™ç§æ–¹æ³•åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³è¯­éŸ³ä¿¡å·å¸§ä¿¡å·ä¹‹é—´çš„ä¸è¿ç»­æ€§é—®é¢˜ã€‚æ¯ä¸€ä¸ªå°æ®µä½œä¸ºè¯­éŸ³ä¿¡çš„å•ä½ï¼Œç§°ä¸ºå¸§ï¼ˆframeï¼‰ã€‚ä»¥å¸§ä¸ºå•ä½å¯ä»¥åˆ†æè¯­éŸ³ä¿¡å·çš„çŸ­æ—¶ç‰¹æ€§ï¼Œä»è€Œè¿›ä¸€æ­¥è¿›è¡Œé¢‘è°±ç­‰å¤„ç†ã€‚åˆ†å¸§ä¸€èˆ¬ç›¸é‚»å¸§ä¹‹é—´æœ‰äº¤å‰é‡å ï¼Œäº¤å‰éƒ¨åˆ†å«åšå¸§ç§»ï¼Œå¸§ç§»ä¸€èˆ¬å®šä¸ºå¸§é•¿åº¦çš„ä¸€åŠã€‚</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/5.png" alt></p>
<h4 id="åŠ çª—"><a href="#åŠ çª—" class="headerlink" title="åŠ çª—"></a>åŠ çª—</h4><p>å¯¹è¯­éŸ³ä¿¡å·å¢åŠ ä¸€ä¸ªçª—å‡½æ•°ï¼ˆWindow Functionï¼‰ï¼Œåœ¨è¯­éŸ³ä¿¡å·çš„ç»™å®šåŒºé—´å†…é™å®šä¸ºä¸€ä¸ªå®æ•°ï¼Œå…¶å®ƒéƒ¨åˆ†ä¸º0ã€‚ä½¿ç”¨çš„æ˜¯æ±‰æ˜çª—ï¼ˆHamming Windowï¼‰æ±‰æ˜çª—çš„æ—¶é—´åŸŸè¡¨è¾¾ç»™å‡º:</p>
<p>$$w(n)=0.54-0.46 \cos \left(\frac{2 \pi n}{N-1}\right)$$</p>
<p>å…¶ä¸­$ğ‘›$æ˜¯æ—¶é—´ï¼Œ$w(n)$æ˜¯çª—å‡½æ•°ã€‚</p>
<h4 id="è¯­è°±å›¾ç‰¹å¾æå–"><a href="#è¯­è°±å›¾ç‰¹å¾æå–" class="headerlink" title="è¯­è°±å›¾ç‰¹å¾æå–"></a>è¯­è°±å›¾ç‰¹å¾æå–</h4><p>è¯­è°±å›¾ï¼ˆSpectrogramï¼‰æ˜¯è¯­éŸ³å¤„ç†çš„ä¸€ä¸ªé‡è¦ç‰¹å¾ï¼Œæ˜¯ä¸€ç§æè¿°è¯­éŸ³ä¿¡å·çš„å„ä¸ªé¢‘ç‡æˆåˆ†éšç€æ—¶é—´å˜æ¢çš„çƒ­åŠ›å›¾ã€‚</p>
<p>è¯­è°±å›¾åŒ…å«ç€è¯­éŸ³ä¿¡å·çš„é‡è¦ä¿¡æ¯ï¼Œç”¨ä¸€ä¸ªäºŒç»´çŸ©é˜µè¡¨ç¤ºã€‚å…¶ä¸­ä¸€ä¸ªè½´è¡¨ç¤ºæ—¶é—´ï¼Œå¦å¤–ä¸€ä¸ªè½´è¡¨ç¤ºé¢‘ç‡ã€‚ä¸åŒçš„ç‚¹æˆ–è€…é¢œè‰²ä»£è¡¨å¯¹åº”è¯­éŸ³ä¿¡å·èƒ½é‡çš„å¤§å°ã€‚</p>
<p>è¯­è°±å›¾çš„æå–è¿‡ç¨‹ä¸€èˆ¬åŒ…æ‹¬ï¼šé‡‡æ ·ã€å‚…ç«‹å¶å˜æ¢ã€è¿ç»­æ‹¼æ¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/6.jpg" alt></p>
<p>åŸå§‹è¯­éŸ³ä¿¡å·æ˜¯ç¬¦åˆæ•°æ®æ ¼å¼çš„åç¼€æ˜¯.wav çš„åŸå§‹è¯­éŸ³æ•°æ®ã€‚è¿™é‡Œå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¯»å–è¯¥åŸå§‹è¯­éŸ³æ•°æ®ï¼Œè¿”å›å£°éŸ³ä¿¡å·çš„æ—¶åŸŸè°±çŸ©é˜µå’Œå¸§é€Ÿç‡ã€‚å…·ä½“å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">ä¸€äº›é€šç”¨å‡½æ•°ï¼Œå¦‚wavæ–‡ä»¶è¯»å–ã€ä¿¡å·å‡ºæ¥å’Œæµ‹è¯•ä»£ç </span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt  </span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> python_speech_features <span class="keyword">import</span> mfcc</span><br><span class="line"><span class="keyword">from</span> python_speech_features <span class="keyword">import</span> delta</span><br><span class="line"><span class="keyword">from</span> python_speech_features <span class="keyword">import</span> logfbank</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scipy.fftpack <span class="keyword">import</span> fft</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_wav_data</span><span class="params">(filename)</span>:</span></span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	è¯»å–ä¸€ä¸ªwavæ–‡ä»¶ï¼Œè¿”å›å£°éŸ³ä¿¡å·çš„æ—¶åŸŸè°±çŸ©é˜µå’Œæ’­æ”¾æ—¶é—´</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	wav = wave.open(filename,<span class="string">"rb"</span>) <span class="comment"># æ‰“å¼€ä¸€ä¸ªwavæ ¼å¼çš„å£°éŸ³æ–‡ä»¶æµ</span></span><br><span class="line">	num_frame = wav.getnframes() <span class="comment"># è·å–å¸§æ•°</span></span><br><span class="line">	num_channel=wav.getnchannels() <span class="comment"># è·å–å£°é“æ•°</span></span><br><span class="line">	framerate=wav.getframerate() <span class="comment"># è·å–å¸§é€Ÿç‡</span></span><br><span class="line">	num_sample_width=wav.getsampwidth() <span class="comment"># è·å–å®ä¾‹çš„æ¯”ç‰¹å®½åº¦ï¼Œå³æ¯ä¸€å¸§çš„å­—èŠ‚æ•°</span></span><br><span class="line">	str_data = wav.readframes(num_frame) <span class="comment"># è¯»å–å…¨éƒ¨çš„å¸§</span></span><br><span class="line">	wav.close() <span class="comment"># å…³é—­æµ</span></span><br><span class="line">	wave_data = np.fromstring(str_data, dtype = np.short) <span class="comment"># å°†å£°éŸ³æ–‡ä»¶æ•°æ®è½¬æ¢ä¸ºæ•°ç»„çŸ©é˜µå½¢å¼</span></span><br><span class="line">	wave_data.shape = <span class="number">-1</span>, num_channel <span class="comment"># æŒ‰ç…§å£°é“æ•°å°†æ•°ç»„æ•´å½¢ï¼Œå•å£°é“æ—¶å€™æ˜¯ä¸€åˆ—æ•°ç»„ï¼ŒåŒå£°é“æ—¶å€™æ˜¯ä¸¤åˆ—çš„çŸ©é˜µ</span></span><br><span class="line">	wave_data = wave_data.T <span class="comment"># å°†çŸ©é˜µè½¬ç½®</span></span><br><span class="line">	<span class="keyword">return</span> wave_data, framerate  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetMfccFeature</span><span class="params">(wavsignal, fs)</span>:</span></span><br><span class="line">	<span class="comment"># è·å–è¾“å…¥ç‰¹å¾</span></span><br><span class="line">	feat_mfcc=mfcc(wavsignal[<span class="number">0</span>],fs)</span><br><span class="line">	feat_mfcc_d=delta(feat_mfcc,<span class="number">2</span>)</span><br><span class="line">	feat_mfcc_dd=delta(feat_mfcc_d,<span class="number">2</span>)</span><br><span class="line">	<span class="comment"># è¿”å›å€¼åˆ†åˆ«æ˜¯mfccç‰¹å¾å‘é‡çš„çŸ©é˜µåŠå…¶ä¸€é˜¶å·®åˆ†å’ŒäºŒé˜¶å·®åˆ†çŸ©é˜µ</span></span><br><span class="line">	wav_feature = np.column_stack((feat_mfcc, feat_mfcc_d, feat_mfcc_dd))</span><br><span class="line">	<span class="keyword">return</span> wav_feature</span><br><span class="line"></span><br><span class="line">x=np.linspace(<span class="number">0</span>, <span class="number">400</span> - <span class="number">1</span>, <span class="number">400</span>, dtype = np.int64)</span><br><span class="line">w = <span class="number">0.54</span> - <span class="number">0.46</span> * np.cos(<span class="number">2</span> * np.pi * (x) / (<span class="number">400</span> - <span class="number">1</span>) ) <span class="comment"># æ±‰æ˜çª—</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetFrequencyFeature3</span><span class="params">(wavsignal, fs)</span>:</span></span><br><span class="line">	<span class="comment"># wavæ³¢å½¢ åŠ æ—¶é—´çª—ä»¥åŠæ—¶ç§»10ms</span></span><br><span class="line">	time_window = <span class="number">25</span> <span class="comment"># å•ä½ms</span></span><br><span class="line">	window_length = fs / <span class="number">1000</span> * time_window <span class="comment"># è®¡ç®—çª—é•¿åº¦çš„å…¬å¼ï¼Œç›®å‰å…¨éƒ¨ä¸º400å›ºå®šå€¼</span></span><br><span class="line">	</span><br><span class="line">	wav_arr = np.array(wavsignal)</span><br><span class="line">	<span class="comment">#wav_length = len(wavsignal[0])</span></span><br><span class="line">	wav_length = wav_arr.shape[<span class="number">1</span>]</span><br><span class="line">	</span><br><span class="line">	range0_end = int(len(wavsignal[<span class="number">0</span>])/fs*<span class="number">1000</span> - time_window) // <span class="number">10</span> <span class="comment"># è®¡ç®—å¾ªç¯ç»ˆæ­¢çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆç”Ÿæˆçš„çª—æ•°</span></span><br><span class="line">	data_input = np.zeros((range0_end, <span class="number">200</span>), dtype = np.float) <span class="comment"># ç”¨äºå­˜æ”¾æœ€ç»ˆçš„é¢‘ç‡ç‰¹å¾æ•°æ®</span></span><br><span class="line">	data_line = np.zeros((<span class="number">1</span>, <span class="number">400</span>), dtype = np.float)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, range0_end):</span><br><span class="line">		p_start = i * <span class="number">160</span></span><br><span class="line">		p_end = p_start + <span class="number">400</span></span><br><span class="line">		</span><br><span class="line">		data_line = wav_arr[<span class="number">0</span>, p_start:p_end]</span><br><span class="line">		</span><br><span class="line">		data_line = data_line * w <span class="comment"># åŠ çª—</span></span><br><span class="line">		</span><br><span class="line">		data_line = np.abs(fft(data_line)) / wav_length</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		data_input[i]=data_line[<span class="number">0</span>:<span class="number">200</span>] <span class="comment"># è®¾ç½®ä¸º400é™¤ä»¥2çš„å€¼ï¼ˆå³200ï¼‰æ˜¯å–ä¸€åŠæ•°æ®ï¼Œå› ä¸ºæ˜¯å¯¹ç§°çš„</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment">#print(data_input.shape)</span></span><br><span class="line">	data_input = np.log(data_input + <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">return</span> data_input</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wav_scale</span><span class="params">(energy)</span>:</span></span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	è¯­éŸ³ä¿¡å·èƒ½é‡å½’ä¸€åŒ–</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	means = energy.mean() <span class="comment"># å‡å€¼</span></span><br><span class="line">	var=energy.var() <span class="comment"># æ–¹å·®</span></span><br><span class="line">	e=(energy-means)/math.sqrt(var) <span class="comment"># å½’ä¸€åŒ–èƒ½é‡</span></span><br><span class="line">	<span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wav_show</span><span class="params">(wave_data, fs)</span>:</span> <span class="comment"># æ˜¾ç¤ºå‡ºæ¥å£°éŸ³æ³¢å½¢</span></span><br><span class="line">	time = np.arange(<span class="number">0</span>, len(wave_data)) * (<span class="number">1.0</span>/fs)  <span class="comment"># è®¡ç®—å£°éŸ³çš„æ’­æ”¾æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span></span><br><span class="line">	<span class="comment"># ç”»å£°éŸ³æ³¢å½¢</span></span><br><span class="line">	<span class="comment">#plt.subplot(211)  </span></span><br><span class="line">	plt.plot(time, wave_data)  </span><br><span class="line">	<span class="comment">#plt.subplot(212)  </span></span><br><span class="line">	<span class="comment">#plt.plot(time, wave_data[1], c = "g")  </span></span><br><span class="line">	plt.show()  </span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_wav_list</span><span class="params">(filename)</span>:</span></span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	è¯»å–ä¸€ä¸ªwavæ–‡ä»¶åˆ—è¡¨ï¼Œè¿”å›ä¸€ä¸ªå­˜å‚¨è¯¥åˆ—è¡¨çš„å­—å…¸ç±»å‹å€¼</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	txt_obj=open(filename,<span class="string">'r'</span>) <span class="comment"># æ‰“å¼€æ–‡ä»¶å¹¶è¯»å…¥</span></span><br><span class="line">	txt_text=txt_obj.read()</span><br><span class="line">	txt_lines=txt_text.split(<span class="string">'\n'</span>) <span class="comment"># æ–‡æœ¬åˆ†å‰²</span></span><br><span class="line">	dic_filelist=&#123;&#125; <span class="comment"># åˆå§‹åŒ–å­—å…¸</span></span><br><span class="line">	list_wavmark=[] <span class="comment"># åˆå§‹åŒ–wavåˆ—è¡¨</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> txt_lines:</span><br><span class="line">		<span class="keyword">if</span>(i!=<span class="string">''</span>):</span><br><span class="line">			txt_l=i.split(<span class="string">' '</span>)</span><br><span class="line">			dic_filelist[txt_l[<span class="number">0</span>]] = txt_l[<span class="number">1</span>]</span><br><span class="line">			list_wavmark.append(txt_l[<span class="number">0</span>])</span><br><span class="line">	txt_obj.close()</span><br><span class="line">	<span class="keyword">return</span> dic_filelist,list_wavmark</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_wav_symbol</span><span class="params">(filename)</span>:</span></span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	è¯»å–æŒ‡å®šæ•°æ®é›†ä¸­ï¼Œæ‰€æœ‰wavæ–‡ä»¶å¯¹åº”çš„è¯­éŸ³ç¬¦å·</span></span><br><span class="line"><span class="string">	è¿”å›ä¸€ä¸ªå­˜å‚¨ç¬¦å·é›†çš„å­—å…¸ç±»å‹å€¼</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	txt_obj=open(filename,<span class="string">'r'</span>) <span class="comment"># æ‰“å¼€æ–‡ä»¶å¹¶è¯»å…¥</span></span><br><span class="line">	txt_text=txt_obj.read()</span><br><span class="line">	txt_lines=txt_text.split(<span class="string">'\n'</span>) <span class="comment"># æ–‡æœ¬åˆ†å‰²</span></span><br><span class="line">	dic_symbol_list=&#123;&#125; <span class="comment"># åˆå§‹åŒ–å­—å…¸</span></span><br><span class="line">	list_symbolmark=[] <span class="comment"># åˆå§‹åŒ–symbolåˆ—è¡¨</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> txt_lines:</span><br><span class="line">		<span class="keyword">if</span>(i!=<span class="string">''</span>):</span><br><span class="line">			txt_l=i.split(<span class="string">' '</span>)</span><br><span class="line">			dic_symbol_list[txt_l[<span class="number">0</span>]]=txt_l[<span class="number">1</span>:]</span><br><span class="line">			list_symbolmark.append(txt_l[<span class="number">0</span>])</span><br><span class="line">	txt_obj.close()</span><br><span class="line">	<span class="keyword">return</span> dic_symbol_list,list_symbolmark</span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span>(__name__==<span class="string">'__main__'</span>):</span><br><span class="line">	</span><br><span class="line">	wave_data, fs = read_wav_data(<span class="string">"A2_0.wav"</span>)  </span><br><span class="line">	</span><br><span class="line">	wav_show(wave_data[<span class="number">0</span>],fs)</span><br><span class="line">	t0=time.time()</span><br><span class="line">	freimg = GetFrequencyFeature(wave_data,fs)</span><br><span class="line">	t1=time.time()</span><br><span class="line">	print(<span class="string">'time cost:'</span>,t1-t0)</span><br><span class="line">	</span><br><span class="line">	freimg = freimg.T</span><br><span class="line">	plt.subplot(<span class="number">111</span>)</span><br><span class="line">	</span><br><span class="line">	plt.imshow(freimg)</span><br><span class="line">	plt.colorbar(cax=<span class="literal">None</span>,ax=<span class="literal">None</span>,shrink=<span class="number">0.5</span>)  </span><br><span class="line">	 </span><br><span class="line">	plt.show()</span><br></pre></td></tr></table></figure>

<p>åŸå§‹è¯­éŸ³ä¿¡å·ç»è¿‡å¤„ç†åå¾—åˆ°å¸§æ•°ã€å£°é“æ•°ã€å¸§é€Ÿç‡ã€‚ç„¶åè¯»å–å…¨éƒ¨å¸§æ•°ï¼Œå†ç»è¿‡å˜æ¢åè½¬æ¢æˆæ•°ç»„çŸ©é˜µæ ¼å¼ï¼Œè¯¥æ•°ç»„æŒ‰ç…§å£°é“æ•°è¿›è¡Œæ•°ç»„æ•´å½¢ï¼Œæ•´å½¢åæ•°ç»„è½¬ç½®å¾—åˆ°æ—¶åŸŸè°±çŸ©é˜µï¼Œå¾—åˆ°å¸§é€Ÿç‡å’Œæ—¶åŸŸè°±çŸ©é˜µã€‚åœ¨å¾—åˆ°å¸§é€Ÿç‡å’Œæ—¶åŸŸè°±çŸ©é˜µåï¼Œç»è¿‡åŠ çª—ã€é‡‡æ ·åã€å‚…é‡Œå¶å˜æ¢ï¼Œä»¥åŠæœ€åçš„è¿ç»­æ‹¼æ¥ã€‚æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/7.png" alt></p>
<p>ä¸‹å›¾æ˜¯é‡‡ç”¨ä¸Šè¿°ä»£ç å¯¹ä¸­æ–‡è¯­éŸ³æ•°æ®æå–çš„æ³¢å½¢å›¾å’Œè¯­è°±å›¾çš„ç»“æœã€‚æ³¢å½¢å›¾çš„æ¨ªè½´æ˜¯æ—¶é—´ï¼Œçºµè½´å¯ä»¥ç†è§£ä¸ºä½ç§»æˆ–è€…å‹å¼ºã€‚è¯­è°±å›¾çš„æ¨ªè½´æ˜¯æ‹¼æ¥çš„æ—¶é—´ï¼Œçºµè½´æ˜¯é¢‘ç‡ã€‚</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/8.png" alt></p>
<h3 id="å£°å­¦æ¨¡å‹è®¾è®¡è®­ç»ƒ"><a href="#å£°å­¦æ¨¡å‹è®¾è®¡è®­ç»ƒ" class="headerlink" title="å£°å­¦æ¨¡å‹è®¾è®¡è®­ç»ƒ"></a>å£°å­¦æ¨¡å‹è®¾è®¡è®­ç»ƒ</h3><p>å£°å­¦æ¨¡å‹è¾“â¼Šå…¥æ˜¯è¯­è°±å›¾ï¼Œè¾“å‡ºæ˜¯æ‹¼éŸ³ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/9.png" alt></p>
<p>å£°å­¦æ¨¡å‹è®¾è®¡ä¸»è¦åŸºäºDFCNNç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œä¸»è¦è®¾è®¡çš„ç»“æ„å’Œç›¸åº”çš„å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/10.png" alt></p>
<p>å‚æ•°è®¾ç½®ï¼š</p>
<p>Adam çš„å‚æ•°:<br>(lr = 0.01, beta_1 = 0.9,beta_2 = 0.999, decay = 0.0, epsilon = 10e-8)</p>
<p><img src="/2020/04/01/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/11.png" alt></p>
<p>CTCæ˜¯ä¸€ç§é’ˆå¯¹åºåˆ—ï¦œæ·±åº¦æ¨¡å‹çš„æŸå¤±å‡½æ•°ã€‚ç›¸â½æ¯”ä¼ ç»Ÿäº¤å‰ç†µæŸå¤±å‡½æ•°èƒ½â¾ƒè‡ªåŠ¨å¯¹â»¬é½åºåˆ—ï¦œæ ‡ç­¾ï¼Œç«¯åˆ°ç«¯è®­ç»ƒæ¨¡å‹ã€‚å…·ä½“å‚è€ƒ<a href="https://blog.ailemon.me/2019/07/18/sequence-modeling-with-ctc/" target="_blank" rel="noopener external nofollow noreferrer">è¿™é‡Œ</a></p>
<p>ä½¿ç”¨Kerasæ­å»ºåºè´¯(Sequential)æ¨¡å‹ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">å£°å­¦æ¨¡å‹</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> platform <span class="keyword">as</span> plat</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> general_function.file_wav <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> general_function.file_dict <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> general_function.gen_func <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> general_function.muti_gpu <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> keras.utils <span class="keyword">import</span> multi_gpu_model,plot_model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> keras <span class="keyword">as</span> kr</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential, Model</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Dropout, Input, Reshape, BatchNormalization <span class="comment"># , Flatten</span></span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Lambda, TimeDistributed, Activation,Conv2D, MaxPooling2D <span class="comment">#, Merge</span></span><br><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> SGD, Adadelta, Adam, RMSprop</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ReadData <span class="keyword">import</span> DataSpeech</span><br><span class="line"></span><br><span class="line">abspath = <span class="string">''</span></span><br><span class="line">ModelName=<span class="string">'_dfcnn'</span></span><br><span class="line"><span class="comment">#NUM_GPU = 2</span></span><br><span class="line">base_count=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelSpeech</span><span class="params">()</span>:</span> <span class="comment"># è¯­éŸ³æ¨¡å‹ç±»</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, datapath)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">		é»˜è®¤è¾“å‡ºçš„æ‹¼éŸ³çš„è¡¨ç¤ºå¤§å°æ˜¯1434ï¼Œå³1433ä¸ªæ‹¼éŸ³+1ä¸ªç©ºç™½å—</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		MS_OUTPUT_SIZE = <span class="number">1434</span></span><br><span class="line">		self.MS_OUTPUT_SIZE = MS_OUTPUT_SIZE <span class="comment"># ç¥ç»ç½‘ç»œæœ€ç»ˆè¾“å‡ºçš„æ¯ä¸€ä¸ªå­—ç¬¦å‘é‡ç»´åº¦çš„å¤§å°</span></span><br><span class="line">		<span class="comment">#self.BATCH_SIZE = BATCH_SIZE # ä¸€æ¬¡è®­ç»ƒçš„batch</span></span><br><span class="line">		self.label_max_string_length = <span class="number">64</span></span><br><span class="line">		self.AUDIO_LENGTH = <span class="number">1600</span>  <span class="comment">## 16s</span></span><br><span class="line">		self.AUDIO_FEATURE_LENGTH = <span class="number">200</span></span><br><span class="line">		self._model, self.base_model = self.CreateModel() </span><br><span class="line">		</span><br><span class="line">		self.datapath = datapath</span><br><span class="line">		self.slash = <span class="string">''</span></span><br><span class="line">		system_type = plat.system() <span class="comment"># ç”±äºä¸åŒçš„ç³»ç»Ÿçš„æ–‡ä»¶è·¯å¾„è¡¨ç¤ºä¸ä¸€æ ·ï¼Œéœ€è¦è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">		<span class="keyword">if</span>(system_type == <span class="string">'Windows'</span>):</span><br><span class="line">			self.slash=<span class="string">'\\'</span> <span class="comment"># åæ–œæ </span></span><br><span class="line">		<span class="keyword">elif</span>(system_type == <span class="string">'Linux'</span>):</span><br><span class="line">			self.slash=<span class="string">'/'</span> <span class="comment"># æ­£æ–œæ </span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			print(<span class="string">'*[Message] Unknown System\n'</span>)</span><br><span class="line">			self.slash=<span class="string">'/'</span> <span class="comment"># æ­£æ–œæ </span></span><br><span class="line">		<span class="keyword">if</span>(self.slash != self.datapath[<span class="number">-1</span>]): <span class="comment"># åœ¨ç›®å½•è·¯å¾„æœ«å°¾å¢åŠ æ–œæ </span></span><br><span class="line">			self.datapath = self.datapath + self.slash</span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">CreateModel</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		å®šä¹‰DFCNNæ¨¡å‹ï¼Œä½¿ç”¨å‡½æ•°å¼æ¨¡å‹  </span></span><br><span class="line"><span class="string">		è¾“å…¥å±‚ï¼š200ç»´çš„ç‰¹å¾å€¼åºåˆ—ï¼Œä¸€æ¡è¯­éŸ³æ•°æ®çš„æœ€å¤§é•¿åº¦è®¾ä¸º1600ï¼ˆå¤§çº¦16sï¼‰</span></span><br><span class="line"><span class="string">		éšè—å±‚ï¼šå·ç§¯æ± åŒ–å±‚ï¼Œå·ç§¯æ ¸å¤§å°ä¸º3x3ï¼Œæ± åŒ–çª—å£å¤§å°ä¸º2</span></span><br><span class="line"><span class="string">		éšè—å±‚ï¼šå…¨è¿æ¥å±‚</span></span><br><span class="line"><span class="string">		è¾“å‡ºå±‚ï¼šå…¨è¿æ¥å±‚ï¼Œç¥ç»å…ƒæ•°é‡ä¸ºself.MS_OUTPUT_SIZEï¼Œä½¿ç”¨softmaxä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="string">		CTCå±‚ï¼šä½¿ç”¨CTCçš„lossä½œä¸ºæŸå¤±å‡½æ•°ï¼Œå®ç°è¿æ¥æ€§æ—¶åºå¤šè¾“å‡º</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		</span><br><span class="line">		input_data = Input(name=<span class="string">'the_input'</span>, shape=(self.AUDIO_LENGTH, self.AUDIO_FEATURE_LENGTH, <span class="number">1</span>))</span><br><span class="line">		</span><br><span class="line">		layer_h1 = Conv2D(<span class="number">32</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">False</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(input_data) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h1 = BatchNormalization(mode=<span class="number">0</span>,axis=<span class="number">-1</span>)(layer_h1)</span><br><span class="line">		layer_h2 = Conv2D(<span class="number">32</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h1) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h2 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h2)</span><br><span class="line">		layer_h3 = MaxPooling2D(pool_size=<span class="number">2</span>, strides=<span class="literal">None</span>, padding=<span class="string">"valid"</span>)(layer_h2) <span class="comment"># æ± åŒ–å±‚ 800*100</span></span><br><span class="line">		layer_h4 = Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h3) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h4 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h4)</span><br><span class="line">		layer_h5 = Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h4) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h5 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h5)</span><br><span class="line">		layer_h6 = MaxPooling2D(pool_size=<span class="number">2</span>, strides=<span class="literal">None</span>, padding=<span class="string">"valid"</span>)(layer_h5) <span class="comment"># æ± åŒ–å±‚ 400*50</span></span><br><span class="line">		layer_h7 = Conv2D(<span class="number">128</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h6) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h7 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h7)</span><br><span class="line">		layer_h8 = Conv2D(<span class="number">128</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h7) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h8 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h8)</span><br><span class="line">		layer_h9 = MaxPooling2D(pool_size=<span class="number">2</span>, strides=<span class="literal">None</span>, padding=<span class="string">"valid"</span>)(layer_h8) <span class="comment"># æ± åŒ–å±‚ 200*25</span></span><br><span class="line">		layer_h10 = Conv2D(<span class="number">128</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h9) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h10 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h10)</span><br><span class="line">		layer_h11 = Conv2D(<span class="number">128</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h10) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h11 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h11)</span><br><span class="line">		layer_h12 = MaxPooling2D(pool_size=<span class="number">1</span>, strides=<span class="literal">None</span>, padding=<span class="string">"valid"</span>)(layer_h11) <span class="comment"># æ± åŒ–å±‚ 200*25</span></span><br><span class="line">		</span><br><span class="line">		layer_h13 = Conv2D(<span class="number">128</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h12) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h13 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h13)</span><br><span class="line">		layer_h14 = Conv2D(<span class="number">128</span>, (<span class="number">3</span>,<span class="number">3</span>), use_bias=<span class="literal">True</span>, activation=<span class="string">'relu'</span>, padding=<span class="string">'same'</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h13) <span class="comment"># å·ç§¯å±‚</span></span><br><span class="line">		layer_h14 = BatchNormalization(axis=<span class="number">-1</span>)(layer_h14)</span><br><span class="line">		layer_h15 = MaxPooling2D(pool_size=<span class="number">1</span>, strides=<span class="literal">None</span>, padding=<span class="string">"valid"</span>)(layer_h14) <span class="comment"># æ± åŒ–å±‚ None*200*25*128</span></span><br><span class="line">		</span><br><span class="line">		layer_h16 = Reshape((<span class="number">200</span>, <span class="number">3200</span>))(layer_h15)</span><br><span class="line">		layer_h17 = Dense(<span class="number">128</span>, activation=<span class="string">"relu"</span>, use_bias=<span class="literal">True</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h16) <span class="comment"># å…¨è¿æ¥å±‚</span></span><br><span class="line">		layer_h17 = BatchNormalization(axis=<span class="number">1</span>)(layer_h17)</span><br><span class="line">		layer_h18 = Dense(self.MS_OUTPUT_SIZE, use_bias=<span class="literal">True</span>, kernel_initializer=<span class="string">'he_normal'</span>)(layer_h17) <span class="comment"># å…¨è¿æ¥å±‚</span></span><br><span class="line">		layer_h18 = BatchNormalization(axis=<span class="number">1</span>)(layer_h18)</span><br><span class="line">		y_pred = Activation(<span class="string">'softmax'</span>, name=<span class="string">'Activation0'</span>)(layer_h18)</span><br><span class="line">		model_data = Model(inputs = input_data, outputs = y_pred)</span><br><span class="line">		model_data.summary()</span><br><span class="line">		</span><br><span class="line">		labels = Input(name=<span class="string">'the_labels'</span>, shape=[self.label_max_string_length], dtype=<span class="string">'float32'</span>)</span><br><span class="line">		input_length = Input(name=<span class="string">'input_length'</span>, shape=[<span class="number">1</span>], dtype=<span class="string">'int64'</span>)</span><br><span class="line">		label_length = Input(name=<span class="string">'label_length'</span>, shape=[<span class="number">1</span>], dtype=<span class="string">'int64'</span>)</span><br><span class="line">		<span class="comment"># Keras doesn't currently support loss funcs with extra parameters</span></span><br><span class="line">		<span class="comment"># so CTC loss is implemented in a lambda layer</span></span><br><span class="line">		</span><br><span class="line">        <span class="comment"># CTC</span></span><br><span class="line">		loss_out = Lambda(self.ctc_lambda_func, output_shape=(<span class="number">1</span>,), name=<span class="string">'ctc'</span>)([y_pred, labels, input_length, label_length])</span><br><span class="line">		</span><br><span class="line">		model = Model(inputs=[input_data, labels, input_length, label_length], outputs=loss_out)</span><br><span class="line">		</span><br><span class="line">		opt = Adam(lr = <span class="number">0.001</span>, beta_1 = <span class="number">0.9</span>, beta_2 = <span class="number">0.999</span>, decay = <span class="number">0.0</span>, epsilon = <span class="number">10e-8</span>)</span><br><span class="line">		<span class="comment">#model.compile(loss=&#123;'ctc': lambda y_true, y_pred: y_pred&#125;, optimizer=sgd)</span></span><br><span class="line">		model.compile(loss=&#123;<span class="string">'ctc'</span>: <span class="keyword">lambda</span> y_true, y_pred: y_pred&#125;, optimizer = opt)</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment"># captures output of softmax so we can decode the output during visualization</span></span><br><span class="line">		test_func = K.function([input_data], [y_pred])</span><br><span class="line">		</span><br><span class="line">		print(<span class="string">'[*æç¤º] åˆ›å»ºæ¨¡å‹æˆåŠŸï¼Œæ¨¡å‹ç¼–è¯‘æˆåŠŸ'</span>)</span><br><span class="line">		<span class="keyword">return</span> model, model_data</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">ctc_lambda_func</span><span class="params">(self, args)</span>:</span></span><br><span class="line">		y_pred, labels, input_length, label_length = args</span><br><span class="line">		</span><br><span class="line">		y_pred = y_pred[:, :, :]</span><br><span class="line">		<span class="comment">#y_pred = y_pred[:, 2:, :]</span></span><br><span class="line">		<span class="keyword">return</span> K.ctc_batch_cost(labels, y_pred, input_length, label_length)</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">TrainModel</span><span class="params">(self, datapath, epoch = <span class="number">2</span>, save_step = <span class="number">1000</span>, batch_size = <span class="number">32</span>, filename = abspath + <span class="string">'model_speech/m'</span> + ModelName + <span class="string">'/speech_model'</span>+ModelName)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"><span class="string">		å‚æ•°ï¼š</span></span><br><span class="line"><span class="string">			datapath: æ•°æ®ä¿å­˜çš„è·¯å¾„</span></span><br><span class="line"><span class="string">			epoch: è¿­ä»£è½®æ•°</span></span><br><span class="line"><span class="string">			save_step: æ¯å¤šå°‘æ­¥ä¿å­˜ä¸€æ¬¡æ¨¡å‹</span></span><br><span class="line"><span class="string">			filename: é»˜è®¤ä¿å­˜æ–‡ä»¶åï¼Œä¸å«æ–‡ä»¶åç¼€å</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		data=DataSpeech(datapath, <span class="string">'train'</span>)</span><br><span class="line">		</span><br><span class="line">		num_data = data.GetDataNum() <span class="comment"># è·å–æ•°æ®çš„æ•°é‡</span></span><br><span class="line">		</span><br><span class="line">		yielddatas = data.data_genetator(batch_size, self.AUDIO_LENGTH)</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> epoch <span class="keyword">in</span> range(epoch): <span class="comment"># è¿­ä»£è½®æ•°</span></span><br><span class="line">			print(<span class="string">'[running] train epoch %d .'</span> % epoch)</span><br><span class="line">			n_step = <span class="number">0</span> <span class="comment"># è¿­ä»£æ•°æ®æ•°</span></span><br><span class="line">			<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					print(<span class="string">'[message] epoch %d . Have train datas %d+'</span>%(epoch, n_step*save_step))</span><br><span class="line">					<span class="comment"># data_genetatoræ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°</span></span><br><span class="line">					</span><br><span class="line">					<span class="comment">#self._model.fit_generator(yielddatas, save_step, nb_worker=2)</span></span><br><span class="line">					self._model.fit_generator(yielddatas, save_step)</span><br><span class="line">					n_step += <span class="number">1</span></span><br><span class="line">				<span class="keyword">except</span> StopIteration:</span><br><span class="line">					print(<span class="string">'[error] generator error. please check data format.'</span>)</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				</span><br><span class="line">				self.SaveModel(comment=<span class="string">'_e_'</span>+str(epoch)+<span class="string">'_step_'</span>+str(n_step * save_step))</span><br><span class="line">				self.TestModel(self.datapath, str_dataset=<span class="string">'train'</span>, data_count = <span class="number">4</span>)</span><br><span class="line">				self.TestModel(self.datapath, str_dataset=<span class="string">'dev'</span>, data_count = <span class="number">4</span>)</span><br><span class="line">				</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">LoadModel</span><span class="params">(self,filename = abspath + <span class="string">'model_speech/m'</span>+ModelName+<span class="string">'/speech_model'</span>+ModelName+<span class="string">'.model'</span>)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		åŠ è½½æ¨¡å‹å‚æ•°</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		self._model.load_weights(filename)</span><br><span class="line">		self.base_model.load_weights(filename + <span class="string">'.base'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">SaveModel</span><span class="params">(self,filename = abspath + <span class="string">'model_speech/m'</span>+ModelName+<span class="string">'/speech_model'</span>+ModelName,comment=<span class="string">''</span>)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		ä¿å­˜æ¨¡å‹å‚æ•°</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		self._model.save_weights(filename + comment + <span class="string">'.model'</span>)</span><br><span class="line">		self.base_model.save_weights(filename + comment + <span class="string">'.model.base'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">TestModel</span><span class="params">(self, datapath=<span class="string">''</span>, str_dataset=<span class="string">'dev'</span>, data_count = <span class="number">32</span>,comment = <span class="string">''</span>, out_report = False, show_ratio = True, io_step_print = <span class="number">10</span>, io_step_file = <span class="number">10</span>)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		æµ‹è¯•æ£€éªŒæ¨¡å‹æ•ˆæœ</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">		io_step_print</span></span><br><span class="line"><span class="string">			ä¸ºäº†å‡å°‘æµ‹è¯•æ—¶æ ‡å‡†è¾“å‡ºçš„ioå¼€é”€ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´è¿™ä¸ªå‚æ•°æ¥å®ç°</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">		io_step_file</span></span><br><span class="line"><span class="string">			ä¸ºäº†å‡å°‘æµ‹è¯•æ—¶æ–‡ä»¶è¯»å†™çš„ioå¼€é”€ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´è¿™ä¸ªå‚æ•°æ¥å®ç°</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		data=DataSpeech(self.datapath, str_dataset)</span><br><span class="line">		<span class="comment">#data.LoadDataList(str_dataset) </span></span><br><span class="line">		num_data = data.GetDataNum() <span class="comment"># è·å–æ•°æ®çš„æ•°é‡</span></span><br><span class="line">		<span class="keyword">if</span>(data_count &lt;= <span class="number">0</span> <span class="keyword">or</span> data_count &gt; num_data): <span class="comment"># å½“data_countä¸ºå°äºç­‰äº0æˆ–è€…å¤§äºæµ‹è¯•æ•°æ®é‡çš„å€¼æ—¶ï¼Œåˆ™ä½¿ç”¨å…¨éƒ¨æ•°æ®æ¥æµ‹è¯•</span></span><br><span class="line">			data_count = num_data</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			ran_num = random.randint(<span class="number">0</span>,num_data - <span class="number">1</span>) <span class="comment"># è·å–ä¸€ä¸ªéšæœºæ•°</span></span><br><span class="line">			</span><br><span class="line">			words_num = <span class="number">0</span></span><br><span class="line">			word_error_num = <span class="number">0</span></span><br><span class="line">			</span><br><span class="line">			nowtime = time.strftime(<span class="string">'%Y%m%d_%H%M%S'</span>,time.localtime(time.time()))</span><br><span class="line">			<span class="keyword">if</span>(out_report == <span class="literal">True</span>):</span><br><span class="line">				txt_obj = open(abspath+<span class="string">'Test_Report_'</span> + str_dataset + <span class="string">'_'</span> + nowtime + <span class="string">'.txt'</span>, <span class="string">'w'</span>, encoding=<span class="string">'UTF-8'</span>) <span class="comment"># æ‰“å¼€æ–‡ä»¶å¹¶è¯»å…¥</span></span><br><span class="line">			</span><br><span class="line">			txt = <span class="string">'æµ‹è¯•æŠ¥å‘Š\næ¨¡å‹ç¼–å· '</span> + ModelName + <span class="string">'\n\n'</span></span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> range(data_count):</span><br><span class="line">				data_input, data_labels = data.GetData((ran_num + i) % num_data)  <span class="comment"># ä»éšæœºæ•°å¼€å§‹è¿ç»­å‘åå–ä¸€å®šæ•°é‡æ•°æ®</span></span><br><span class="line">				</span><br><span class="line">				<span class="comment"># æ•°æ®æ ¼å¼å‡ºé”™å¤„ç† å¼€å§‹</span></span><br><span class="line">				<span class="comment"># å½“è¾“å…¥çš„wavæ–‡ä»¶é•¿åº¦è¿‡é•¿æ—¶è‡ªåŠ¨è·³è¿‡è¯¥æ–‡ä»¶ï¼Œè½¬è€Œä½¿ç”¨ä¸‹ä¸€ä¸ªwavæ–‡ä»¶æ¥è¿è¡Œ</span></span><br><span class="line">				num_bias = <span class="number">0</span></span><br><span class="line">				<span class="keyword">while</span>(data_input.shape[<span class="number">0</span>] &gt; self.AUDIO_LENGTH):</span><br><span class="line">					print(<span class="string">'*[Error]'</span>,<span class="string">'wave data lenghth of num'</span>,(ran_num + i) % num_data, <span class="string">'is too long.'</span>,<span class="string">'\n A Exception raise when test Speech Model.'</span>)</span><br><span class="line">					num_bias += <span class="number">1</span></span><br><span class="line">					data_input, data_labels = data.GetData((ran_num + i + num_bias) % num_data)  <span class="comment"># ä»éšæœºæ•°å¼€å§‹è¿ç»­å‘åå–ä¸€å®šæ•°é‡æ•°æ®</span></span><br><span class="line">				<span class="comment"># æ•°æ®æ ¼å¼å‡ºé”™å¤„ç† ç»“æŸ</span></span><br><span class="line">				</span><br><span class="line">				pre = self.Predict(data_input, data_input.shape[<span class="number">0</span>] // <span class="number">8</span>)</span><br><span class="line">				</span><br><span class="line">				words_n = data_labels.shape[<span class="number">0</span>] <span class="comment"># è·å–æ¯ä¸ªå¥å­çš„å­—æ•°</span></span><br><span class="line">				words_num += words_n <span class="comment"># æŠŠå¥å­çš„æ€»å­—æ•°åŠ ä¸Š</span></span><br><span class="line">				edit_distance = GetEditDistance(data_labels, pre) <span class="comment"># è·å–ç¼–è¾‘è·ç¦»</span></span><br><span class="line">				<span class="keyword">if</span>(edit_distance &lt;= words_n): <span class="comment"># å½“ç¼–è¾‘è·ç¦»å°äºç­‰äºå¥å­å­—æ•°æ—¶</span></span><br><span class="line">					word_error_num += edit_distance <span class="comment"># ä½¿ç”¨ç¼–è¾‘è·ç¦»ä½œä¸ºé”™è¯¯å­—æ•°</span></span><br><span class="line">				<span class="keyword">else</span>: <span class="comment"># å¦åˆ™è‚¯å®šæ˜¯å¢åŠ äº†ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„å¥‡å¥‡æ€ªæ€ªçš„å­—</span></span><br><span class="line">					word_error_num += words_n <span class="comment"># å°±ç›´æ¥åŠ å¥å­æœ¬æ¥çš„æ€»å­—æ•°å°±å¥½äº†</span></span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>((i % io_step_print == <span class="number">0</span> <span class="keyword">or</span> i == data_count - <span class="number">1</span>) <span class="keyword">and</span> show_ratio == <span class="literal">True</span>):</span><br><span class="line">					<span class="comment">#print('æµ‹è¯•è¿›åº¦ï¼š',i,'/',data_count)</span></span><br><span class="line">					print(<span class="string">'Test Count: '</span>,i,<span class="string">'/'</span>,data_count)</span><br><span class="line">				</span><br><span class="line">				txt = <span class="string">''</span></span><br><span class="line">				<span class="keyword">if</span>(out_report == <span class="literal">True</span>):</span><br><span class="line">					<span class="comment"># if(i % io_step_file == 0 or i == data_count - 1):</span></span><br><span class="line">					<span class="comment"># 	txt_obj.write(txt)</span></span><br><span class="line">					<span class="comment"># 	txt = ''</span></span><br><span class="line">					txt += str(i) + <span class="string">'\n'</span></span><br><span class="line">					txt += <span class="string">'True:\t'</span> + str(data_labels) + <span class="string">'\n'</span></span><br><span class="line">					txt += <span class="string">'Pred:\t'</span> + str(pre) + <span class="string">'\n'</span></span><br><span class="line">					txt += <span class="string">'\n'</span></span><br><span class="line">					txt_obj.write(txt)</span><br><span class="line">				</span><br><span class="line">			print(<span class="string">'*[Test Result] Speech Recognition '</span> + str_dataset + <span class="string">' set word error ratio: '</span>, word_error_num / words_num * <span class="number">100</span>, <span class="string">'%'</span>)</span><br><span class="line">			<span class="keyword">if</span>(out_report == <span class="literal">True</span>):</span><br><span class="line">				txt += <span class="string">'*[æµ‹è¯•ç»“æœ] è¯­éŸ³è¯†åˆ« '</span> + str_dataset + <span class="string">' é›†è¯­éŸ³å•å­—é”™è¯¯ç‡ï¼š '</span> + str(word_error_num / words_num * <span class="number">100</span>) + <span class="string">' %'</span></span><br><span class="line">				txt_obj.write(txt)</span><br><span class="line">				txt = <span class="string">''</span></span><br><span class="line">				txt_obj.close()</span><br><span class="line">			</span><br><span class="line">		<span class="keyword">except</span> StopIteration:</span><br><span class="line">			print(<span class="string">'[Error] Model Test Error. please check data format.'</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">Predict</span><span class="params">(self, data_input, input_len)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		é¢„æµ‹ç»“æœ</span></span><br><span class="line"><span class="string">		è¿”å›è¯­éŸ³è¯†åˆ«åçš„æ‹¼éŸ³ç¬¦å·åˆ—è¡¨</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		</span><br><span class="line">		batch_size = <span class="number">1</span> </span><br><span class="line">		in_len = np.zeros((batch_size),dtype = np.int32)</span><br><span class="line">		</span><br><span class="line">		in_len[<span class="number">0</span>] = input_len</span><br><span class="line">		</span><br><span class="line">		x_in = np.zeros((batch_size, <span class="number">1600</span>, self.AUDIO_FEATURE_LENGTH, <span class="number">1</span>), dtype=np.float)</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(batch_size):</span><br><span class="line">			x_in[i,<span class="number">0</span>:len(data_input)] = data_input</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		base_pred = self.base_model.predict(x = x_in)</span><br><span class="line">		</span><br><span class="line">		base_pred =base_pred[:, :, :]</span><br><span class="line">		</span><br><span class="line">		r = K.ctc_decode(base_pred, in_len, greedy = <span class="literal">True</span>, beam_width=<span class="number">100</span>, top_paths=<span class="number">1</span>)</span><br><span class="line">		</span><br><span class="line">		<span class="comment">#print('r', r)</span></span><br><span class="line">		</span><br><span class="line">		r1 = K.get_value(r[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">		<span class="comment">#print('r1', r1)</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">#r2 = K.get_value(r[1])</span></span><br><span class="line">		<span class="comment">#print(r2)</span></span><br><span class="line">		</span><br><span class="line">		r1=r1[<span class="number">0</span>]</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> r1</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">RecognizeSpeech</span><span class="params">(self, wavsignal, fs)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		æœ€ç»ˆåšè¯­éŸ³è¯†åˆ«ç”¨çš„å‡½æ•°ï¼Œè¯†åˆ«ä¸€ä¸ªwavåºåˆ—çš„è¯­éŸ³</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">#data = self.data</span></span><br><span class="line">		<span class="comment">#data = DataSpeech('E:\\è¯­éŸ³æ•°æ®é›†')</span></span><br><span class="line">		<span class="comment">#data.LoadDataList('dev')</span></span><br><span class="line">		<span class="comment"># è·å–è¾“å…¥ç‰¹å¾</span></span><br><span class="line">		<span class="comment">#data_input = GetMfccFeature(wavsignal, fs)</span></span><br><span class="line">		<span class="comment">#t0=time.time()</span></span><br><span class="line">		data_input = GetFrequencyFeature(wavsignal, fs)</span><br><span class="line">		<span class="comment">#t1=time.time()</span></span><br><span class="line">		<span class="comment">#print('time cost:',t1-t0)</span></span><br><span class="line">		</span><br><span class="line">		input_length = len(data_input)</span><br><span class="line">		input_length = input_length // <span class="number">8</span></span><br><span class="line">		</span><br><span class="line">		data_input = np.array(data_input, dtype = np.float)</span><br><span class="line">		<span class="comment">#print(data_input,data_input.shape)</span></span><br><span class="line">		data_input = data_input.reshape(data_input.shape[<span class="number">0</span>],data_input.shape[<span class="number">1</span>],<span class="number">1</span>)</span><br><span class="line">		<span class="comment">#t2=time.time()</span></span><br><span class="line">		r1 = self.Predict(data_input, input_length)</span><br><span class="line">		<span class="comment">#t3=time.time()</span></span><br><span class="line">		<span class="comment">#print('time cost:',t3-t2)</span></span><br><span class="line">		list_symbol_dic = GetSymbolList(self.datapath) <span class="comment"># è·å–æ‹¼éŸ³åˆ—è¡¨</span></span><br><span class="line">		</span><br><span class="line">		r_str=[]</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> r1:</span><br><span class="line">			r_str.append(list_symbol_dic[i])</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> r_str</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">RecognizeSpeech_FromFile</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		æœ€ç»ˆåšè¯­éŸ³è¯†åˆ«ç”¨çš„å‡½æ•°ï¼Œè¯†åˆ«æŒ‡å®šæ–‡ä»¶åçš„è¯­éŸ³</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		</span><br><span class="line">		wavsignal,fs = read_wav_data(filename)</span><br><span class="line">		</span><br><span class="line">		r = self.RecognizeSpeech(wavsignal, fs)</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> r</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">model</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="string">'''</span></span><br><span class="line"><span class="string">		è¿”å›keras model</span></span><br><span class="line"><span class="string">		'''</span></span><br><span class="line">		<span class="keyword">return</span> self._model</span><br></pre></td></tr></table></figure>

<h3 id="è¯­è¨€æ¨¡å‹è®¾è®¡è®­ç»ƒ"><a href="#è¯­è¨€æ¨¡å‹è®¾è®¡è®­ç»ƒ" class="headerlink" title="è¯­è¨€æ¨¡å‹è®¾è®¡è®­ç»ƒ"></a>è¯­è¨€æ¨¡å‹è®¾è®¡è®­ç»ƒ</h3><h3 id="å®éªŒåˆ†æå’Œè½¯ä»¶è®¾è®¡"><a href="#å®éªŒåˆ†æå’Œè½¯ä»¶è®¾è®¡" class="headerlink" title="å®éªŒåˆ†æå’Œè½¯ä»¶è®¾è®¡"></a>å®éªŒåˆ†æå’Œè½¯ä»¶è®¾è®¡</h3>]]></content>
      <categories>
        <category>é¡¹ç›®</category>
      </categories>
      <tags>
        <tag>é¡¹ç›®</tag>
      </tags>
  </entry>
  <entry>
    <title>TPOTâ€”â€”ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Pythonæœºå™¨å­¦ä¹ å·¥å…·</title>
    <url>/2020/03/31/TPOT%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84Python%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h2 id="TPOTâ€”ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Pythonæœºå™¨å­¦ä¹ å·¥å…·"><a href="#TPOTâ€”ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Pythonæœºå™¨å­¦ä¹ å·¥å…·" class="headerlink" title="TPOTâ€”ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Pythonæœºå™¨å­¦ä¹ å·¥å…·"></a>TPOTâ€”ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Pythonæœºå™¨å­¦ä¹ å·¥å…·</h2><p><img src="/2020/03/31/TPOT%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84Python%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/1.png" alt></p>
<p>TPOTå…¨ç§°æ˜¯åŸºäºæ ‘çš„pipelineä¼˜åŒ–å·¥å…·(Tree-based Pipeline Optimization Tool)ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’Pythonè‡ªåŠ¨æœºå™¨å­¦ä¹ å·¥å…·ï¼Œä½¿ç”¨é—ä¼ ç¼–ç¨‹ä¼˜åŒ–æœºå™¨å­¦ä¹ pipelineã€‚</p>
<a id="more"></a>

<p><img src="/2020/03/31/TPOT%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84Python%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/2.png" alt></p>
<p>TPOTå¯ä»¥è‡ªåŠ¨åŒ–è®¸å¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬ç”Ÿå‘½ç‰¹æ€§é€‰æ‹©ã€æ¨¡å‹é€‰æ‹©ã€ç‰¹æ€§æ„å»ºç­‰ç­‰ã€‚å¦‚æœä½ æ˜¯Pythonæœºå™¨å­¦ä¹ è€…ï¼Œå¾ˆå¹¸è¿ï¼ŒTPOTæ˜¯æ„å»ºåœ¨Scikit-learnä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å®ƒç”Ÿæˆçš„æ‰€æœ‰ä»£ç çœ‹èµ·æ¥åº”è¯¥å¾ˆç†Ÿæ‚‰ã€‚</p>
<p>å®ƒçš„ä½œç”¨æ˜¯é€šè¿‡æ™ºèƒ½åœ°æ¢ç´¢æ•°åƒç§å¯èƒ½çš„pipelineæ¥è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ ä¸­æœ€ç¹ççš„éƒ¨åˆ†ï¼Œæ‰¾åˆ°æœ€é€‚åˆä½ çš„æ•°æ®çš„pipelineï¼Œç„¶åä¸ºä½ æä¾›æœ€ä½³çš„ Python ä»£ç ã€‚</p>
<p>å®ƒçš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/31/TPOT%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84Python%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/3.png" alt></p>
<h2 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1 å®‰è£…"></a>1 å®‰è£…</h2><p>å®‰è£…TPOTï¼Œå¯å‚è€ƒä»¥ä¸‹æ–‡æ¡£ï¼š<br><a href="http://epistasislab.github.io/tpot/installing/" target="_blank" rel="noopener external nofollow noreferrer">http://epistasislab.github.io/tpot/installing/</a></p>
<h2 id="2-ä½¿ç”¨"><a href="#2-ä½¿ç”¨" class="headerlink" title="2 ä½¿ç”¨"></a>2 ä½¿ç”¨</h2><h3 id="2-1-TPOTä»£ç "><a href="#2-1-TPOTä»£ç " class="headerlink" title="2.1 TPOTä»£ç "></a>2.1 TPOTä»£ç </h3><p>TPOTçš„æ¥å£ï¼Œä¸scikit-learnå¾ˆç±»ä¼¼ã€‚</p>
<p>TPOTå¯ä»¥åƒä»»ä½•å¸¸è§„çš„Pythonæ¨¡å—ä¸€æ ·å¯¼å…¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tpot <span class="keyword">import</span> TPOTClassifier</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ›å»ºä¸€ä¸ªTPOTå®ä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pipeline_optimizer = TPOTClassifier()</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼ŒTPOTRegressorï¼ˆï¼‰ä¹Ÿå¯ä»¥ã€‚</p>
<p>ä¸€äº›å¸¦æœ‰å®šåˆ¶TPOTå‚æ•°çš„ç¤ºä¾‹ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pipeline_optimizer = TPOTClassifier(generations=<span class="number">5</span>, population_size=<span class="number">20</span>, cv=<span class="number">5</span>, random_state=<span class="number">42</span>, verbosity=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œå¯ä»¥åˆ©ç”¨fitå‡½æ•°æ¥å¯»æ‰¾æœ€ä¼˜çš„ç®¡é“ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pipeline_optimizer.fit(X_train, y_train)</span><br></pre></td></tr></table></figure>
<p>fitå‡½æ•°åˆå§‹åŒ–äº†é—ä¼ ç®—æ³•ï¼Œä»¥æ‰¾åˆ°åŸºäºå¹³å‡kå€äº¤å‰éªŒè¯çš„æœ€é«˜è¯„åˆ†ç®¡é“ï¼Œç„¶åå¯¹æ•´ä¸ªæä¾›çš„æ ·æœ¬è¿›è¡Œè®­ç»ƒï¼ŒTPOTå®ä¾‹å¯ä»¥ä½œä¸ºä¸€ä¸ªåˆé€‚çš„æ¨¡å‹ä½¿ç”¨ã€‚</p>
<p>ç„¶åï¼Œå¯ä»¥ä½¿ç”¨scoreå‡½æ•°æ¥è¯„ä¼°æµ‹è¯•é›†ä¸­çš„æœ€ç»ˆç®¡é“ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(pipeline_optimizer.score(X_test, y_test))</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œå¯ä»¥æŠŠTPOTå°†ç›¸åº”çš„Pythonä»£ç å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pipeline_optimizer.export(<span class="string">'tpot_exported_pipeline.py'</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹è„šæœ¬ï¼Œä½¿ç”¨TPOTä¼˜åŒ–ç®¡é“ï¼Œå¯¹å…¶è¿›è¡Œè¯„åˆ†ï¼Œå¹¶å°†æœ€å¥½çš„ç®¡é“å¯¼å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tpot <span class="keyword">import</span> TPOTClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_digits</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"> </span><br><span class="line">digits = load_digits()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(digits.data, digits.target,train_size=<span class="number">0.75</span>, test_size=<span class="number">0.25</span>)</span><br><span class="line"> </span><br><span class="line">pipeline_optimizer = TPOTClassifier(generations=<span class="number">5</span>, population_size=<span class="number">20</span>, cv=<span class="number">5</span>,random_state=<span class="number">42</span>, verbosity=<span class="number">2</span>)</span><br><span class="line">pipeline_optimizer.fit(X_train, y_train)</span><br><span class="line">print(pipeline_optimizer.score(X_test, y_test))</span><br><span class="line">pipeline_optimizer.export(<span class="string">'tpot_exported_pipeline.py'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-TPOTå‘½ä»¤è¡Œ"><a href="#2-2-TPOTå‘½ä»¤è¡Œ" class="headerlink" title="2.2 TPOTå‘½ä»¤è¡Œ"></a>2.2 TPOTå‘½ä»¤è¡Œ</h3><p>TPOTå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå¯¼å…¥ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tpot &#x2F;path_to&#x2F;data_file.csv</span><br></pre></td></tr></table></figure>
<p>å‘½ä»¤è¡Œå¯¼å…¥ä½¿ç”¨TPOTçš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tpot data&#x2F;mnist.csv -is , -target class -o tpot_exported_pipeline.py -g 5 -p 20 -cv 5 -s 42 -v 2</span><br></pre></td></tr></table></figure>
<h3 id="2-3-è¯„ä¼°å‡½æ•°"><a href="#2-3-è¯„ä¼°å‡½æ•°" class="headerlink" title="2.3 è¯„ä¼°å‡½æ•°"></a>2.3 è¯„ä¼°å‡½æ•°</h3><p>TPOTå…è®¸è‡ªå®šä¹‰è¯„åˆ†å‡½æ•°ï¼Œå…·ä½“ä¾‹å­å¯ä»¥å‚è€ƒ<a href="https://epistasislab.github.io/tpot/using/#scoring-functions" target="_blank" rel="noopener external nofollow noreferrer">Scoring Functions</a><br>##2.4 å†…ç½®TPOTé…ç½®<br>TPOTæä¾›äº†ä¸€äº›é»˜è®¤çš„æ“ä½œç¬¦å’Œå‚æ•°é…ç½®ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°ä¼˜åŒ–æœºå™¨å­¦ä¹ ç®¡é“ã€‚ä¸‹é¢æ˜¯TPOTå½“å‰å†…ç½®é…ç½®çš„<a href="https://epistasislab.github.io/tpot/using/#built-in-tpot-configurations" target="_blank" rel="noopener external nofollow noreferrer">åˆ—è¡¨</a>ã€‚å®ƒæœ‰4ç§ï¼š</p>
<ul>
<li>Default TPOTï¼šé»˜è®¤çš„å‚æ•°ï¼Œåœ¨ä¸€äº›å¤§æ•°æ®é›†ä¸Šå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚</li>
<li>TPOT lightï¼šä¸Default TPOTç›¸æ¯”ï¼Œä½¿ç”¨äº†æ›´ç®€å•ã€å¿«é€Ÿè¿è¡Œçš„æ“ä½œç¬¦ï¼Œå› æ­¤TPOT lightå¯¹äºæŸ¥æ‰¾ç”¨äºåˆ†ç±»æˆ–å›å½’é—®é¢˜çš„å¿«é€Ÿç®€å•çš„ç®¡é“éå¸¸æœ‰ç”¨ã€‚</li>
<li>TPOT MDRï¼šä¸“é—¨ç”¨äºå…¨åŸºå› ç»„å…³è”ç ”ç©¶ï¼ˆGWASï¼‰</li>
<li>TPOT sparseï¼šå¸¦æœ‰one-hotç¼–ç ï¼Œä¸”æ”¯æŒç¨€ç–çŸ©é˜µã€‚<br>å¦‚æœè¦ä½¿ç”¨è¿™äº›é…ç½®åªéœ€å°†é…ç½®çš„å­—ç¬¦ä¸²åç§°ä¼ é€’ç»™config_dict å‚æ•°ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tpot <span class="keyword">import</span> TPOTClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_digits</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">digits = load_digits()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(digits.data, digits.target,train_size=<span class="number">0.75</span>, test_size=<span class="number">0.25</span>)</span><br><span class="line"></span><br><span class="line">tpot = TPOTClassifier(generations=<span class="number">5</span>, population_size=<span class="number">20</span>, verbosity=<span class="number">2</span>,config_dict=<span class="string">'TPOT light'</span>)</span><br><span class="line">tpot.fit(X_train, y_train)</span><br><span class="line">print(tpot.score(X_test, y_test))</span><br><span class="line">tpot.export(<span class="string">'tpot_mnist_pipeline.py'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-5-å®šåˆ¶TPOTçš„æ“ä½œç¬¦å’Œå‚æ•°"><a href="#2-5-å®šåˆ¶TPOTçš„æ“ä½œç¬¦å’Œå‚æ•°" class="headerlink" title="2.5 å®šåˆ¶TPOTçš„æ“ä½œç¬¦å’Œå‚æ•°"></a>2.5 å®šåˆ¶TPOTçš„æ“ä½œç¬¦å’Œå‚æ•°</h3>é™¤äº†TPOTæ‰€å¸¦æ¥çš„é»˜è®¤é…ç½®ä¹‹å¤–ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé™åˆ¶TPOTæ‰€è€ƒè™‘çš„ç®—æ³•å’Œå‚æ•°æ˜¯å¾ˆæœ‰ç”¨çš„ï¼ˆç”¨äºå‡å°‘å¯»ä¼˜çš„æ—¶é—´ç­‰ï¼‰ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼ŒTPOTå…è®¸ç”¨æˆ·ä¸ºTPOTæä¾›å…¶æ“ä½œç¬¦å’Œå‚æ•°çš„è‡ªå®šä¹‰é…ç½®ã€‚<br>è‡ªå®šä¹‰TPOTé…ç½®å¿…é¡»é‡‡ç”¨åµŒå¥—å­—å…¸æ ¼å¼ï¼Œä¸¾ä¸€ä¸ªä¾‹å­ï¼š<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tpot <span class="keyword">import</span> TPOTClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_digits</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"> </span><br><span class="line">digits = load_digits()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(digits.data, digits.target,train_size=<span class="number">0.75</span>, test_size=<span class="number">0.25</span>)</span><br><span class="line"> </span><br><span class="line">tpot_config = &#123;</span><br><span class="line">    <span class="string">'sklearn.naive_bayes.GaussianNB'</span>: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    <span class="string">'sklearn.naive_bayes.BernoulliNB'</span>: &#123;</span><br><span class="line">        <span class="string">'alpha'</span>: [<span class="number">1e-3</span>, <span class="number">1e-2</span>, <span class="number">1e-1</span>, <span class="number">1.</span>, <span class="number">10.</span>, <span class="number">100.</span>],</span><br><span class="line">        <span class="string">'fit_prior'</span>: [<span class="literal">True</span>, <span class="literal">False</span>]</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    <span class="string">'sklearn.naive_bayes.MultinomialNB'</span>: &#123;</span><br><span class="line">        <span class="string">'alpha'</span>: [<span class="number">1e-3</span>, <span class="number">1e-2</span>, <span class="number">1e-1</span>, <span class="number">1.</span>, <span class="number">10.</span>, <span class="number">100.</span>],</span><br><span class="line">        <span class="string">'fit_prior'</span>: [<span class="literal">True</span>, <span class="literal">False</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">tpot = TPOTClassifier(generations=<span class="number">5</span>, population_size=<span class="number">20</span>, verbosity=<span class="number">2</span>,</span><br><span class="line">                      config_dict=tpot_config)</span><br><span class="line">tpot.fit(X_train, y_train)</span><br><span class="line">print(tpot.score(X_test, y_test))</span><br><span class="line">tpot.export(<span class="string">'tpot_mnist_pipeline.py'</span>)</span><br></pre></td></tr></table></figure>
è¿™æ ·ï¼ŒTPOTå¯»æ‰¾æœ€ä¼˜çš„pipelineï¼Œå°±åªä¼šåœ¨tpot_configä¸­å¯»æ‰¾äº†ï¼Œæ— ç–‘å¤§å¤§å‡å°‘äº†æ—¶é—´å¤æ‚åº¦ï¼Œä¸è¿‡å‡†ç¡®æ€§å¯èƒ½ä¼šä¸‹é™ã€‚<h3 id="2-6-Note"><a href="#2-6-Note" class="headerlink" title="2.6 Note"></a>2.6 Note</h3>æœç´¢æ•´ä¸ªç®¡é“ç©ºé—´æ˜¯ç‰¹åˆ«è€—æ—¶çš„ã€‚è®¤è¯†åˆ°åŸå› æ˜¯å¿…è¦çš„ï¼Œåœ¨é»˜è®¤çš„TPOTå‚æ•°ä¸‹ï¼ˆ100 generations with 100 population sizeï¼‰ï¼ŒTPOTå°†åœ¨å®Œæˆå‰è¯„ä¼°1ä¸‡ä¸ªç®¡é“é…ç½®ã€‚è€ƒè™‘ä¸€ä¸ªç½‘æ ¼æœç´¢1ä¸‡ä¸ªè¶…å‚æ•°ç»„åˆç”¨äºæœºå™¨å­¦ä¹ ç®—æ³•ä»¥åŠç½‘æ ¼æœç´¢éœ€è¦å¤šé•¿æ—¶é—´ã€‚ç”¨10å€çš„äº¤å‰éªŒè¯æ¥è¯„ä¼°è¿™1ä¸‡ä¸ªæ¨¡å‹ï¼Œè¿™æ„å‘³ç€å¤§çº¦æœ‰10ä¸‡ä¸ªæ¨¡å‹åœ¨ä¸€ä¸ªç½‘æ ¼æœç´¢çš„è®­ç»ƒæ•°æ®ä¸­è¢«åŒ¹é…å’Œè¯„ä¼°ã€‚è¿™æ˜¯ä¸€ä¸ªè€—æ—¶çš„è¿‡ç¨‹ï¼Œå³ä½¿å¯¹äºåƒå†³ç­–æ ‘è¿™æ ·çš„ç®€å•æ¨¡å‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</li>
</ul>
<p>å…¸å‹çš„TPOTè¿è¡Œå°†éœ€è¦æ•°å°æ—¶åˆ°æ•°å¤©æ‰èƒ½å®Œæˆï¼ˆé™¤éæ˜¯ä¸€ä¸ªå°æ•°æ®é›†ï¼‰ï¼Œä½†æ˜¯å¯ä»¥ä¸­æ–­è¿è¡Œï¼Œå¹¶çœ‹åˆ°ç›®å‰ä¸ºæ­¢æœ€å¥½çš„ç»“æœã€‚TPOTè¿˜æä¾›warm_startå‚æ•°ï¼Œå¯ä»¥ä»ä¸­æ–­çš„åœ°æ–¹é‡æ–°å¯åŠ¨ä¹‹å‰è¿è¡Œçš„TPOTã€‚</p>
<h2 id="3-TPOT-API"><a href="#3-TPOT-API" class="headerlink" title="3. TPOT API"></a>3. TPOT API</h2><p>ä»¥TPOTRegressorä¸ºä¾‹ï¼Œåˆ†ç±»é—®é¢˜ä¸€æ ·ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tpot</span>.<span class="title">TPOTRegressor</span><span class="params">(generations=<span class="number">100</span>, population_size=<span class="number">100</span>,</span></span></span><br><span class="line"><span class="class"><span class="params">offspring_size=None, mutation_rate=<span class="number">0.9</span>,</span></span></span><br><span class="line"><span class="class"><span class="params">crossover_rate=<span class="number">0.1</span>,</span></span></span><br><span class="line"><span class="class"><span class="params">scoring=<span class="string">'neg_mean_squared_error'</span>, cv=<span class="number">5</span>,</span></span></span><br><span class="line"><span class="class"><span class="params">subsample=<span class="number">1.0</span>, n_jobs=<span class="number">1</span>,</span></span></span><br><span class="line"><span class="class"><span class="params">max_time_mins=None, max_eval_time_mins=<span class="number">5</span>,</span></span></span><br><span class="line"><span class="class"><span class="params">random_state=None, config_dict=None,</span></span></span><br><span class="line"><span class="class"><span class="params">warm_start=False,</span></span></span><br><span class="line"><span class="class"><span class="params">memory=None,</span></span></span><br><span class="line"><span class="class"><span class="params">periodic_checkpoint_folder=None,</span></span></span><br><span class="line"><span class="class"><span class="params">early_stop=None,</span></span></span><br><span class="line"><span class="class"><span class="params">verbosity=<span class="number">0</span>,</span></span></span><br><span class="line"><span class="class"><span class="params">disable_update_check=False)</span></span></span><br></pre></td></tr></table></figure>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒTPOTRegressorå°†æœç´¢å¹¿æ³›çš„ç›‘ç£çš„å›å½’æ¨¡å‹ï¼ŒåŒ…æ‹¬é¢„å¤„ç†ï¼Œç‰¹å¾é€‰æ‹©ï¼Œå­¦ä¹ å™¨å’Œå®ƒä»¬çš„è¶…å‚æ•°ã€‚å½“ç„¶ï¼ŒTPOTRegressorå¯ä»¥å®Œå…¨è‡ªå·±å®šåˆ¶ã€‚</p>
<p>å‚æ•°ï¼Œå±æ€§å’Œæ–¹æ³•çš„è¯¦æƒ…å¯ä»¥å‚è€ƒ<a href="https://epistasislab.github.io/tpot/api/#regression" target="_blank" rel="noopener external nofollow noreferrer">å¦‚ä¸‹</a></p>
<p>ä¸‹é¢åˆ—å‡ºä¸»è¦çš„å‚æ•°å’Œæ–¹æ³•ï¼š</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li>generations: int, optional (default=100)ï¼Œè¿è¡Œç®¡é“ä¼˜åŒ–è¿‡ç¨‹çš„è¿­ä»£æ¬¡æ•°ã€‚ä¸€å®šæ˜¯æ­£æ•°,é»˜è®¤æ˜¯100ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå€¼è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå¥½ã€‚</li>
</ul>
<p>TPOTå°†è¯„ä¼°population_size+generationsÃ—offspring_sizeçš„è§„æ¨¡ã€‚</p>
<ul>
<li><p>population_size: int, optional (default=100)ï¼Œåœ¨æ¯ä¸€ä»£é—ä¼ ä¸­ä¿ç•™çš„ä¸ªä½“æ•°ã€‚ä¸€å®šæ˜¯æ­£æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå€¼è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå¥½ã€‚</p>
</li>
<li><p>offspring_size: int, optional (default=100)ï¼Œåœ¨æ¯ä¸€æ¬¡é—ä¼ è¿‡ç¨‹ä¸­äº§ç”Ÿçš„åä»£æ•°é‡ã€‚ä¸€å®šæ˜¯æ­£æ•°ã€‚</p>
</li>
<li><p>mutation_rate: float, optional (default=0.9)ï¼Œå˜å¼‚ç‡ï¼Œé‡‡ç”¨é»˜è®¤å€¼å³å¯ã€‚</p>
</li>
<li><p>crossover_rate: float, optional (default=0.1)ï¼Œäº¤å‰ç‡ï¼Œé‡‡ç”¨é»˜è®¤å€¼å³å¯ã€‚</p>
</li>
<li><p>scoring: string or callable, optional (default=â€™neg_mean_squared_errorâ€™)ï¼Œå›å½’é—®é¢˜ä¸­ç”¨äºè¯„ä¼°ç»™å®šç®¡é“çš„è´¨é‡çš„å‡½æ•°ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…ç½®è¯„åˆ†å‡½æ•°ï¼š â€˜neg_median_absolute_errorâ€™, â€˜neg_mean_absolute_errorâ€™, â€˜neg_mean_squared_errorâ€™, â€˜r2â€™</p>
</li>
<li><p>cv: int, cross-validation generator, or an iterable, optional (default=5)</p>
</li>
<li><p>subsample: float, optional (default=1.0)ï¼Œåœ¨TPOTä¼˜åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨çš„è®­ç»ƒæ ·æœ¬çš„æ¯”ä¾‹ã€‚å¿…é¡»åœ¨0åˆ°1ä¹‹é—´ã€‚</p>
</li>
<li><p>n_jobs: integer, optional (default=1)</p>
</li>
<li><p>max_time_mins: integer or None, optional (default=None)ï¼ŒTPOTéœ€è¦å¤šå°‘åˆ†é’Ÿæ¥ä¼˜åŒ–ç®¡é“ã€‚</p>
</li>
<li><p>max_eval_time_mins: integer, optional (default=5)ï¼ŒTPOTéœ€è¦å¤šå°‘åˆ†é’Ÿæ¥è¯„ä¼°ä¸€ä¸ªç®¡é“ã€‚</p>
</li>
<li><p>random_state: integer or None, optional (default=None)ï¼Œä½¿ç”¨è¿™ä¸ªå‚æ•°æ¥ç¡®ä¿TPOTæ¯æ¬¡è¿è¡Œæ—¶éƒ½ä¼šæœ‰ç›¸åŒçš„ç»“æœã€‚</p>
</li>
<li><p>config_dict: Python dictionary, string, or None, optional (default=None)ï¼Œç”¨äºå®šåˆ¶TPOTåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­æœç´¢çš„æ“ä½œç¬¦å’Œå‚æ•°çš„é…ç½®å­—å…¸ã€‚</p>
</li>
<li><p>warm_start: boolean, optional (default=False)ï¼Œè¡¨æ˜TPOTå®ä¾‹æ˜¯å¦ä¼šé‡ç”¨ä»¥å‰è°ƒç”¨fitï¼ˆï¼‰çš„å…¥å£ã€‚</p>
</li>
<li><p>early_stop: integer, optional (default: None)</p>
</li>
<li><p>verbosity: integer, optional (default=0)ï¼Œ<br>0ï¼ŒTPOTå°†ä¸ä¼šæ‰“å°ä»»ä½•ä¸œè¥¿ï¼Œ<br>1ï¼Œå°†æ‰“å°å¾ˆå°‘çš„ä¿¡æ¯ï¼Œ<br>2ï¼ŒTPOTå°†ä¼šæ‰“å°æ›´å¤šçš„ä¿¡æ¯å¹¶æä¾›ä¸€ä¸ªè¿›åº¦æ¡<br>3ï¼ŒTPOTå°†æ‰“å°æ‰€æœ‰å†…å®¹ï¼Œå¹¶æä¾›ä¸€ä¸ªè¿›åº¦æ¡</p>
</li>
</ul>
<p>æ–¹æ³•ï¼š</p>
<ul>
<li>fit(features, target, sample_weight=None, groups=None)ï¼Œåœ¨ç»™å®šçš„è®­ç»ƒæ•°æ®ä¸Šè¿è¡ŒTPOTä¼˜åŒ–è¿‡ç¨‹ã€‚</li>
<li>predict(features)ï¼Œä½¿ç”¨ä¼˜åŒ–çš„ç®¡é“æ¥é¢„æµ‹æµ‹è¯•é›†çš„ç›®æ ‡å€¼ã€‚</li>
<li>score(testing_features, testing_target)ï¼Œä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„è¯„åˆ†å‡½æ•°åœ¨ç»™å®šçš„æµ‹è¯•æ•°æ®ä¸Šè¿”å›ä¼˜åŒ–çš„ç®¡é“çš„å¾—åˆ†ã€‚</li>
<li>export(output_file_name)ï¼Œå°†ä¼˜åŒ–çš„ç®¡é“å¯¼å‡ºä¸ºPythonä»£ç ã€‚</li>
</ul>
<h2 id="4-å®ä¾‹"><a href="#4-å®ä¾‹" class="headerlink" title="4.å®ä¾‹"></a>4.å®ä¾‹</h2><h3 id="ä¾‹4-1"><a href="#ä¾‹4-1" class="headerlink" title="ä¾‹4.1"></a>ä¾‹4.1</h3><p>æ•°æ®é›†åœ°å€ï¼š<a href="https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/" target="_blank" rel="noopener external nofollow noreferrer">https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/</a></p>
<p>ä½¿ç”¨çš„æ•°æ®é›†ï¼šbreast-cancer-wisconsin.data<br>ç›´æ¥æŠŠæ•°æ®å…¨é€‰å¤åˆ¶åˆ°txtä¸­ï¼Œç„¶åç›´æ¥æ”¹æ–‡ä»¶åç¼€ä¸ºcsvï¼ŒæŠŠæ–‡ä»¶è½¬æ¢ä¸ºcsvæ ¼å¼ã€‚å¹¶åŠ ä¸Šå±æ€§å</p>
<p><img src="/2020/03/31/TPOT%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84Python%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/4.png" alt></p>
<p>ç¨‹åºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#-*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">ä½¿ç”¨TPOTè‡ªåŠ¨é€‰æ‹©scikit-learnæœºå™¨å­¦ä¹ æ¨¡å‹å’Œå‚æ•°</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">from</span> tpot <span class="keyword">import</span> TPOTClassifier</span><br><span class="line"> </span><br><span class="line">inputfile=<span class="string">'C:/Users/bryce/Desktop/breast-cancer-wisconsin.data.csv'</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    df=pd.read_csv(inputfile)</span><br><span class="line">    <span class="comment">#print(df.head())</span></span><br><span class="line">    df.replace(<span class="string">'?'</span>,np.nan,inplace=<span class="literal">True</span>)</span><br><span class="line">    df.dropna(inplace=<span class="literal">True</span>)</span><br><span class="line">    df.drop([<span class="string">'id'</span>],<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment">#print(df.head())</span></span><br><span class="line">    df[<span class="string">'Bare Nuclei'</span>] = df[<span class="string">'Bare Nuclei'</span>].astype(int)</span><br><span class="line">    X=np.array(df.drop([<span class="string">'Class'</span>],<span class="number">1</span>))</span><br><span class="line">    Y=np.array(df[<span class="string">'Class'</span>])</span><br><span class="line">    x_train,x_test,y_train,y_test=model_selection.train_test_split(X,Y,test_size=<span class="number">0.2</span>)</span><br><span class="line">    tpot=TPOTClassifier(generations=<span class="number">6</span>,verbosity=<span class="number">2</span>)</span><br><span class="line">    tpot.fit(x_train,y_train)</span><br><span class="line">    tpot.score(x_test,y_test)</span><br><span class="line">    tpot.export(<span class="string">'pipeline.py'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/31/TPOT%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84Python%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/5.png" alt></p>
<p>å¯ä»¥çœ‹åˆ°è¿è¡Œçš„æœ€ä¼˜ç»“æœæ˜¯éšæœºæ£®æ—ç®—æ³•,å¹¶ç»™å‡ºå…·ä½“çš„å‚æ•°ã€‚<br>å†è¿è¡Œä¸€ä¸‹éšæœºæ£®æ—ç®—æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#-*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">ä½¿ç”¨TPOTè‡ªåŠ¨é€‰æ‹©scikit-learnæœºå™¨å­¦ä¹ æ¨¡å‹å’Œå‚æ•°</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">from</span> tpot <span class="keyword">import</span> TPOTClassifier</span><br><span class="line"> </span><br><span class="line">inputfile=<span class="string">'C:/Users/bryce/Desktop/breast-cancer-wisconsin.data.csv'</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    df=pd.read_csv(inputfile)</span><br><span class="line">    <span class="comment">#print(df.head())</span></span><br><span class="line">    df.replace(<span class="string">'?'</span>,np.nan,inplace=<span class="literal">True</span>)</span><br><span class="line">    df.dropna(inplace=<span class="literal">True</span>)</span><br><span class="line">    df.drop([<span class="string">'id'</span>],<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">    df[<span class="string">'Bare Nuclei'</span>] = df[<span class="string">'Bare Nuclei'</span>].astype(int)</span><br><span class="line">    <span class="comment">#print(df.head())</span></span><br><span class="line">    X=np.array(df.drop([<span class="string">'Class'</span>],<span class="number">1</span>))</span><br><span class="line">    Y=np.array(df[<span class="string">'Class'</span>])</span><br><span class="line">    x_train,x_test,y_train,y_test=model_selection.train_test_split(X,Y,test_size=<span class="number">0.2</span>)</span><br><span class="line">    <span class="comment"># tpot=TPOTClassifier(generations=6,verbosity=2)</span></span><br><span class="line">    <span class="comment"># tpot.fit(x_train,y_train)</span></span><br><span class="line">    <span class="comment"># tpot.score(x_test,y_test)</span></span><br><span class="line">    <span class="comment"># tpot.export('pipeline.py')</span></span><br><span class="line"> </span><br><span class="line">    rfc=RandomForestClassifier(bootstrap=<span class="literal">True</span>, criterion=<span class="string">'entropy'</span>, max_features=<span class="number">0.05</span>, min_samples_leaf=<span class="number">3</span>, min_samples_split=<span class="number">16</span>, n_estimators=<span class="number">100</span>)</span><br><span class="line">    rfc.fit(x_train,y_train)</span><br><span class="line">    accuracy=rfc.score(x_test,y_test)</span><br><span class="line">    print(<span class="string">"accuracy:%s"</span>%accuracy)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/31/TPOT%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84Python%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/6.png" alt></p>
<h3 id="ä¾‹4-2"><a href="#ä¾‹4-2" class="headerlink" title="ä¾‹4.2"></a>ä¾‹4.2</h3><p>æ•°æ®é›†ï¼šsklearnè‡ªå¸¦çš„æ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†</p>
<h2 id="5-å‚è€ƒæ–‡çŒ®"><a href="#5-å‚è€ƒæ–‡çŒ®" class="headerlink" title="5. å‚è€ƒæ–‡çŒ®"></a>5. å‚è€ƒæ–‡çŒ®</h2><ol>
<li><a href="https://epistasislab.github.io/tpot/examples/" target="_blank" rel="noopener external nofollow noreferrer">TPOTå®˜æ–¹å‚è€ƒæ–‡æ¡£</a></li>
<li><a href="https://github.com/EpistasisLab/tpot" target="_blank" rel="noopener external nofollow noreferrer">TPOTgithub</a></li>
<li><a href="https://blog.csdn.net/anshuai_aw1/article/details/82498947" target="_blank" rel="noopener external nofollow noreferrer">åˆ©ç”¨TPOTå®Œæˆè‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ </a></li>
</ol>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸è§æ’åºç®—æ³•</title>
    <url>/2020/03/31/%E5%B8%B8%E8%A7%81%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h2><p>æ•´ç†ä¸€äº›å¸¸è§çš„å…­å¤§åŸºç¡€æ’åºç®—æ³•ï¼š å†’æ³¡æ’åºã€é€‰æ‹©æ’åºã€<strong>æ’å…¥æ’åº</strong>ã€<strong>å½’å¹¶æ’åº</strong>ã€<strong>å¿«é€Ÿæ’åº</strong>ã€<strong>å †æ’åº</strong></p>
<p><img src="/2020/03/31/%E5%B8%B8%E8%A7%81%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/sort_summary.jpg" alt></p>
<a id="more"></a>

<h3 id="1-å†’æ³¡æ’åº"><a href="#1-å†’æ³¡æ’åº" class="headerlink" title="1. å†’æ³¡æ’åº"></a>1. å†’æ³¡æ’åº</h3><h4 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1. æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚</span></span><br><span class="line"><span class="comment">    2. å¯¹ç¬¬0ä¸ªåˆ°ç¬¬n-1ä¸ªæ•°æ®åšåŒæ ·çš„å·¥ä½œã€‚è¿™æ—¶ï¼Œæœ€å¤§çš„æ•°å°±â€œæµ®â€åˆ°äº†æ•°ç»„æœ€åçš„ä½ç½®ä¸Šã€‚</span></span><br><span class="line"><span class="comment">    3. é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åå·²ç»é€‰å‡ºçš„å…ƒç´ ï¼ˆæœ‰åºï¼‰ã€‚</span></span><br><span class="line"><span class="comment">    4. æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒ.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¨³å®šæ’åºï¼Œå¹³å‡ O(n**2)ï¼Œæœ€å¥½ O(n), æœ€å·® O(n**2),è¾…åŠ©ç©ºé—´ O(1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BubbleSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (n==<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;n<span class="number">-1</span>-i;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &gt; nums[j+<span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// swap(nums[j], nums[j+1]);</span></span><br><span class="line">                <span class="keyword">int</span> temp = nums[j];</span><br><span class="line">                nums[j] = nums[j+<span class="number">1</span>];</span><br><span class="line">                nums[j+<span class="number">1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-é€‰æ‹©æ’åº"><a href="#2-é€‰æ‹©æ’åº" class="headerlink" title="2. é€‰æ‹©æ’åº"></a>2. é€‰æ‹©æ’åº</h3><p><img src="https://www.runoob.com/wp-content/uploads/2019/03/selectionSort.gif" alt></p>
<h4 id="ä»£ç ï¼š-1"><a href="#ä»£ç ï¼š-1" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1. åœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ã€‚</span></span><br><span class="line"><span class="comment">    2. å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚</span></span><br><span class="line"><span class="comment">    3. ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ç¨³å®šæ’åºï¼Œå¹³å‡ O(n**2)ï¼Œæœ€å¥½ O(n**2), æœ€å·® O(n**2),è¾…åŠ©ç©ºé—´ O(1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SelectSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (n==<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> idx = i;</span><br><span class="line">        <span class="comment">//æ¯ä¸€è¶Ÿå¾ªç¯æ¯”è¾ƒæ—¶ï¼Œidxç”¨äºå­˜æ”¾è¾ƒå°å…ƒç´ çš„æ•°ç»„ä¸‹æ ‡ï¼Œ</span></span><br><span class="line">        <span class="comment">//è¿™æ ·å½“å‰æ‰¹æ¬¡æ¯”è¾ƒå®Œæ¯•æœ€ç»ˆå­˜æ”¾çš„å°±æ˜¯æ­¤è¶Ÿå†…æœ€å°çš„å…ƒç´ </span></span><br><span class="line">        <span class="comment">//çš„ä¸‹æ ‡ï¼Œé¿å…æ¯æ¬¡é‡åˆ°è¾ƒå°å…ƒç´ éƒ½è¦è¿›è¡Œäº¤æ¢ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;n;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[idx] &gt; nums[j]);</span><br><span class="line">            &#123;</span><br><span class="line">                idx = j;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (idx !=i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> temp = nums[idx];</span><br><span class="line">                nums[idx] = nums[i];</span><br><span class="line">                nums[i] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ’å…¥æ’åºï¼ˆé‡è¦ï¼‰"><a href="#3-æ’å…¥æ’åºï¼ˆé‡è¦ï¼‰" class="headerlink" title="3. æ’å…¥æ’åºï¼ˆé‡è¦ï¼‰"></a>3. æ’å…¥æ’åºï¼ˆé‡è¦ï¼‰</h3><p><img src="https://www.runoob.com/wp-content/uploads/2019/03/insertionSort.gif" alt></p>
<h4 id="ä»£ç ï¼š-2"><a href="#ä»£ç ï¼š-2" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   ç›´æ¥æ’å…¥æ’åºåŸºæœ¬æ€æƒ³æ˜¯æ¯ä¸€æ­¥å°†ä¸€ä¸ªå¾…æ’åºçš„è®°å½•ï¼Œ</span></span><br><span class="line"><span class="comment">   æ’å…¥åˆ°å‰é¢å·²ç»æ’å¥½åºçš„æœ‰åºåºåˆ—ä¸­å»ï¼Œç›´åˆ°æ’å®Œæ‰€æœ‰å…ƒç´ ä¸ºæ­¢ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   1. ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åº</span></span><br><span class="line"><span class="comment">   2. å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æ</span></span><br><span class="line"><span class="comment">   3. å¦‚æœè¢«æ‰«æçš„å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ åç§»ä¸€ä½</span></span><br><span class="line"><span class="comment">   4. é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®</span></span><br><span class="line"><span class="comment">   5. å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®å</span></span><br><span class="line"><span class="comment">   6. é‡å¤æ­¥éª¤2~5</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¨³å®šæ’åºï¼Œå¹³å‡ O(n**2)ï¼Œæœ€å¥½ O(n), æœ€å·® O(n**2),è¾…åŠ©ç©ºé—´ O(1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InsertSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (n==<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// ä»ä¸‹æ ‡ä¸º1çš„å…ƒç´ å¼€å§‹é€‰æ‹©åˆé€‚çš„ä½ç½®æ’å…¥ï¼Œ</span></span><br><span class="line">    <span class="comment">// å› ä¸ºä¸‹æ ‡ä¸º0çš„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé»˜è®¤æ˜¯æœ‰åºçš„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è®°å½•è¦æ’å…¥çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">int</span> temp  = nums[i];</span><br><span class="line">        <span class="keyword">int</span> j = i- <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//ä¸å·²æ’åºçš„æ•°é€ä¸€æ¯”è¾ƒï¼Œå¤§äºtempæ—¶ï¼Œè¯¥æ•°ç§»å</span></span><br><span class="line">        <span class="keyword">while</span> (j&gt;=<span class="number">0</span>) &amp;&amp; (nums[j] &gt; nums[j])</span><br><span class="line">        &#123;</span><br><span class="line">            nums[j+<span class="number">1</span>] = nums[j];</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        nums[j+<span class="number">1</span>] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-å½’å¹¶æ’åºï¼ˆé‡è¦ï¼‰"><a href="#4-å½’å¹¶æ’åºï¼ˆé‡è¦ï¼‰" class="headerlink" title="4. å½’å¹¶æ’åºï¼ˆé‡è¦ï¼‰"></a>4. å½’å¹¶æ’åºï¼ˆé‡è¦ï¼‰</h3><p><img src="/2020/03/31/%E5%B8%B8%E8%A7%81%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/guibing1.png" alt><br><img src="/2020/03/31/%E5%B8%B8%E8%A7%81%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/guibing1.png" alt></p>
<h4 id="ä»£ç ï¼š-3"><a href="#ä»£ç ï¼š-3" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›</span></span><br><span class="line"><span class="comment">   å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚</span></span><br><span class="line"><span class="comment">   è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸ºäºŒè·¯å½’å¹¶ã€‚</span></span><br><span class="line"><span class="comment">   å½’å¹¶æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">1ã€ç¡®å®šæ•°ç»„çš„å¤§å°ï¼Œä»¥åŠè¾“å…¥æ•°ç»„ä¸­çš„å…ƒç´ å€¼ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2ã€å°†è¾“å…¥çš„æ•°ç»„è¿›è¡Œåˆ†ç»„å½’å¹¶ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3ã€å°†æ•´ä¸ªæ•°ç»„åˆ†æˆå·¦å³ä¸¤ä¸ªæ•°ç»„ï¼Œå·¦å³ä¸¤ä¸ªæ•°ç»„å†å‘ä¸‹åˆ†ï¼Œç›´è‡³å­æ•°ç»„çš„å…ƒç´ å°‘äº2ä¸ªæ—¶ï¼Œå­æ•°ç»„å°†åœæ­¢åˆ†å‰²ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4ã€å½“å·¦å³å­æ•°ç»„ä¸èƒ½å†åˆ†å‰²ï¼Œä¹Ÿæ˜¯éƒ½æ˜¯ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæ¯”è¾ƒä»–ä»¬çš„å¤§å°ï¼Œè¿›è¡Œæ’åºåˆå¹¶ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5ã€å†æ’åºåˆå¹¶ä¸Šä¸€çº§å­æ•°ç»„ä¸ºä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ¥ç€å†æ’åºåˆå¹¶ä¸Šä¸€çº§å­æ•°ç»„ä¸ºå››ä¸ªå…ƒç´ çš„æ•°ç»„ï¼›</span></span><br><span class="line"><span class="comment">ç›´è‡³åˆ°æ’åºåˆå¹¶åˆšå¼€å§‹çš„ä¸¤ä¸ªå­æ•°ç»„ï¼Œæœ€åæˆä¸ºæ’å¥½åºçš„æ•°ç»„ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¨³å®šæ’åºï¼Œå¹³å‡ O(nlogn)ï¼Œæœ€å¥½ O(nlogn), æœ€å·® O(nlogn),è¾…åŠ©ç©ºé—´ O(n)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums,<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function">Â Â  Â </span>&#123;</span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">int</span> temp[high+<span class="number">1</span>];</span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">int</span> mid=(low+high)/<span class="number">2</span>;</span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">int</span> i=<span class="number">0</span>; <span class="comment">//ä¸´æ—¶æ•°ç»„æŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">int</span> l=low;<span class="comment">//å·¦åºåˆ—æŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">int</span> r=mid+<span class="number">1</span>;<span class="comment">//å³åºåˆ—æŒ‡é’ˆ</span></span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">while</span>(l&lt;=mid&amp;&amp;r&lt;=high)</span><br><span class="line">Â Â  Â Â Â  Â &#123;</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â <span class="keyword">if</span>(nums[l]&lt;nums[r])</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â Â Â  Â temp[i++]=nums[l++];</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â <span class="keyword">else</span></span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â Â Â  Â temp[i++]=nums[r++];</span><br><span class="line">Â Â  Â Â Â  Â &#125;</span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">while</span>(l&lt;=mid) <span class="comment">//å°†å·¦è¾¹å‰©ä½™å…ƒç´ å¡«å……è¿›tempä¸­</span></span><br><span class="line">Â Â  Â Â Â  Â &#123;</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â temp[i++]=nums[l++];</span><br><span class="line">Â Â  Â Â Â  Â &#125;</span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">while</span>(r&lt;=high) <span class="comment">//å°†å³åºåˆ—å‰©ä½™å…ƒç´ å¡«å……è¿›tempä¸­</span></span><br><span class="line">Â Â  Â Â Â  Â &#123;</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â temp[i++]=nums[r++];</span><br><span class="line">Â Â  Â Â Â  Â &#125;</span><br><span class="line">Â Â  Â Â Â  Â i=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//å°†tempä¸­çš„å…ƒç´ å…¨éƒ¨æ‹·è´åˆ°åŸæ•°ç»„ä¸­</span></span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">while</span>(low&lt;=high)</span><br><span class="line">Â Â  Â Â Â  Â &#123;</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â nums[low++]=temp[i++];</span><br><span class="line">Â Â  Â Â Â  Â &#125;Â Â  Â </span><br><span class="line">Â Â  Â &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergesort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums,<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function">Â Â  Â </span>&#123;</span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">if</span>(low&lt;high)</span><br><span class="line">Â Â  Â Â Â  Â &#123;</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â <span class="keyword">int</span> mid=(low+high)/<span class="number">2</span>;</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â mergesort(nums,low,mid);  <span class="comment">//å·¦è¾¹å½’å¹¶æ’åºï¼Œä½¿å¾—å·¦å­åºåˆ—æœ‰åº</span></span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â mergesort(nums,mid+<span class="number">1</span>,high); <span class="comment">//å³è¾¹å½’å¹¶æ’åºï¼Œä½¿å¾—å³å­åºåˆ—æœ‰åº</span></span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â merge(nums,low,high); <span class="comment">//å°†ä¸¤ä¸ªæœ‰åºå­æ•°ç»„åˆå¹¶æ“ä½œ</span></span><br><span class="line">Â Â  Â Â Â  Â &#125;</span><br><span class="line">Â Â  Â &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-å¿«é€Ÿæ’åºï¼ˆé‡è¦ï¼‰"><a href="#5-å¿«é€Ÿæ’åºï¼ˆé‡è¦ï¼‰" class="headerlink" title="5. å¿«é€Ÿæ’åºï¼ˆé‡è¦ï¼‰"></a>5. å¿«é€Ÿæ’åºï¼ˆé‡è¦ï¼‰</h3><p><img src="https://www.runoob.com/wp-content/uploads/2019/03/quickSort.gif" alt></p>
<h4 id="ä»£ç ï¼š-4"><a href="#ä»£ç ï¼š-4" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1. ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†æ•°ã€‚</span></span><br><span class="line"><span class="comment">    2. é‡æ–°æ’åºæ•°åˆ—ï¼Œå°†æ¯”åŸºå‡†æ•°å¤§çš„æ”¾åˆ°å³è¾¹ï¼Œå°äºæˆ–ç­‰äºå®ƒçš„æ•°éƒ½æ”¾åˆ°å·¦è¾¹ã€‚</span></span><br><span class="line"><span class="comment">    3. å†å¯¹å·¦å³åŒºé—´é€’å½’æ‰§è¡Œç¬¬äºŒæ­¥ï¼Œç›´è‡³å„åŒºé—´åªæœ‰ä¸€ä¸ªæ•°ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ç¨³å®šæ’åºï¼Œå¹³å‡ O(nlogn)ï¼Œæœ€å¥½ O(nlogn), æœ€å·® O(n**2),è¾…åŠ©ç©ºé—´ O(logn)</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">Paritition</span> <span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> pivot = nums[low];</span><br><span class="line">   <span class="keyword">while</span> (low &lt; high)</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">while</span> (low &lt; high &amp;&amp; nums[high] &gt;= pivot)</span><br><span class="line">     &#123;</span><br><span class="line">       --high;</span><br><span class="line">     &#125;</span><br><span class="line">     nums[low] = nums[high];</span><br><span class="line">     <span class="keyword">while</span> (low &lt; high &amp;&amp; nums[low] &lt; pivot)</span><br><span class="line">     &#123;</span><br><span class="line">       ++low;</span><br><span class="line">     &#125;</span><br><span class="line">     nums[high] = nums[low];</span><br><span class="line">   &#125;</span><br><span class="line">   nums[low] = pivot;</span><br><span class="line">   <span class="keyword">return</span> low;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">QuickSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> <span class="comment">//å¿«æ’æ¯å‡½æ•°</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (low &lt; high)</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">int</span> i = Paritition(nums, low, high);</span><br><span class="line">     QuickSort(nums, low, i - <span class="number">1</span>);</span><br><span class="line">     QuickSort(nums, i + <span class="number">1</span>, high);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç²¾ç®€ç‰ˆ</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QuickSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(low &lt; high)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> l = low, r = high, pivot = nums[low];</span><br><span class="line">		<span class="keyword">while</span>(l&lt;r)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">while</span>(l&lt;r &amp;&amp; nums[r] &gt;=pivot) <span class="comment">// ä»å³å‘å·¦æ‰¾ç¬¬ä¸€ä¸ªå°äºåŸºå‡†çš„æ•°</span></span><br><span class="line">			&#123;</span><br><span class="line">			    r--;</span><br><span class="line">			&#125;</span><br><span class="line">			nums[l] = nums[r];</span><br><span class="line">			<span class="keyword">while</span>(l&lt;r &amp;&amp; nums[l] &lt; pivot) <span class="comment">// ä»å·¦å‘å³æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºåŸºå‡†çš„æ•°</span></span><br><span class="line">			&#123;</span><br><span class="line">			    l++;</span><br><span class="line">			&#125;</span><br><span class="line">			nums[r] = nums[l];</span><br><span class="line">		&#125;</span><br><span class="line">		nums[l] = pivot;</span><br><span class="line">		quick_sort(nums, low, l<span class="number">-1</span>);</span><br><span class="line">		quick_sort(nums, l+<span class="number">1</span>, high);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-å †æ’åºï¼ˆé‡è¦ï¼‰"><a href="#6-å †æ’åºï¼ˆé‡è¦ï¼‰" class="headerlink" title="6. å †æ’åºï¼ˆé‡è¦ï¼‰"></a>6. å †æ’åºï¼ˆé‡è¦ï¼‰</h3><p><img src="https://www.runoob.com/wp-content/uploads/2019/03/quickSort.gif" alt></p>
<h4 id="ä»£ç ï¼š-5"><a href="#ä»£ç ï¼š-5" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å †æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå°†å¾…æ’åºåºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †ï¼Œ</span></span><br><span class="line"><span class="comment">æ­¤æ—¶ï¼Œæ•´ä¸ªåºåˆ—çš„æœ€å¤§å€¼å°±æ˜¯å †é¡¶çš„æ ¹èŠ‚ç‚¹ã€‚å°†å…¶ä¸æœ«</span></span><br><span class="line"><span class="comment">å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œæ­¤æ—¶æœ«å°¾å°±ä¸ºæœ€å¤§å€¼ã€‚ç„¶åå°†å‰©ä½™n-1</span></span><br><span class="line"><span class="comment">ä¸ªå…ƒç´ é‡æ–°æ„é€ æˆä¸€ä¸ªå †ï¼Œè¿™æ ·ä¼šå¾—åˆ°nä¸ªå…ƒç´ çš„æ¬¡å°å€¼ã€‚</span></span><br><span class="line"><span class="comment">å¦‚æ­¤åå¤æ‰§è¡Œï¼Œä¾¿èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—äº†</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  1.å°†æ— éœ€åºåˆ—æ„å»ºæˆä¸€ä¸ªå †ï¼Œæ ¹æ®å‡åºé™åºéœ€æ±‚é€‰æ‹©å¤§é¡¶å †æˆ–å°é¡¶å †;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ã€€2.å°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œå°†æœ€å¤§å…ƒç´ "æ²‰"åˆ°æ•°ç»„æœ«ç«¯;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ã€€3.é‡æ–°è°ƒæ•´ç»“æ„ï¼Œä½¿å…¶æ»¡è¶³å †å®šä¹‰ï¼Œç„¶åç»§ç»­äº¤æ¢å †é¡¶å…ƒç´ ä¸</span></span><br><span class="line"><span class="comment">  å½“å‰æœ«å°¾å…ƒç´ ï¼Œåå¤æ‰§è¡Œè°ƒæ•´+äº¤æ¢æ­¥éª¤ï¼Œç›´åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ç¨³å®šæ’åºï¼Œå¹³å‡ O(nlogn)ï¼Œæœ€å¥½ O(nlogn), æœ€å·® O(n**2),è¾…åŠ©ç©ºé—´ O(1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">adjustHeap</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums,<span class="keyword">int</span> i,<span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = nums[i];<span class="comment">//å…ˆå–å‡ºå½“å‰å…ƒç´ i</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»iç»“ç‚¹çš„å·¦å­ç»“ç‚¹å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯2i+1å¤„å¼€å§‹</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k=i*<span class="number">2</span>+<span class="number">1</span>;k&lt;length;k=k*<span class="number">2</span>+<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå·¦å­ç»“ç‚¹å°äºå³å­ç»“ç‚¹ï¼ŒkæŒ‡å‘å³å­ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(k+<span class="number">1</span>&lt;length &amp;&amp; nums[k]&lt;nums[k+<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[k] &gt;temp)</span><br><span class="line">        <span class="comment">//å¦‚æœå­èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œå°†å­èŠ‚ç‚¹å€¼èµ‹ç»™çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">//ï¼ˆä¸ç”¨è¿›è¡Œäº¤æ¢ï¼‰</span></span><br><span class="line">        &#123;</span><br><span class="line">            nums[i] = nums[k];</span><br><span class="line">            i = k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    nums[i] = temp;    <span class="comment">//å°†tempå€¼æ”¾åˆ°æœ€ç»ˆçš„ä½ç½®</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HeapSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums,<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.æ„å»ºå¤§é¡¶å †</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=len/<span class="number">2</span><span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//ä»ç¬¬ä¸€ä¸ªéå¶å­ç»“ç‚¹ä»ä¸‹è‡³ä¸Šï¼Œä»å³è‡³å·¦è°ƒæ•´ç»“æ„</span></span><br><span class="line">        adjustHeap(nums,i,len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.è°ƒæ•´å †ç»“æ„+äº¤æ¢å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=len<span class="number">-1</span>;j&gt;<span class="number">0</span>;j--)</span><br><span class="line">    &#123;</span><br><span class="line">        swap(nums[<span class="number">0</span>],nums[j]);</span><br><span class="line">        <span class="comment">//å°†å †é¡¶å…ƒç´ (æœ€å¤§å€¼)ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œ</span></span><br><span class="line">        <span class="comment">//å°†æœ€å¤§å€¼äº¤æ¢åˆ°æ•°ç»„çš„æœ€åä½ç½®ä¿å­˜</span></span><br><span class="line">        adjustHeap(nums,<span class="number">0</span>,j);<span class="comment">//é‡æ–°å¯¹å †è¿›è¡Œè°ƒæ•´</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>æ³µç«™æœºç»„æ•…éšœè¯Šæ–­</title>
    <url>/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/</url>
    <content><![CDATA[<h3 id="æ•…éšœè¯Šæ–­ç³»ç»Ÿæ¦‚è¿°"><a href="#æ•…éšœè¯Šæ–­ç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="æ•…éšœè¯Šæ–­ç³»ç»Ÿæ¦‚è¿°"></a>æ•…éšœè¯Šæ–­ç³»ç»Ÿæ¦‚è¿°</h3><p>ç ”ç©¶çš„åŸºäºè‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ çš„æ•…éšœè¯Šæ–­ç³»ç»Ÿæ—¢å…·æœ‰æ•…éšœè¯Šæ–­ç®—æ³•è®­ç»ƒåŠŸèƒ½ï¼Œä¹Ÿå…·æœ‰ç®—æ³•éƒ¨ç½²åŠŸèƒ½ã€‚å®ƒä¼šè¯»å–æ•…éšœæ•°æ®ï¼Œè¿›è¡Œç‰¹å¾æå–ï¼Œç„¶åä½¿ç”¨è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ æ–¹æ³•æ‰¾å‡ºæœ€ä¼˜æœºå™¨å­¦ä¹ æµç¨‹ï¼Œå¹¶å°†è¯¥æµç¨‹è®­ç»ƒå¥½ä¿å­˜ä¸‹æ¥ï¼Œæœ€åä½¿ç”¨WebæœåŠ¡å™¨å¯¹æ•…éšœè¯Šæ–­ç®—æ³•è¿›è¡Œéƒ¨ç½²ã€‚æ‰€ç ”ç©¶çš„æ•…éšœè¯Šæ–­ç³»ç»Ÿå…·æœ‰é«˜åº¦è‡ªåŠ¨åŒ–ã€åŠŸèƒ½æ‹“å±•æ–¹ä¾¿ã€æ¨¡å‹æ›´æ–°æ–¹ä¾¿çš„ç‰¹ç‚¹ã€‚</p>
<a id="more"></a>
<p>æœ¬ç³»ç»Ÿç”±ä»¥ä¸‹å‡ ä¸ªå­éƒ¨åˆ†æ„æˆï¼š</p>
<p>ï¼ˆ1ï¼‰ç³»ç»Ÿè¿è¡Œæ—¥å¿—ã€‚æ—¥å¿—æ˜¯å¯¹ç³»ç»Ÿè¿è¡ŒçŠ¶æ€çš„è®°å½•ï¼Œå®ƒå¯ä»¥å¸®åŠ©æ£€éªŒç³»ç»Ÿè¿è¡Œæ˜¯å¦æ­£å¸¸ï¼Œåœ¨å‡ºç°å¼‚å¸¸æƒ…å†µæ—¶å¯ä»¥å¸®åŠ©ä½¿ç”¨è€…å¿«é€ŸæŸ¥æ‰¾é”™è¯¯ã€‚æ—¥å¿—çš„è®°å½•æ˜¯åˆ†çº§åˆ«çš„ï¼Œä¸€èˆ¬åˆ†ä¸ºDEBUGã€INFOã€WARNINGã€ERRORã€CRITICAL äº”ä¸ªçº§åˆ«ï¼Œè¿™äº”ä¸ªçº§åˆ«çš„ä¸¥é‡ç¨‹åº¦è¶Šæ¥è¶Šé«˜ã€‚</p>
<p>ï¼ˆ2ï¼‰ç³»ç»Ÿé…ç½®æ–‡ä»¶ã€‚ç³»ç»Ÿé…ç½®æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œé€šè¿‡é…å¥—çš„æ–‡æœ¬è§£ææ–¹æ³•å¯ä»¥æå–å‡ºå˜é‡ååŠå…¶å¯¹åº”çš„è®¾å®šå€¼ã€‚ç³»ç»Ÿåœ¨ä¸»åŠŸèƒ½è¿è¡Œå‰è¯»å–é…ç½®æ–‡ä»¶ï¼Œä»è€Œè®¾å®šç¨‹åºçš„è¿è¡Œæ¨¡å¼æˆ–è®­ç»ƒä»»åŠ¡ï¼Œè¾¾åˆ°ä¸æ”¹å˜ä»£ç å°±å¯ä»¥æ”¹å˜ç¨‹åºè¿è¡Œçš„æ•ˆæœã€‚</p>
<p>ï¼ˆ3ï¼‰æ•…éšœæ ·æœ¬æ•°æ®åº“ã€‚æ‰€ç ”ç©¶çš„æ•…éšœè¯Šæ–­ç®—æ³•æ˜¯åŸºäºæœºå™¨å­¦ä¹ çš„ï¼Œè€Œæœºå™¨å­¦ä¹ æ–¹æ³•æ˜¯ç”±æ•°æ®é©±åŠ¨çš„ï¼Œå› æ­¤ä¸€ä¸ªæ•…éšœæ ·æœ¬æ•°æ®åº“æ˜¯å¿…è¦çš„ã€‚ç”±äºæœ¬æ–‡ç ”ç©¶å¯¹è±¡æ³µç«™æœºç»„å…·æœ‰å‹å·å¤šã€è¿è¡Œå·¥å†µå¤æ‚çš„ç‰¹ç‚¹ï¼Œæ•…éšœæ ·æœ¬æ•°æ®åº“åœ¨è®¾è®¡çš„æ—¶å€™å……åˆ†è€ƒè™‘äº†è¿™äº›ç‰¹ç‚¹ã€‚</p>
<p>ï¼ˆ4ï¼‰æ ·æœ¬å¹³è¡¡æ€§æ£€éªŒã€‚åœ¨ç”¨æ•°æ®è¿›è¡Œè®­ç»ƒä¹‹å‰ï¼Œåº”è¯¥å¯¹æ ·æœ¬å¹³è¡¡æ€§è¿›è¡Œæ£€éªŒï¼Œæ ·æœ¬æ•°é‡æ¯”è¾ƒå°‘çš„åšä¸€äº›ç‰¹æ®Šå¤„ç†ï¼Œæ ·æœ¬æ•°é‡å¤ªå°‘çš„åº”ä»è®­ç»ƒé›†é‡Œäºˆä»¥å‰”é™¤ï¼Œæ›´å¤±è¡¡ä¸¥é‡çš„å°±ç»ˆæ­¢æœ¬æ¬¡è®­ç»ƒï¼Œç­‰å¾…æ•°æ®æ”¶é›†å®Œæ¯•åå†å¼€å§‹ã€‚</p>
<p>ï¼ˆ5ï¼‰æ•…éšœç‰¹å¾æå–ã€‚ä»æ•…éšœæ•°æ®åº“è·å¾—çš„æ•°æ®æ˜¯ä¼ æ„Ÿå™¨æ•°æ®ï¼Œè€Œä¼ æ„Ÿå™¨æ•°æ®æ˜¯æ— æ³•ç›´æ¥ä½œä¸ºæœºå™¨å­¦ä¹ ç®—æ³•è¾“å…¥çš„ã€‚ä¸ºäº†æé«˜æ•…éšœè¯Šæ–­ç®—æ³•çš„æ•ˆæœï¼Œåº”è¯¥å…ˆå¯¹æ•°æ®åº“ä¸­ä¼ æ„Ÿå™¨æ•°æ®ä½¿ç”¨å¿«é€Ÿå‚…é‡Œå¶å˜æ¢è¿›è¡Œé¢„å¤„ç†ã€‚</p>
<p>ï¼ˆ6ï¼‰ä½¿ç”¨TPOTè¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚é‡‡ç”¨åŸºäºé—ä¼ ç®—æ³•çš„è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ æ–¹æ³•TPOTæ˜¯ä½¿ç”¨é—ä¼ ç®—æ³•å¯¹ç‰¹å¾å½’ä¸€åŒ–ã€ç‰¹å¾é€‰æ‹©ã€æ¨¡å‹å’Œå‚æ•°é€‰æ‹©ç­‰ç¯èŠ‚ç»„æˆçš„æœºå™¨å­¦ä¹ æµç¨‹è¿›è¡Œè‡ªåŠ¨æ„å»ºå¹¶å¯»ä¼˜çš„æ–¹æ³•ã€‚</p>
<p>ï¼ˆ7ï¼‰æ•…éšœè¯Šæ–­æ¨¡å‹å·¥ç¨‹éƒ¨ç½²ã€‚æ‰€ç ”ç©¶çš„æ•…éšœè¯Šæ–­æ¨¡å‹å·¥ç¨‹éƒ¨ç½²æ–¹æ³•æ˜¯åŸºäºPythonè½»å‹WebæœåŠ¡å™¨æ¡†æ¶Flaské€šè¿‡HTTPåè®®å®ç°Pythonç¯å¢ƒä¸Javaç¯å¢ƒçš„äº¤äº’ã€‚</p>
<p>æ•…éšœè¯Šæ–­ç³»ç»Ÿå·¥ä½œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/liucheng1.png" alt></p>
<h3 id="æ•…éšœè¯Šæ–­ç³»ç»Ÿç ”ç©¶"><a href="#æ•…éšœè¯Šæ–­ç³»ç»Ÿç ”ç©¶" class="headerlink" title="æ•…éšœè¯Šæ–­ç³»ç»Ÿç ”ç©¶"></a>æ•…éšœè¯Šæ–­ç³»ç»Ÿç ”ç©¶</h3><h4 id="æ•…éšœæ•°æ®åº“è®¾è®¡è§„èŒƒ"><a href="#æ•…éšœæ•°æ®åº“è®¾è®¡è§„èŒƒ" class="headerlink" title="æ•…éšœæ•°æ®åº“è®¾è®¡è§„èŒƒ"></a>æ•…éšœæ•°æ®åº“è®¾è®¡è§„èŒƒ</h4><p>åœ¨æ³µç«™æœºç»„å‹å·æˆ–è¿è¡Œå·¥å†µä¸ä¸€æ ·çš„æƒ…å†µä¸‹ï¼Œè™½ç„¶æœºç»„å‘ç”Ÿäº†åŒä¸€ç§æ•…éšœç±»å‹ï¼Œä½†åŒæ ·ä½ç½®çš„ä¼ æ„Ÿå™¨æ•°æ®ä¼šæœ‰æ‰€ä¸åŒï¼Œè¿™å°±å¯¼è‡´æå–çš„ç‰¹å¾ä¹Ÿæœ‰ç‚¹ä¸åŒã€‚å› æ­¤ï¼Œåœ¨æ•…éšœæ•°æ®å­˜å‚¨æ—¶å¿…é¡»è¦ä½“ç°å‡ºæ•…éšœæ ·æœ¬çš„æ¥æºèƒŒæ™¯ï¼Œè¿™é‡Œç”¨æœºç»„å‹å·å’Œè¿è¡Œå·¥å†µæ¥è¡¨ç¤ºã€‚</p>
<p>ä»¥æœºç»„æŸä¸ªéƒ¨ä»¶æœ‰ä¸¤ä¸ªä¼ æ„Ÿå™¨ä¸ºä¾‹è®¾è®¡çš„æ•…éšœæ•°æ®åº“è§„èŒƒå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/shujuku1.png" alt></p>
<h4 id="æ•…éšœæ ·æœ¬ä¸å¹³è¡¡å¤„ç†"><a href="#æ•…éšœæ ·æœ¬ä¸å¹³è¡¡å¤„ç†" class="headerlink" title="æ•…éšœæ ·æœ¬ä¸å¹³è¡¡å¤„ç†"></a>æ•…éšœæ ·æœ¬ä¸å¹³è¡¡å¤„ç†</h4><h5 id="æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è®­ç»ƒæ–¹æ³•"><a href="#æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è®­ç»ƒæ–¹æ³•" class="headerlink" title="æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è®­ç»ƒæ–¹æ³•"></a>æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è®­ç»ƒæ–¹æ³•</h5><p>é’ˆå¯¹æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è®­ç»ƒæ•°æ®é›†é‡‡ç”¨ç®€å•æ˜“è¡Œçš„è°ƒæ•´ç±»çš„æƒé‡æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯åœ¨è¯¯å·®å‡½æ•°é‡Œæ·»åŠ ç±»åˆ«æƒé‡ï¼Œä»¥è¾¾åˆ°è¯¯å·®å¹³è¡¡ï¼Œå¸¦æƒé‡çš„è¯¯å·®å‡½æ•°ä¸ºï¼š</p>
<p>$$<br>\text { error }=\frac{\sum_{i=1}^{n} w_{i}\left(y_{i}^{\prime}-y_{i}\right)^{2}}{n}<br>$$</p>
<p>å…¶ä¸­ï¼š</p>
<p>$ğ‘›$ ä»£è¡¨æ ·æœ¬æ€»æ•°ï¼›</p>
<p>$ğ‘¤_ğ‘–$ ä»£è¡¨ç¬¬$i$ä¸ªæ ·æœ¬æ‰€åœ¨ç±»åˆ«çš„æƒé‡ï¼›</p>
<p>$y_{i}^{\prime}$ä»£è¡¨ç¬¬$i$ä¸ªæ ·æœ¬çš„é¢„æµ‹ç»“æœï¼›</p>
<p>$ğ‘¦_ğ‘–$ä»£è¡¨ç¬¬$i$ä¸ªæ ·æœ¬çš„å®é™…ç»“æœã€‚</p>
<h5 id="æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è¯„ä¼°æ–¹æ³•"><a href="#æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è¯„ä¼°æ–¹æ³•" class="headerlink" title="æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è¯„ä¼°æ–¹æ³•"></a>æ ·æœ¬ä¸å¹³è¡¡ä¸‹çš„è¯„ä¼°æ–¹æ³•</h5><p>åœ¨ç»Ÿè®¡å’Œæœºå™¨å­¦ä¹ ä¸­ï¼Œå¸¸å¸¸ç”¨AUC æ¥è¯„ä¼°äºŒåˆ†ç±»æ¨¡å‹çš„æ€§èƒ½ï¼ˆå¤šåˆ†ç±»ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½œä¸ºäºŒåˆ†ç±»çš„æ‹“å±•ï¼‰ã€‚AUC çš„å…¨ç§°æ˜¯Area under the curveï¼Œå³æ›²çº¿ä¸‹çš„é¢ç§¯ã€‚é€šå¸¸è¿™é‡Œçš„æ›²çº¿æŒ‡çš„æ˜¯å—è¯•è€…æ“ä½œæ›²çº¿(Receiver Operating Characteristic,ROC)ã€‚ç›¸æ¯”äºå‡†ç¡®ç‡ã€å¬å›ç‡ã€F1 å€¼ç­‰ä¾èµ–äºåˆ¤å†³é˜ˆå€¼çš„è¯„ä¼°æŒ‡æ ‡ï¼ŒAUCåˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ROC æ›²çº¿ï¼š</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/ROC.jpg" alt></p>
<p>AUCå€¼ä¸ºROC æ›²çº¿ä¸‹æ–¹æ‰€è¦†ç›–çš„åŒºåŸŸé¢ç§¯ï¼ŒAUCè¶Šå¤§, è¯´æ˜æ›²çº¿è¶Šé è¿‘(0,1) è¿™ä¸ªç‚¹ï¼Œè¶Šæ¥è¿‘ç†æƒ³æ›²çº¿ï¼Œåˆ†ç±»æ•ˆæœè‡ªç„¶æ›´å¥½ã€‚</p>
<p>AUCæŒ‡æ ‡ä¸ºä»€ä¹ˆå¯ä»¥ä½œä¸ºæ ·æœ¬ä¸å¹³è¡¡æƒ…å†µä¸‹çš„æ¨¡å‹è¯„ä»·æŒ‡æ ‡ï¼Ÿå› ä¸ºå½“ç”¨æ¥éªŒè¯ç®—æ³•æ•ˆæœçš„æ•°æ®é›†ä¸­çš„æ ·æœ¬æ¯”ä¾‹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒROCæ›²çº¿çš„å½¢çŠ¶èƒ½å¤Ÿä¿æŒä¸å˜ï¼Œè€ŒAUCæ˜¯ROCæ›²çº¿çš„ä¸‹æ–¹é¢ç§¯ï¼Œæ‰€ä»¥å½“æ¨¡å‹ä¸€å®šæ—¶ï¼ŒAUCçš„å€¼ä¹Ÿä¸éšæ­£è´Ÿæ ·æœ¬åˆ†å¸ƒçš„å˜åŒ–è€Œå˜åŒ–ï¼Œæ‰€ä»¥èƒ½å¤Ÿä½œä¸ºä¸å¹³è¡¡æ•°æ®é›†çš„æ¨¡å‹è¯„ä»·æŒ‡æ ‡ã€‚</p>
<h4 id="æ•…éšœç‰¹å¾æå–"><a href="#æ•…éšœç‰¹å¾æå–" class="headerlink" title="æ•…éšœç‰¹å¾æå–"></a>æ•…éšœç‰¹å¾æå–</h4><p>æ³µè½´çš„å¸¸è§æ•…éšœæœ‰æ²¹è†œæ¶¡åŠ¨ã€æ¥è§¦æ‘©æ“¦ã€æ²¹è†œæŒ¯è¡ã€è½¬å­ä¸å¹³è¡¡å’Œè½¬å­ä¸å¯¹ä¸­ï¼Œè¿™äº›æ•…éšœéƒ½å¯ä»¥ä½“ç°åœ¨æ³µè½´çš„æŒ¯åŠ¨ä¿¡å·é‡Œï¼Œé€šå¸¸é‡‡ç”¨æ³µè½´çš„æ‘†åº¦æ•°å€¼ä½œä¸ºå®ƒçš„æŒ¯åŠ¨ä¿¡å·ã€‚é€šè¿‡åˆ©ç”¨FFTå¿«é€Ÿå‚…é‡Œå¶å˜æ¢å°†æ—¶åŸŸçš„æŒ¯åŠ¨ä¿¡å·è½¬æ¢ä¸ºé¢‘åŸŸçš„èƒ½é‡åˆ†å¸ƒã€‚</p>
<p>ä¸‹é¢å¯¹æ³µè½´çš„è½¬å­ä¸å¹³è¡¡æ•…éšœæ•°æ®è¿›è¡Œç‰¹å¾æå–å®éªŒï¼Œä»‹ç»å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰æ•°æ®æ¥æºä¼ æ„Ÿå™¨ï¼šæ³µè½´$Y$æ–¹å‘æ‘†åº¦ä¿¡å·</p>
<p>ï¼ˆ2ï¼‰æ•°æ®æ»¤æ³¢æ–¹æ³•ä¸çª—å‡½æ•°ï¼šå°æ³¢é˜ˆå€¼å»å™ªã€æ±‰å®çª—</p>
<p>ï¼ˆ3ï¼‰åŸºé¢‘$ğ¹_0$ã€é‡‡æ ·é¢‘ç‡$ğ¹_ğ‘ $å’Œé‡‡æ ·ç‚¹æ•°$ğ‘$ï¼š$20Hz$ã€$2048Hz$ã€$2048$ç”±ä¸Šé¢å‡ ä¸ªæ•°æ®ï¼Œå¯å¾—åˆ°ä¸‹é¢å‡ ä¸ªé¢‘è°±åˆ†æéœ€è¦çš„å‚æ•°ï¼š</p>
<p>ï¼ˆaï¼‰æœ€é«˜æœ‰æ•ˆé¢‘ç‡ğ¹ğ‘šï¼šğ¹ğ‘š = ğ¹ğ‘ /2.56=800Hz</p>
<p>ï¼ˆbï¼‰é¢‘ç‡åˆ†è¾¨ç‡ğ›¥ğ¹ ï¼šğ›¥ğ¹ = ğ¹ğ‘ /ğ‘=2048/2048=1Hz</p>
<p>ï¼ˆcï¼‰è°±çº¿æ•°ğ‘€ï¼šğ‘€ = ğ‘/2.56=2048/2.56=800</p>
<p>ä¸‹å›¾ä¸ºè½¬å­ä¸å¹³è¡¡æ•…éšœç‰¹å¾æå–è¿‡ç¨‹ã€‚</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/tezheng.jpg" alt></p>
<p>å›¾ä¸­å…±æœ‰ä¸‰ä¸ªå­å›¾ï¼Œå…¶ä¸­æœ€ä¸Šé¢çš„å›¾æ˜¯æ³µè½´æ‘†åº¦ä¿¡å·çš„æ—¶åŸŸå›¾ï¼Œè¡¨ç°å‡º<br>äº†å‘¨æœŸæ€§ï¼Œä¸­é—´å›¾æ˜¯å¯¹æ‘†åº¦ä¿¡å·çš„æ—¶åŸŸæ•°æ®ä½œå¿«é€Ÿå‚…ç«‹å¶å˜æ¢å¾—åˆ°çš„é¢‘è°±ï¼Œæœ€ä¸‹é¢å›¾æ˜¯ä»é¢‘è°±æå–çš„ç‰¹å¾å‘é‡ã€‚</p>
<h4 id="è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥å…·TPOT"><a href="#è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥å…·TPOT" class="headerlink" title="è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥å…·TPOT"></a>è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥å…·TPOT</h4><p><a href="/TPOTâ€”â€”ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Pythonæœºå™¨å­¦ä¹ å·¥å…·.md">æ­¤èŠ‚å…·ä½“å‚è€ƒè¿™é‡Œ</a></p>
<h4 id="è¯Šæ–­ç®—æ³•çš„éƒ¨ç½²"><a href="#è¯Šæ–­ç®—æ³•çš„éƒ¨ç½²" class="headerlink" title="è¯Šæ–­ç®—æ³•çš„éƒ¨ç½²"></a>è¯Šæ–­ç®—æ³•çš„éƒ¨ç½²</h4><p>è®¾ç½®WebæœåŠ¡å™¨ï¼Œé€šè¿‡HTTPåè®®è¿›è¡Œè°ƒç”¨ã€‚ç”Ÿäº§ç¯å¢ƒè½¯ä»¶é€šè¿‡ç½‘ç»œIPã€ç«¯å£å°†éœ€è¦è¯Šæ–­çš„æ•°æ®ä¼ é€’ç»™WebæœåŠ¡å™¨ã€‚WebæœåŠ¡å™¨æ¥å—åˆ°æ•°æ®åä¼šè¿›è¡Œè¯Šæ–­æœåŠ¡ï¼Œåœ¨è¯Šæ–­ç»“æŸåï¼Œè¯Šæ–­ç»“æœä¼šåŸè·¯è¿”å›ç»™æœåŠ¡è°ƒç”¨è€…ã€‚<br>è¯Šæ–­æ•°æ®ä¸Web æœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨HTTPåè®®è¿›è¡Œé€šä¿¡ï¼ŒHTTPåè®®ä¸‹æœ‰GETã€POSTã€PUT å’ŒDELETE ç­‰æ–¹æ³•ï¼Œå› ä¸ºé€šä¿¡è¿‡ç¨‹ä¸­éœ€è¦ä¼ è¾“ä¼ æ„Ÿå™¨æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨å¯æºå¸¦æ•°æ®ä½“çš„POSTæ–¹æ³•ã€‚</p>
<p>åœ¨æ•…éšœè¯Šæ–­çš„å„ä¸ªç¯èŠ‚ä¸­ï¼Œè¯Šæ–­ç®—æ³•å…·æœ‰â€œä¸€æ¬¡åŠ è½½ã€å¤šæ¬¡ä½¿ç”¨â€çš„ç‰¹ç‚¹ï¼Œè€Œç‰¹å¾æå–ã€ç®—æ³•è°ƒç”¨ç­‰æ­¥éª¤éšç€ä¼ è¾“æ•°æ®çš„ä¸åŒè€Œé‡‡ç”¨ä¸åŒçš„æ–¹æ³•ï¼Œæ‰€ä»¥æ•…éšœè¯Šæ–­WebæœåŠ¡å™¨åœ¨å®ç°æ—¶åº”è¯¥æŒ‰ç…§è¿™æ ·çš„æ–¹å¼ï¼šåŠ è½½è¯Šæ–­ç®—æ³•åœ¨åˆ›å»ºæ•…éšœè¯Šæ–­WebæœåŠ¡å™¨æ—¶è¿›è¡Œï¼Œæ•°æ®è·å–ã€ç‰¹å¾æå–ã€è°ƒç”¨è¯Šæ–­ç®—æ³•å’Œè¯Šæ–­ç»“æœè¿”å›è¿™äº›æ­¥éª¤åœ¨POSTæ–¹æ³•ä¸­å®ç°ã€‚</p>
<h3 id="æ•…éšœè¯Šæ–­ç³»ç»Ÿå…·ä½“å®ç°"><a href="#æ•…éšœè¯Šæ–­ç³»ç»Ÿå…·ä½“å®ç°" class="headerlink" title="æ•…éšœè¯Šæ–­ç³»ç»Ÿå…·ä½“å®ç°"></a>æ•…éšœè¯Šæ–­ç³»ç»Ÿå…·ä½“å®ç°</h3><h4 id="ç³»ç»Ÿå¼€å‘ç¯å¢ƒ"><a href="#ç³»ç»Ÿå¼€å‘ç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿå¼€å‘ç¯å¢ƒ"></a>ç³»ç»Ÿå¼€å‘ç¯å¢ƒ</h4><p>æ•…éšœè¯Šæ–­ç³»ç»Ÿæ˜¯åœ¨Windows 10ä¸Šä½¿ç”¨Pythonç¼–ç¨‹è¯­è¨€å¼€å‘çš„ï¼Œ<br>å…¶ä¸­æ•°æ®åº“ä½¿ç”¨SQL Serverï¼Œæ—¥å¿—ç®¡ç†ä½¿ç”¨Loggingï¼Œé…ç½®æ–‡ä»¶è§£æåŠ è½½ä½¿ç”¨Configparserï¼Œé¢‘åŸŸåˆ†æå·¥å…·åŒ…ä½¿ç”¨Scipyï¼ŒçŸ©é˜µæ•°æ®å¤„ç†ä½¿ç”¨Pandas å’ŒNumpyï¼Œè‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥å…·ä½¿ç”¨TPOTï¼Œæ¨¡å‹åºåˆ—åŒ–ä¿å­˜å·¥å…·ä½¿ç”¨Pickleï¼ŒWeb åº”ç”¨æ¡†æ¶ä½¿ç”¨Flaskã€‚</p>
<p>ä¸‹è¡¨æ˜¯è¯¦ç»†çš„æ•…éšœè¯Šæ–­ç³»ç»Ÿå¼€å‘ç¯å¢ƒã€‚</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/environment.png" alt></p>
<h4 id="ç³»ç»ŸåŠŸèƒ½æ¨¡å—çš„å®ç°"><a href="#ç³»ç»ŸåŠŸèƒ½æ¨¡å—çš„å®ç°" class="headerlink" title="ç³»ç»ŸåŠŸèƒ½æ¨¡å—çš„å®ç°"></a>ç³»ç»ŸåŠŸèƒ½æ¨¡å—çš„å®ç°</h4><h5 id="æ—¥å¿—ç®¡ç†"><a href="#æ—¥å¿—ç®¡ç†" class="headerlink" title="æ—¥å¿—ç®¡ç†"></a>æ—¥å¿—ç®¡ç†</h5><p>ç³»ç»Ÿæ—¥å¿—ç®¡ç†å·¥å…·ä½¿ç”¨Logging æ¨¡å—å®ç°ï¼Œå…·ä½“çš„æ˜¯ä½¿ç”¨äº†Logging ä¸‹çš„logger å¯¹è±¡ï¼Œä½¿ç”¨logger å¯¹è±¡å¯ä»¥é¿å…å¤šä¸ªç¨‹åºä½¿ç”¨åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶æ—¶äº§ç”Ÿé‡å¤è®°å½•çš„é—®é¢˜ã€‚ç³»ç»Ÿæ—¥å¿—ç®¡ç†å·¥å…·è¢«æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œæ–¹ä¾¿ä¸åŒä»»åŠ¡çš„å¤ç”¨ã€‚<a href="https://cuiqingcai.com/6080.html" target="_blank" rel="noopener external nofollow noreferrer">loggingæ¨¡å—çš„åŸºæœ¬ç”¨æ³•</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_logger</span><span class="params">()</span>:</span></span><br><span class="line">    logger = logging.getLogger(__name__)</span><br><span class="line">    logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">    stream_handler = logging.StreamHandler()</span><br><span class="line">    stream_handler.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">    file_handler = logging.FileHandler(filename=<span class="string">'æ—¥å¿—.log'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    file_handler.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">    formatter = logging.Formatter(fmt=<span class="string">'%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s'</span>)</span><br><span class="line"></span><br><span class="line">    stream_handler.setFormatter(formatter)</span><br><span class="line">    file_handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    logger.addHandler(stream_handler)</span><br><span class="line">    logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> logger</span><br></pre></td></tr></table></figure>

<h5 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><p>é…ç½®æ–‡ä»¶çš„æ ¼å¼æœ‰iniã€tomlã€yamlã€json å’Œxml ç­‰ï¼Œå…¶ä¸­iniæ ¼å¼çš„æœ€ä¸ºç®€å•ç›´è§‚ï¼Œè¿™é‡Œä½¿ç”¨çš„é…ç½®æ–‡ä»¶å°±æ˜¯iniæ ¼å¼.éƒ¨åˆ†é…ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/ini.jpg" alt></p>
<h4 id="å»ºç«‹æœºç»„æ•…éšœæ•°æ®åº“"><a href="#å»ºç«‹æœºç»„æ•…éšœæ•°æ®åº“" class="headerlink" title="å»ºç«‹æœºç»„æ•…éšœæ•°æ®åº“"></a>å»ºç«‹æœºç»„æ•…éšœæ•°æ®åº“</h4><p>åˆ©ç”¨æ•°æ®åº“SQL Server 2017 ä¸æ•°æ®åº“å¯è§†åŒ–ç®¡ç†å·¥å…·Navicat Premiumè¿›è¡Œæ­å»ºï¼Œé¦–å…ˆå‚è€ƒ<a href="https://www.cnblogs.com/ios9/p/9527939.html" target="_blank" rel="noopener external nofollow noreferrer">Win10 SQL Server 2017å®‰è£…</a>ï¼Œåˆ©ç”¨Navicatè¿›è¡Œåˆ›å»ºä¸€ä¸ªFaultsæ•°æ®åº“ï¼Œå¹¶åœ¨Faultsæ•°æ®åº“ä¸­åˆ›å»ºRotorè¡¨å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/guifan2.png" alt></p>
<p>ç„¶åæ ¹æ®æ•°æ®åº“è®¾è®¡è§„èŒƒï¼Œåœ¨è¡¨ä¸­åˆ›å»ºç›¸å¯¹åº”çš„å­—æ®µã€‚å¦‚å›¾æ‰€ç¤º:</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/guifan.png" alt></p>
<p><strong>æ³¨æ„ï¼š</strong> SQL Server 2017ä¸æ”¯æŒæ•°ç»„å½¢å¼ï¼Œè¿™é‡Œé‡‡ç”¨å°†æ•°ç»„è½¬åŒ–ä¸ºå­—ç¬¦ä¸²,å°†ä»–ä»¬æ‹¼æ¥èµ·æ¥å½“åšæ–‡æœ¬å†™å…¥ã€‚</p>
<p>å­—æ®µç±»å‹åœ¨è®¾ç½®çš„æ—¶å€™æ³¨æ„é‡‡ç”¨nvarchar(max)çš„ç±»å‹ï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/guifan3.png" alt></p>
<p><a href="https://data.mendeley.com/datasets/p9bsmj4xwg/1/files/9ecd3bf8-6ed0-452b-8c84-05a4833ac803" target="_blank" rel="noopener external nofollow noreferrer">Rotoræ•°æ®</a>, æ•°æ®æ˜¯.matæ–‡ä»¶ï¼Œåˆ©ç”¨Pythonå¤„ç†æ•°æ®åï¼Œå†™å…¥æ•°æ®åº“CGQ1è¿™ä¸€åˆ—ä¸­ï¼Œæœ€ç»ˆå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/guifan4.png" alt></p>
<h5 id="å¹³è¡¡æ€§æ£€éªŒ"><a href="#å¹³è¡¡æ€§æ£€éªŒ" class="headerlink" title="å¹³è¡¡æ€§æ£€éªŒ"></a>å¹³è¡¡æ€§æ£€éªŒ</h5><p>å¹³è¡¡æ€§æ£€éªŒå·¥å…·çš„å®ç°æ˜¯å…ˆä½¿ç”¨Pandas ç­›é€‰æ•°æ®ï¼Œç„¶åä½¿ç”¨Collectionsæ¨¡å—çš„Counter å·¥å…·è¿›è¡Œç»Ÿè®¡ã€‚</p>
<h5 id="æ•…éšœç‰¹å¾æå–-1"><a href="#æ•…éšœç‰¹å¾æå–-1" class="headerlink" title="æ•…éšœç‰¹å¾æå–"></a>æ•…éšœç‰¹å¾æå–</h5><p>æ•…éšœç‰¹å¾æå–å·¥å…·ä»¥ç‹¬ç«‹çš„ä»£ç æ–‡ä»¶å½¢å¼è¿›è¡Œå­˜æ”¾ï¼Œè¯¥å·¥å…·æ˜¯å¤šä¸ªç‰¹å¾æå–å‡½æ•°çš„é›†åˆï¼Œå¦‚æœæƒ³ä½¿ç”¨å“ªä¸ªç‰¹å¾æå–å‡½æ•°ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šå‡½æ•°åï¼Œå¦‚æœæƒ³ä½¿ç”¨çš„å‡½æ•°ä¸å­˜åœ¨ï¼Œæ¨¡ä»¿å·²æœ‰çš„å‡½æ•°ç¼–è¾‘æ·»åŠ å³å¯ã€‚é€šè¿‡è¿™æ ·çš„è®¾è®¡ï¼Œæ— éœ€æ›´æ”¹ä¸»å‡½æ•°å°±å¯æ”¹å˜ç³»ç»ŸåŠŸèƒ½ã€‚ç‰¹å¾æå–å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> scipy.fftpack <span class="keyword">import</span> fft</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transfer</span><span class="params">(string)</span>:</span></span><br><span class="line">    string_arr = string.split(<span class="string">','</span>)</span><br><span class="line">    <span class="comment">#print(string_arr)</span></span><br><span class="line">    float_arr = list(map(float, string_arr))</span><br><span class="line">    <span class="keyword">return</span> float_arr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotor_simple</span><span class="params">(arr, logger, conf=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(arr,dict):<span class="comment">#å¦‚æœæ•°æ®æ¥æºäºweb,  isinstance() å‡½æ•°æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ç±»å‹ï¼Œç±»ä¼¼ type()ã€‚</span></span><br><span class="line">        arr = trans(arr)</span><br><span class="line">    <span class="comment">#print(arr[1])</span></span><br><span class="line">    rotation_frequency = round(float(arr[<span class="number">0</span>])/<span class="number">60</span>) <span class="comment"># æ—‹è½¬é¢‘ç‡</span></span><br><span class="line">    sample_frequency = int(arr[<span class="number">1</span>]) <span class="comment"># é‡‡æ ·é¢‘ç‡</span></span><br><span class="line">    useful_bandwidth = int(sample_frequency/<span class="number">2.56</span>) <span class="comment"># æœ‰æ•ˆå¸¦å®½</span></span><br><span class="line">    <span class="keyword">if</span> useful_bandwidth&lt;rotation_frequency*<span class="number">6</span>:</span><br><span class="line">        logger.warning(<span class="string">'æ•°æ®é‡‡æ ·é¢‘ç‡è¿‡ä½ï¼æ•°æ®ä½œåºŸ'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    sensor_data = transfer(arr[<span class="number">3</span>]) <span class="comment"># å°†é€—å·æ‹¼æ¥çš„ä¼ æ„Ÿå™¨æ•°æ®å˜æˆæ•°ç»„</span></span><br><span class="line">    data_length = len(sensor_data) <span class="comment"># é‡‡æ ·é•¿åº¦</span></span><br><span class="line">    sample_time = data_length/sample_frequency <span class="comment"># é‡‡æ ·æ—¶é—´</span></span><br><span class="line">    frequency_resolution = <span class="number">1</span>/sample_time <span class="comment"># é¢‘ç‡åˆ†è¾¨ç‡</span></span><br><span class="line">    <span class="keyword">if</span> (rotation_frequency&lt;<span class="number">10</span> <span class="keyword">and</span> frequency_resolution&gt;<span class="number">0.1</span>) <span class="keyword">or</span> sample_time&lt;<span class="number">1</span>:</span><br><span class="line">        logger.warning(<span class="string">'é‡‡æ ·æ—¶é—´è¿‡çŸ­ï¼æ•°æ®ä½œåºŸ'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    f0_candidates = [rotation_frequency<span class="number">-2</span>,rotation_frequency<span class="number">-1</span>,rotation_frequency,rotation_frequency+<span class="number">1</span>,rotation_frequency+<span class="number">2</span>] <span class="comment"># åŸºé¢‘</span></span><br><span class="line">    spectrum = abs(fft(sensor_data))[:useful_bandwidth]/len(sensor_data)  <span class="comment"># é¢‘è°±</span></span><br><span class="line">    f0 = f0_candidates[spectrum[f0_candidates].argmax()]<span class="comment"># ç¡®å®šåŸºé¢‘</span></span><br><span class="line">    segments = [[<span class="number">1</span>,int(<span class="number">0.40</span>*f0)],[int(<span class="number">0.40</span>*f0),int(<span class="number">0.50</span>*f0)],</span><br><span class="line">                [int(<span class="number">0.5</span>*f0)],[int(<span class="number">0.50</span>*f0)+<span class="number">1</span>,int(f0)],[f0],[int(<span class="number">2</span>*f0)],</span><br><span class="line">                [int(<span class="number">3</span>*f0),int(<span class="number">5</span>*f0)+<span class="number">1</span>],[int(<span class="number">6</span>*f0),useful_bandwidth]]</span><br><span class="line">    temp = []</span><br><span class="line">    <span class="keyword">for</span> seg <span class="keyword">in</span> segments:</span><br><span class="line">        <span class="keyword">if</span> len(seg)==<span class="number">2</span>:</span><br><span class="line">            max_value = max(spectrum[seg[<span class="number">0</span>]:seg[<span class="number">1</span>]])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            max_value = spectrum[seg[<span class="number">0</span>]]</span><br><span class="line">        temp.append(max_value)</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotor</span><span class="params">(data, useful_labels, conf, model_dir, logger)</span>:</span></span><br><span class="line">    djzs_field_name = conf[<span class="string">'Table'</span>][<span class="string">'djzs_field_name'</span>]</span><br><span class="line">    gzlx_field_name = conf[<span class="string">'Table'</span>][<span class="string">'gzlx_field_name'</span>]</span><br><span class="line">    cypl_field_name = conf[<span class="string">'Table'</span>][<span class="string">'cypl_field_name'</span>]</span><br><span class="line">    filtered_data = data.loc[:,[djzs_field_name,cypl_field_name,gzlx_field_name,<span class="string">'CGQ1'</span>]][data[gzlx_field_name].isin(useful_labels)]</span><br><span class="line">    </span><br><span class="line">    config_for_web = &#123;<span class="string">'mission'</span>:conf[<span class="string">'Mission'</span>][<span class="string">'table'</span>],</span><br><span class="line">                      <span class="string">'label'</span>:useful_labels,</span><br><span class="line">                     <span class="string">'function_for_web'</span>:conf[<span class="string">'Mission'</span>][<span class="string">'extract_feature_function_for_web'</span>]&#125;</span><br><span class="line">    <span class="keyword">with</span> open(model_dir+<span class="string">'\config_for_web.json'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        json.dump(config_for_web, file, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    feature_and_label = []</span><br><span class="line">    <span class="keyword">for</span> arr <span class="keyword">in</span> filtered_data.values:</span><br><span class="line">        temp = rotor_simple(arr, logger)</span><br><span class="line">        <span class="keyword">if</span> temp != <span class="literal">None</span>:<span class="comment"># æ•°æ®æœ‰æ•ˆ</span></span><br><span class="line">            temp.append(useful_labels.index(arr[<span class="number">2</span>]))</span><br><span class="line">            feature_and_label.append(temp)</span><br><span class="line">    feature_and_label = np.array(feature_and_label, dtype=np.float32)</span><br><span class="line">    </span><br><span class="line">    column = [<span class="string">'feature&#123;&#125;'</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(feature_and_label.shape[<span class="number">1</span>]<span class="number">-1</span>)]+[<span class="string">'label'</span>]</span><br><span class="line">    df = pd.DataFrame(data=feature_and_label, columns=column)</span><br><span class="line">    df.to_csv(model_dir+<span class="string">'\\feature_and_label.csv'</span>, index=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> feature_and_label</span><br></pre></td></tr></table></figure>

<h5 id="è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ "><a href="#è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ " class="headerlink" title="è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ "></a>è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ </h5><p>Python çš„ç¬¬ä¸‰æ–¹åŒ…TPOTå·²ç»å®ç°äº†åŸºäºé—ä¼ ç®—æ³•çš„è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ ï¼Œé€šè¿‡åœ¨Python ç¯å¢ƒä¸­å®‰è£…TPOTï¼Œå¹¶ä¸”è°ƒç”¨ç›¸å…³æ–¹æ³•å³å¯å®ç°è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ ã€‚éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logger.info(<span class="string">'è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ åˆå§‹åŒ–...'</span>)</span><br><span class="line"><span class="keyword">from</span> tpot <span class="keyword">import</span> TPOTClassifier</span><br><span class="line"></span><br><span class="line">generations = int(conf[<span class="string">'Tpot'</span>][<span class="string">'generations'</span>])</span><br><span class="line">population_size = int(conf[<span class="string">'Tpot'</span>][<span class="string">'population_size'</span>])</span><br><span class="line">verbosity = int(conf[<span class="string">'Tpot'</span>][<span class="string">'verbosity'</span>])</span><br><span class="line"></span><br><span class="line">model = TPOTClassifier(generations=generations, population_size=population_size,  scoring=<span class="string">'f1_macro'</span>, cv=<span class="number">5</span>, n_jobs=<span class="number">1</span>, verbosity=verbosity)</span><br><span class="line">feature = feature_and_label[:,:<span class="number">-1</span>]</span><br><span class="line">label = feature_and_label[:,<span class="number">-1</span>]</span><br><span class="line">logger.info(<span class="string">'åˆå§‹åŒ–å®Œæ¯•ï¼Œå¼€å§‹å¯»æ‰¾æœ€ä¼˜æœºå™¨å­¦ä¹ æµç¨‹...'</span>)</span><br><span class="line">model.fit(feature, label)</span><br><span class="line">logger.info(<span class="string">'å¯»ä¼˜ç»“æŸï¼Œå¼€å§‹ä¿å­˜æœ€ä¼˜æœºå™¨å­¦ä¹ æµç¨‹...'</span>)</span><br><span class="line"><span class="keyword">from</span> sklearn.externals <span class="keyword">import</span> joblib</span><br><span class="line">joblib.dump(model.fitted_pipeline_, model_dir+<span class="string">'\pipeline.pkl'</span>)</span><br><span class="line">logger.info(<span class="string">'ä¿å­˜æˆåŠŸï¼Œè®­ç»ƒç»“æŸï¼'</span>)</span><br></pre></td></tr></table></figure>


<h5 id="æ•…éšœè¯Šæ–­ç³»ç»Ÿéƒ¨ç½²"><a href="#æ•…éšœè¯Šæ–­ç³»ç»Ÿéƒ¨ç½²" class="headerlink" title="æ•…éšœè¯Šæ–­ç³»ç»Ÿéƒ¨ç½²"></a>æ•…éšœè¯Šæ–­ç³»ç»Ÿéƒ¨ç½²</h5><p>åˆ©ç”¨Pythonè½»å‹Webæ¡†æ¶æ¥è¿›è¡Œéƒ¨ç½²æ„å»ºæ•…éšœè¯Šæ–­WebæœåŠ¡å™¨ã€‚åŠ è½½è¯Šæ–­ç®—æ³•å’Œå®ç°HTTPçš„POSTæ–¹æ³•ã€‚ã€</p>
<p>åŠ è½½è¯Šæ–­ç®—æ³•å¹¶åˆ›å»ºWebæœåŠ¡å™¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function_for_web = &#123;&#125;</span><br><span class="line">pipeline = &#123;&#125;</span><br><span class="line">label = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> model_dirs:</span><br><span class="line">    logger.info(<span class="string">'æ­£åœ¨è¯»å–webé…ç½®æ–‡ä»¶...'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(each+<span class="string">'\config_for_web.json'</span>,<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">            config_for_web = json.load(file)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        logger.error(<span class="string">'è¯»å–é…ç½®æ–‡ä»¶&#123;&#125;å¤±è´¥ï¼'</span>.format(each+<span class="string">'\config.ini'</span>), exc_info=<span class="literal">True</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    logger.info(<span class="string">'webé…ç½®æ–‡ä»¶è¯»å–å®Œæˆ'</span>)</span><br><span class="line">    </span><br><span class="line">    mission = config_for_web[<span class="string">'mission'</span>]</span><br><span class="line">    function_for_web[mission] = config_for_web[<span class="string">'function_for_web'</span>]</span><br><span class="line">    pipeline[mission] = joblib.load(each+<span class="string">'\pipeline.pkl'</span>)</span><br><span class="line">    label[mission] = config_for_web[<span class="string">'label'</span>]</span><br><span class="line">    </span><br><span class="line">app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">5050</span>)</span><br></pre></td></tr></table></figure>

<p>POSTæ–¹æ³•å®ç°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/',methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">diagnose</span><span class="params">()</span>:</span></span><br><span class="line">    results = &#123;&#125;</span><br><span class="line">    all_data = request.json</span><br><span class="line">    missions = all_data.keys()</span><br><span class="line"><span class="comment">#     logger.info(str(missions))</span></span><br><span class="line">    <span class="keyword">for</span> mission <span class="keyword">in</span> missions:</span><br><span class="line">        exec(<span class="string">'from extract_features import &#123;0&#125; as extract_function'</span>.format(function_for_web[mission]), globals())</span><br><span class="line">        data = all_data[mission]</span><br><span class="line">        feature = extract_function(data, logger, conf)<span class="comment"># feature is a list</span></span><br><span class="line">        proba = pipeline[mission].predict_proba(np.array(feature, np.float32).reshape(<span class="number">1</span>, <span class="number">-1</span>))[<span class="number">0</span>]</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate(proba):</span><br><span class="line">            result[label[mission][i]] = <span class="string">'%.1f'</span>%round(float(v)*<span class="number">100</span>,<span class="number">1</span>)</span><br><span class="line">        results[mission] = result</span><br><span class="line"><span class="comment">#     print(results)</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(results, ensure_ascii=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h5 id="æ•…éšœè¯Šæ–­ç³»ç»Ÿæµ‹è¯•"><a href="#æ•…éšœè¯Šæ–­ç³»ç»Ÿæµ‹è¯•" class="headerlink" title="æ•…éšœè¯Šæ–­ç³»ç»Ÿæµ‹è¯•"></a>æ•…éšœè¯Šæ–­ç³»ç»Ÿæµ‹è¯•</h5><p>ä½¿ç”¨æ³µè½´æ•…éšœæ•°æ®ï¼ˆæ•°æ®ç±»åˆ«ä¸ºæ­£å¸¸ã€è½¬å­ä¸å¯¹ä¸­ã€è½¬å­ä¸å¹³è¡¡ã€æ¥è§¦æ‘©æ“¦æ ·æœ¬å„45 ä¸ªï¼Œæ¥æºå·¥å†µå•ä¸€ï¼‰æ¥ç®€å•æµ‹è¯•ä¸€ä¸‹æ‰€å®ç°æ•…éšœè¯Šæ–­ç³»ç»Ÿï¼Œæµ‹è¯•ç»“æœä¸‹å›¾æ‰€ç¤ºï¼Œæ¨ªåæ ‡ä»£è¡¨æœºå™¨å­¦ä¹ æµç¨‹ç»„æˆçš„ç§ç¾¤ä»£æ•°ï¼Œçºµåæ ‡ä»£è¡¨æ¯ä»£ç§ç¾¤ä¸­æœ€ä¼˜æœºå™¨å­¦ä¹ æµç¨‹çš„AUCè¯„åˆ†ã€‚</p>
<p><img src="/2020/03/30/%E6%B3%B5%E7%AB%99%E6%9C%BA%E7%BB%84%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/res.jpg" alt></p>
]]></content>
      <categories>
        <category>é¡¹ç›®</category>
      </categories>
      <tags>
        <tag>é¡¹ç›®</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—</title>
    <url>/2020/03/30/62_%E5%9C%86%E5%9C%88%E4%B8%AD%E6%9C%80%E5%90%8E%E5%89%A9%E4%B8%8B%E7%9A%84%E6%95%B0%E5%AD%97/</url>
    <content><![CDATA[<h2 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h2><p>0,1ï¼ŒÂ·Â·Â·n-1è¿™nä¸ªæ•°å­—æ’æˆä¸€ä¸ªåœ†åœˆï¼Œä»æ•°å­—0å¼€å§‹ï¼Œæ¯æ¬¡ä»è¿™ä¸ªåœ†åœˆé‡Œåˆ é™¤ç¬¬mä¸ªæ•°å­—ã€‚æ±‚å‡ºè¿™ä¸ªåœ†åœˆé‡Œå‰©ä¸‹çš„æœ€åä¸€ä¸ªæ•°å­—ã€‚</p>
<a id="more"></a>

<h2 id="æœ¬é¢˜è€ƒç‚¹ï¼š"><a href="#æœ¬é¢˜è€ƒç‚¹ï¼š" class="headerlink" title="æœ¬é¢˜è€ƒç‚¹ï¼š"></a>æœ¬é¢˜è€ƒç‚¹ï¼š</h2><p>  çº¦ç‘Ÿå¤«ç¯é—®é¢˜</p>
<h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯:"></a>è§£é¢˜æ€è·¯:</h2><p>  1.) æ¨¡æ‹Ÿæ³•</p>
<p>  ç”¨æ•°ç»„åˆ—è¡¨æ¨¡æ‹Ÿä¸€ä¸‹ã€‚åˆ›å»ºä¸€ä¸ªæ•°ç»„å­˜å‚¨0-n-1çš„æ•°ç»„ï¼Œä½†æ•°ç»„é•¿åº¦å¤§äº1æ—¶ï¼Œå°±è®¡ç®—endä½ç½®å³ä¸º(start+m-1)%len(nums) ï¼Œåˆ é™¤è¯¥å…ƒç´ åç„¶åstartå†ç­‰äºä¹‹å‰endï¼Œæœ€åæ•°ç»„ä¸­å‰©æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›nums[0]</p>
<p>  æ—¶é—´å¤æ‚åº¦O(n),ç©ºé—´å¤æ‚åº¦O(n)</p>
<p>  2.) æ•°å­¦æ–¹æ³•ï¼š</p>
<p>  å°†ä¸Šè¿°é—®é¢˜å»ºæ¨¡ä¸ºå‡½æ•° f(n, m)ï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼ä¸ºæœ€ç»ˆç•™ä¸‹çš„å…ƒç´ çš„åºå·ã€‚</p>
<p>  æ¯åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œä¸‹ä¸€ä¸ªå…ƒç´ æˆä¸ºæœ€å¼€å§‹çš„å¤´ï¼Œç›¸å½“äºæŠŠæ•°ç»„å‘å‰ç§»åŠ¨mä½ã€‚è‹¥å·²çŸ¥n-1ä¸ªäººæ—¶ï¼Œåˆ é™¤ä¸‹æ ‡ä½ç½®ä½f(nâˆ’1,m)ï¼Œåˆ™nä¸ªäººçš„æ—¶å€™ï¼Œå°±æ˜¯å¾€åç§»åŠ¨mä½ï¼Œ(å› ä¸ºæœ‰å¯èƒ½æ•°ç»„è¶Šç•Œï¼Œè¶…è¿‡çš„éƒ¨åˆ†ä¼šè¢«æ¥åˆ°å¤´ä¸Šï¼Œæ‰€ä»¥è¿˜è¦æ¨¡n)ï¼Œæ—¢f(n,m) = (f(n-1,m) + m) % n</p>
<p>  é€’å½’å…¬å¼ä¸ºï¼š$f(n, m)=(f(n-1, m)+m) \% n$</p>
<p>  æ—¶é—´å¤æ‚åº¦O(n),ç©ºé—´å¤æ‚åº¦O(n)</p>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><h4 id="æ–¹æ³•ä¸€ï¼šæ¨¡æ‹Ÿæ³•"><a href="#æ–¹æ³•ä¸€ï¼šæ¨¡æ‹Ÿæ³•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šæ¨¡æ‹Ÿæ³•"></a>æ–¹æ³•ä¸€ï¼šæ¨¡æ‹Ÿæ³•</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lastRemaining</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res =<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span> (n&lt;=<span class="number">0</span> || m&lt;=<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            nums.push_back(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> start =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(nums.<span class="built_in">size</span>()&gt;<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> <span class="built_in">end</span> = (start+m<span class="number">-1</span>)%(nums.<span class="built_in">size</span>());</span><br><span class="line">            nums.erase(nums.<span class="built_in">begin</span>()+<span class="built_in">end</span>);  </span><br><span class="line">            <span class="comment">// vectoræ’å…¥åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œå¯èƒ½ä¼šè¶…æ—¶</span></span><br><span class="line">            start = <span class="built_in">end</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒï¼šæ•°å­¦æ³•"><a href="#æ–¹æ³•äºŒï¼šæ•°å­¦æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šæ•°å­¦æ³•"></a>æ–¹æ³•äºŒï¼šæ•°å­¦æ³•</h4><p>è¿­ä»£ï¼šç©ºé—´å¤æ‚åº¦O(1)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lastRemaining</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            res = (res+m)%i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>é€’å½’ï¼šç©ºé—´å¤æ‚åº¦O(n)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lastRemaining</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> f(n,m);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (f(n<span class="number">-1</span>,m) + m) %n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://blog.csdn.net/u011500062/article/details/72855826" target="_blank" rel="noopener external nofollow noreferrer">çº¦ç‘Ÿå¤«ç¯â€”â€”å…¬å¼æ³•ï¼ˆé€’æ¨å…¬å¼ï¼‰</a></li>
</ul>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>TPOTä¼˜åŒ–åŸç†éƒ¨åˆ†æºç è§£è¯»</title>
    <url>/2020/03/28/TPOT%E4%BC%98%E5%8C%96%E5%8E%9F%E7%90%86%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/</url>
    <content><![CDATA[<p>TPOTçš„æ¶‰åŠåˆ°çš„å»ºæ¨¡è¿‡ç¨‹ï¼Œä»¥TPOT lightä¸ºä¾‹ä¸»è¦æœ‰3å—ï¼šClassifiersã€Preprocesssorsã€Selectorsï¼ŒTPOTçš„é—ä¼ ç®—æ³•ä¼˜åŒ–æ˜¯ä»¥pipelineä¸ºåŸºç¡€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´pipelineå°±ç›¸å½“äºåŸºå› åºåˆ—ã€‚é€šè¿‡æ„å»ºåˆå§‹pipelineï¼Œå†ç»è¿‡é—ä¼ ç®—æ³•ä¸­çš„äº¤å‰ã€å˜å¼‚æœ€ç»ˆç”Ÿæˆç¬¦åˆæ¡ä»¶çš„æ¨¡å‹æ•ˆæœè¾ƒå¥½çš„pipelineã€‚æˆ‘ä»¬ä»æœ€ä¼˜çš„é‚£ä¸€ä»£ä¸­é€‰å–å…¶ä¸­å»ºæ¨¡æ•ˆæœæœ€å¥½çš„pipelineå³å¯ï¼ŒTPOTæ˜¯åŸºäºscikit-learnæ¡†æ¶çš„ï¼Œå®ƒæœ¬èº«ä¸å»å®ç°æˆ‘ä»¬å¸¸ç”¨çš„åˆ†ç±»å›å½’ç­‰ç®—æ³•ã€‚è€Œæ˜¯é€šè¿‡é—ä¼ ç®—æ³•ä¼˜åŒ–pipelineã€‚ä¹Ÿå°±æ˜¯ä»ä¸­é€‰å‡ºæœ€ä¼˜çš„æ•°æ®å¤„ç†ã€ç‰¹å¾é€‰æ‹©ã€åˆ†ç±»ç®—æ³•çš„ç»„åˆã€‚</p>
<a id="more"></a>
<p>ä¸€ä¸ªç®€å•çš„TPOTçš„ä½¿ç”¨å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> tpot <span class="keyword">import</span> TPOTClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_digits</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"> </span><br><span class="line">iris = load_digits()</span><br><span class="line">iris.data[<span class="number">0</span>:<span class="number">5</span>], iris.target</span><br><span class="line"><span class="keyword">print</span> iris</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(iris.data, iris.target,train_size=<span class="number">0.75</span>, test_size=<span class="number">0.25</span>)</span><br><span class="line">X_train.shape, X_test.shape, y_train.shape, y_test.shape</span><br><span class="line"> </span><br><span class="line">tpot = TPOTClassifier(verbosity=<span class="number">2</span>, max_time_mins=<span class="number">2</span>,config_dict=<span class="string">"TPOT light"</span>,population_size=<span class="number">10</span>,mutation_rate=<span class="number">0.9</span>,crossover_rate=<span class="number">0.1</span>)</span><br><span class="line">tpot.fit(X_train, y_train)</span><br><span class="line">print(tpot.score(X_test, y_test))</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/28/TPOT%E4%BC%98%E5%8C%96%E5%8E%9F%E7%90%86%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/1.png" alt></p>
<h3 id="éƒ¨åˆ†æ ¸å¿ƒæºç è§£è¯»"><a href="#éƒ¨åˆ†æ ¸å¿ƒæºç è§£è¯»" class="headerlink" title="éƒ¨åˆ†æ ¸å¿ƒæºç è§£è¯»"></a>éƒ¨åˆ†æ ¸å¿ƒæºç è§£è¯»</h3><h4 id="1ã€åˆå§‹ç¾¤ä½“çš„ç”Ÿæˆ"><a href="#1ã€åˆå§‹ç¾¤ä½“çš„ç”Ÿæˆ" class="headerlink" title="1ã€åˆå§‹ç¾¤ä½“çš„ç”Ÿæˆ"></a>1ã€åˆå§‹ç¾¤ä½“çš„ç”Ÿæˆ</h4><p>è¿™æ®µä»£ç å¯ä»¥çœ‹å‡ºï¼Œpipelineçš„æ„å»ºæ˜¯é€šè¿‡ç”Ÿæˆä¸åŒæ·±åº¦çš„æ ‘ç±»æ„å»ºåˆå§‹pipelineçš„ï¼Œå¤§è‡´è¿‡ç¨‹æ˜¯å…ˆç¡®å®šæ ‘çš„æ·±åº¦ï¼Œä»Classifiersä¸­é€‰æ‹©ä¸€ä¸ªåˆ†ç±»å™¨æ”¾å…¥æ ‘çš„é¡¶ç«¯ï¼Œæ¥ä¸‹æ¥æ„å»ºåˆ†ç±»å™¨çš„å‚æ•°ï¼Œä»¥ä¸Šå‡ä¸ºéšæœºé€‰å–ã€‚å¦‚æœæ ‘çš„æ·±åº¦å¤§äº1ï¼Œåˆ™è¿˜éœ€è¦ä»Preprocesssorsã€Selectorsä¸­é€‰æ‹©ç®—å­åŠ å…¥åˆ°pipelineä¸­ï¼Œè¿˜è¦è¿›è¡Œå‚æ•°åˆå§‹åŒ–ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@_pre_test</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_generate</span><span class="params">(self, pset, min_, max_, condition, type_=None)</span>:</span></span><br><span class="line">    <span class="string">"""Generate a Tree as a list of lists.</span></span><br><span class="line"><span class="string">    The tree is build from the root to the leaves, and it stop growing when</span></span><br><span class="line"><span class="string">    the condition is fulfilled.</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    pset: PrimitiveSetTyped</span></span><br><span class="line"><span class="string">        Primitive set from which primitives are selected.</span></span><br><span class="line"><span class="string">    min_: int</span></span><br><span class="line"><span class="string">        Minimum height of the produced trees.</span></span><br><span class="line"><span class="string">    max_: int</span></span><br><span class="line"><span class="string">        Maximum Height of the produced trees.</span></span><br><span class="line"><span class="string">    condition: function</span></span><br><span class="line"><span class="string">        The condition is a function that takes two arguments,</span></span><br><span class="line"><span class="string">        the height of the tree to build and the current</span></span><br><span class="line"><span class="string">        depth in the tree.</span></span><br><span class="line"><span class="string">    type_: class</span></span><br><span class="line"><span class="string">        The type that should return the tree when called, when</span></span><br><span class="line"><span class="string">        :obj:None (default) no return type is enforced.</span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    individual: list</span></span><br><span class="line"><span class="string">        A grown tree with leaves at possibly different depths</span></span><br><span class="line"><span class="string">        dependending on the condition function.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> type_ <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        type_ = pset.ret</span><br><span class="line">    expr = []</span><br><span class="line">    height = np.random.randint(min_, max_)</span><br><span class="line">    stack = [(<span class="number">0</span>, type_)]</span><br><span class="line">    <span class="keyword">while</span> len(stack) != <span class="number">0</span>:</span><br><span class="line">        depth, type_ = stack.pop()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># We've added a type_ parameter to the condition function</span></span><br><span class="line">        <span class="keyword">if</span> condition(height, depth, type_):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                term = np.random.choice(pset.terminals[type_])</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                _, _, traceback = sys.exc_info()</span><br><span class="line">                <span class="keyword">raise</span> IndexError(</span><br><span class="line">                    <span class="string">'The gp.generate function tried to add '</span></span><br><span class="line">                    <span class="string">'a terminal of type &#123;&#125;, but there is'</span></span><br><span class="line">                    <span class="string">'none available. &#123;&#125;'</span>.format(type_, traceback)</span><br><span class="line">                )</span><br><span class="line">            <span class="keyword">if</span> inspect.isclass(term):</span><br><span class="line">                term = term()</span><br><span class="line">            expr.append(term)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                prim = np.random.choice(pset.primitives[type_])</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                _, _, traceback = sys.exc_info()</span><br><span class="line">                <span class="keyword">raise</span> IndexError(</span><br><span class="line">                    <span class="string">'The gp.generate function tried to add '</span></span><br><span class="line">                    <span class="string">'a primitive of type &#123;&#125;, but there is'</span></span><br><span class="line">                    <span class="string">'none available. &#123;&#125;'</span>.format(type_, traceback)</span><br><span class="line">                )</span><br><span class="line">            expr.append(prim)</span><br><span class="line">            <span class="keyword">for</span> arg <span class="keyword">in</span> reversed(prim.args):</span><br><span class="line">                stack.append((depth + <span class="number">1</span>, arg))</span><br><span class="line">    <span class="keyword">return</span> expr</span><br></pre></td></tr></table></figure>

<h4 id="2ã€é€‚åº”æ€§å€¼è¯„ä¼°æ£€æµ‹"><a href="#2ã€é€‚åº”æ€§å€¼è¯„ä¼°æ£€æµ‹" class="headerlink" title="2ã€é€‚åº”æ€§å€¼è¯„ä¼°æ£€æµ‹"></a>2ã€é€‚åº”æ€§å€¼è¯„ä¼°æ£€æµ‹</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_evaluate_individuals</span><span class="params">(self, individuals, features, target, sample_weight=None, groups=None)</span>:</span></span><br><span class="line">    <span class="string">"""Determine the fit of the provided individuals.</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    individuals: a list of DEAP individual</span></span><br><span class="line"><span class="string">        One individual is a list of pipeline operators and model parameters that can be</span></span><br><span class="line"><span class="string">        compiled by DEAP into a callable function</span></span><br><span class="line"><span class="string">    features: numpy.ndarray &#123;n_samples, n_features&#125;</span></span><br><span class="line"><span class="string">        A numpy matrix containing the training and testing features for the individual's evaluation</span></span><br><span class="line"><span class="string">    target: numpy.ndarray &#123;n_samples&#125;</span></span><br><span class="line"><span class="string">        A numpy matrix containing the training and testing target for the individual's evaluation</span></span><br><span class="line"><span class="string">    sample_weight: array-like &#123;n_samples&#125;, optional</span></span><br><span class="line"><span class="string">        List of sample weights to balance (or un-balanace) the dataset target as needed</span></span><br><span class="line"><span class="string">    groups: array-like &#123;n_samples, &#125;, optional</span></span><br><span class="line"><span class="string">        Group labels for the samples used while splitting the dataset into train/test set</span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    fitnesses_ordered: float</span></span><br><span class="line"><span class="string">        Returns a list of tuple value indicating the individual's fitness</span></span><br><span class="line"><span class="string">        according to its performance on the provided data</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"> </span><br><span class="line">    operator_counts, eval_individuals_str, sklearn_pipeline_list, stats_dicts = self._preprocess_individuals(individuals)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Make the partial function that will be called below</span></span><br><span class="line">    partial_wrapped_cross_val_score = partial(</span><br><span class="line">        _wrapped_cross_val_score,</span><br><span class="line">        features=features,</span><br><span class="line">        target=target,</span><br><span class="line">        cv=self.cv,</span><br><span class="line">        scoring_function=self.scoring_function,</span><br><span class="line">        sample_weight=sample_weight,</span><br><span class="line">        groups=groups,</span><br><span class="line">        timeout=self.max_eval_time_seconds</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line">    result_score_list = []</span><br><span class="line">    <span class="comment"># Don't use parallelization if n_jobs==1</span></span><br><span class="line">    <span class="keyword">if</span> self.n_jobs == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> sklearn_pipeline <span class="keyword">in</span> sklearn_pipeline_list:</span><br><span class="line">            self._stop_by_max_time_mins()</span><br><span class="line">            val = partial_wrapped_cross_val_score(sklearn_pipeline=sklearn_pipeline)</span><br><span class="line">            result_score_list = self._update_val(val, result_score_list)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># chunk size for pbar update</span></span><br><span class="line">        <span class="comment"># chunk size is min of cpu_count * 2 and n_jobs * 4</span></span><br><span class="line">        chunk_size = min(cpu_count()*<span class="number">2</span>, self.n_jobs*<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">for</span> chunk_idx <span class="keyword">in</span> range(<span class="number">0</span>, len(sklearn_pipeline_list), chunk_size):</span><br><span class="line">            self._stop_by_max_time_mins()</span><br><span class="line">            parallel = Parallel(n_jobs=self.n_jobs, verbose=<span class="number">0</span>, pre_dispatch=<span class="string">'2*n_jobs'</span>)</span><br><span class="line">            tmp_result_scores = parallel(delayed(partial_wrapped_cross_val_score)(sklearn_pipeline=sklearn_pipeline)</span><br><span class="line">                                         <span class="keyword">for</span> sklearn_pipeline <span class="keyword">in</span> sklearn_pipeline_list[chunk_idx:chunk_idx + chunk_size])</span><br><span class="line">            <span class="comment"># update pbar</span></span><br><span class="line">            <span class="keyword">for</span> val <span class="keyword">in</span> tmp_result_scores:</span><br><span class="line">                result_score_list = self._update_val(val, result_score_list)</span><br><span class="line"> </span><br><span class="line">    self._update_evaluated_individuals_(result_score_list, eval_individuals_str, operator_counts, stats_dicts)</span><br><span class="line"> </span><br><span class="line">    <span class="string">"""Look up the operator count and cross validation score to use in the optimization"""</span></span><br><span class="line">    <span class="keyword">return</span> [(self.evaluated_individuals_[str(individual)][<span class="string">'operator_count'</span>],</span><br><span class="line">             self.evaluated_individuals_[str(individual)][<span class="string">'internal_cv_score'</span>])</span><br><span class="line">            <span class="keyword">for</span> individual <span class="keyword">in</span> individuals]</span><br></pre></td></tr></table></figure>

<h3 id="3ã€å˜å¼‚"><a href="#3ã€å˜å¼‚" class="headerlink" title="3ã€å˜å¼‚"></a>3ã€å˜å¼‚</h3><p>å˜å¼‚ä¸»è¦æ˜¯å¢åŠ pipelineçš„å†…å®¹æˆ–æ›´æ¢å…¶ä¸­çš„å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_random_mutation_operator</span><span class="params">(self, individual, allow_shrink=True)</span>:</span></span><br><span class="line">    <span class="string">"""Perform a replacement, insertion, or shrink mutation on an individual.</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    individual: DEAP individual</span></span><br><span class="line"><span class="string">        A list of pipeline operators and model parameters that can be</span></span><br><span class="line"><span class="string">        compiled by DEAP into a callable function</span></span><br><span class="line"><span class="string">    allow_shrink: bool (True)</span></span><br><span class="line"><span class="string">        If True the `mutShrink` operator, which randomly shrinks the pipeline,</span></span><br><span class="line"><span class="string">        is allowed to be chosen as one of the random mutation operators.</span></span><br><span class="line"><span class="string">        If False, `mutShrink`  will never be chosen as a mutation operator.</span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    mut_ind: DEAP individual</span></span><br><span class="line"><span class="string">        Returns the individual with one of the mutations applied to it</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    mutation_techniques = [</span><br><span class="line">        partial(gp.mutInsert, pset=self._pset),</span><br><span class="line">        partial(mutNodeReplacement, pset=self._pset)</span><br><span class="line">    ]</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># We can't shrink pipelines with only one primitive, so we only add it if we find more primitives.</span></span><br><span class="line">    number_of_primitives = sum([isinstance(node, deap.gp.Primitive) <span class="keyword">for</span> node <span class="keyword">in</span> individual])</span><br><span class="line">    <span class="keyword">if</span> number_of_primitives &gt; <span class="number">1</span> <span class="keyword">and</span> allow_shrink:</span><br><span class="line">        mutation_techniques.append(partial(gp.mutShrink))</span><br><span class="line"> </span><br><span class="line">    mutator = np.random.choice(mutation_techniques)</span><br><span class="line"> </span><br><span class="line">    unsuccesful_mutations = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(self._max_mut_loops):</span><br><span class="line">        <span class="comment"># We have to clone the individual because mutator operators work in-place.</span></span><br><span class="line">        ind = self._toolbox.clone(individual)</span><br><span class="line">        offspring, = mutator(ind)</span><br><span class="line">        <span class="keyword">if</span> str(offspring) <span class="keyword">not</span> <span class="keyword">in</span> self.evaluated_individuals_:</span><br><span class="line">            <span class="comment"># Update statistics</span></span><br><span class="line">            <span class="comment"># crossover_count is kept the same as for the predecessor</span></span><br><span class="line">            <span class="comment"># mutation count is increased by 1</span></span><br><span class="line">            <span class="comment"># predecessor is set to the string representation of the individual before mutation</span></span><br><span class="line">            <span class="comment"># generation is set to 'INVALID' such that we can recognize that it should be updated accordingly</span></span><br><span class="line">            offspring.statistics[<span class="string">'crossover_count'</span>] = individual.statistics[<span class="string">'crossover_count'</span>]</span><br><span class="line">            offspring.statistics[<span class="string">'mutation_count'</span>] = individual.statistics[<span class="string">'mutation_count'</span>] + <span class="number">1</span></span><br><span class="line">            offspring.statistics[<span class="string">'predecessor'</span>] = (str(individual),)</span><br><span class="line">            offspring.statistics[<span class="string">'generation'</span>] = <span class="string">'INVALID'</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            unsuccesful_mutations += <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Sometimes you have pipelines for which every shrunk version has already been explored too.</span></span><br><span class="line">    <span class="comment"># To still mutate the individual, one of the two other mutators should be applied instead.</span></span><br><span class="line">    <span class="keyword">if</span> ((unsuccesful_mutations == <span class="number">50</span>) <span class="keyword">and</span></span><br><span class="line">            (type(mutator) <span class="keyword">is</span> partial <span class="keyword">and</span> mutator.func <span class="keyword">is</span> gp.mutShrink)):</span><br><span class="line">        offspring, = self._random_mutation_operator(individual, allow_shrink=<span class="literal">False</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> offspring,</span><br></pre></td></tr></table></figure>

<h3 id="4ã€äº¤å‰"><a href="#4ã€äº¤å‰" class="headerlink" title="4ã€äº¤å‰"></a>4ã€äº¤å‰</h3><p>é€‰å–ä¸¤ä¸ªpipelineï¼Œå¯¹é‡Œé¢çš„å†…å®¹è¿›è¡Œäº’æ¢ï¼Œä½†æ˜¯ä¸¤ä¸ªpipelineçš„primitiveè¦ç›¸åŒã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pick_two_individuals_eligible_for_crossover</span><span class="params">(population)</span>:</span></span><br><span class="line">    <span class="string">"""Pick two individuals from the population which can do crossover, that is, they share a primitive.</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    population: array of individuals</span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    tuple: (individual, individual)</span></span><br><span class="line"><span class="string">        Two individuals which are not the same, but share at least one primitive.</span></span><br><span class="line"><span class="string">        Alternatively, if no such pair exists in the population, (None, None) is returned instead.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    primitives_by_ind = [set([node.name <span class="keyword">for</span> node <span class="keyword">in</span> ind <span class="keyword">if</span> isinstance(node, gp.Primitive)])</span><br><span class="line">                         <span class="keyword">for</span> ind <span class="keyword">in</span> population]</span><br><span class="line">    pop_as_str = [str(ind) <span class="keyword">for</span> ind <span class="keyword">in</span> population]</span><br><span class="line"> </span><br><span class="line">    eligible_pairs = [(i, i+<span class="number">1</span>+j) <span class="keyword">for</span> i, ind1_prims <span class="keyword">in</span> enumerate(primitives_by_ind)</span><br><span class="line">                                 <span class="keyword">for</span> j, ind2_prims <span class="keyword">in</span> enumerate(primitives_by_ind[i+<span class="number">1</span>:])</span><br><span class="line">                                 <span class="keyword">if</span> <span class="keyword">not</span> ind1_prims.isdisjoint(ind2_prims) <span class="keyword">and</span></span><br><span class="line">                                    pop_as_str[i] != pop_as_str[i+<span class="number">1</span>+j]]</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Pairs are eligible in both orders, this ensures that both orders are considered</span></span><br><span class="line">    eligible_pairs += [(j, i) <span class="keyword">for</span> (i, j) <span class="keyword">in</span> eligible_pairs]</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> eligible_pairs:</span><br><span class="line">        <span class="comment"># If there are no eligible pairs, the caller should decide what to do</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    pair = np.random.randint(<span class="number">0</span>, len(eligible_pairs))</span><br><span class="line">    idx1, idx2 = eligible_pairs[pair]</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> population[idx1], population[idx2]</span><br></pre></td></tr></table></figure>

<p>TPOTè®¾ç½®äº†ä¸€ä¸ªé˜ˆå€¼æ¥å†³å®šæ˜¯äº¤å‰è¿˜æ˜¯å˜å¼‚ï¼Œé»˜è®¤æƒ…å†µä¸‹å˜å¼‚çš„æ¦‚ç‡ä¸º0.9ï¼Œäº¤å‰çš„æ¦‚ç‡ä¸º0.1.æˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¿™ä¸ªé˜ˆå€¼ã€‚</p>
<p>å…·ä½“çš„pipelineå˜æ¢å¦‚ä¸‹ï¼š</p>
<p>é»˜è®¤çš„ç§ç¾¤æ•°é‡ä¸º100ï¼Œä¸ºäº†çœ‹æºç æ–¹ä¾¿ï¼Œæ”¹ä¸ºäº†5ä¸ªç§ç¾¤æ•°ã€‚äº¤å‰å˜å¼‚çš„æ¦‚ç‡å„ä¸º0.5.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tpot = TPOTClassifier(verbosity=<span class="number">2</span>, max_time_mins=<span class="number">2</span>,config_dict=<span class="string">"TPOT light"</span>,population_size=<span class="number">5</span>,mutation_rate=<span class="number">0.5</span>,crossover_rate=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>

<p>åˆå§‹ç§ç¾¤ä¸º5ä¸ªpipelineï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> = &#123;Individual&#125; KNeighborsClassifier(PCA(input_matrix, PCA__iterated_power=<span class="number">6</span>, PCA__svd_solver=randomized), KNeighborsClassifier__n_neighbors=<span class="number">79</span>, KNeighborsClassifier__p=<span class="number">1</span>, KNeighborsClassifier__weights=distance)</span><br><span class="line"><span class="number">1</span> = &#123;Individual&#125; KNeighborsClassifier(Binarizer(input_matrix, Binarizer__threshold=<span class="number">0.55</span>), KNeighborsClassifier__n_neighbors=<span class="number">84</span>, KNeighborsClassifier__p=<span class="number">2</span>, KNeighborsClassifier__weights=uniform)</span><br><span class="line"><span class="number">2</span> = &#123;Individual&#125; DecisionTreeClassifier(input_matrix, DecisionTreeClassifier__criterion=gini, DecisionTreeClassifier__max_depth=<span class="number">9</span>, DecisionTreeClassifier__min_samples_leaf=<span class="number">18</span>, DecisionTreeClassifier__min_samples_split=<span class="number">20</span>)</span><br><span class="line"><span class="number">3</span> = &#123;Individual&#125; LogisticRegression(StandardScaler(input_matrix), LogisticRegression__C=<span class="number">0.0001</span>, LogisticRegression__dual=<span class="literal">True</span>, LogisticRegression__penalty=l2)</span><br><span class="line"><span class="number">4</span> = &#123;Individual&#125; GaussianNB(input_matrix)</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡ç¬¬ä¸€è½®äº¤å‰ã€å˜å¼‚ï¼Œç»“æœä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> = &#123;Individual&#125; LogisticRegression(PCA(input_matrix, PCA__iterated_power=<span class="number">6</span>, PCA__svd_solver=randomized), LogisticRegression__C=<span class="number">0.1</span>, LogisticRegression__dual=<span class="literal">True</span>, LogisticRegression__penalty=l2)</span><br><span class="line"><span class="number">1</span> = &#123;Individual&#125; KNeighborsClassifier(input_matrix, KNeighborsClassifier__n_neighbors=<span class="number">79</span>, KNeighborsClassifier__p=<span class="number">1</span>, KNeighborsClassifier__weights=distance)</span><br><span class="line"><span class="number">2</span> = &#123;Individual&#125; KNeighborsClassifier(PCA(input_matrix, PCA__iterated_power=<span class="number">6</span>, PCA__svd_solver=randomized), KNeighborsClassifier__n_neighbors=<span class="number">79</span>, KNeighborsClassifier__p=<span class="number">1</span>, KNeighborsClassifier__weights=distance)</span><br><span class="line"><span class="number">3</span> = &#123;Individual&#125; GaussianNB(input_matrix)</span><br><span class="line"><span class="number">4</span> = &#123;Individual&#125; KNeighborsClassifier(PCA(input_matrix, PCA__iterated_power=<span class="number">6</span>, PCA__svd_solver=randomized), KNeighborsClassifier__n_neighbors=<span class="number">84</span>, KNeighborsClassifier__p=<span class="number">1</span>, KNeighborsClassifier__weights=distance)</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯¹è¿™å‡ ä¸ªpipelineè¿›è¡Œæ‰“åˆ†è¯„ä¼°ï¼Œå’Œä¸Šä¸€è½®pipelineä¸€èµ·é€‰å‡ºscoreæœ€é«˜çš„å‰5ä¸ªã€‚</p>
<p>è¿›å…¥ä¸‹ä¸€è½®è¿­ä»£ã€‚æœ€åäº§ç”Ÿ5ä¸ªpipelineï¼Œæ‰“åˆ†ï¼Œä»ä¸­é€‰å‡ºæœ€ä¼˜çš„é‚£ä¸ªï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Best pipeline: KNeighborsClassifier(input_matrix, n_neighbors=<span class="number">10</span>, p=<span class="number">2</span>, weights=distance)</span><br><span class="line"><span class="number">0.977777777778</span></span><br></pre></td></tr></table></figure>

<p>æµç¨‹ä¸¾ä¾‹å¦‚ä¸‹ï¼ˆå…·ä½“æµç¨‹å’ŒTPOTä»£ç æœ¬èº«ç•¥æœ‰åŒºåˆ«ï¼Œä½†æ˜¯ä¸å½±å“å¯¹é—ä¼ ç®—æ³•è‡ªåŠ¨åŒ–å»ºæ¨¡çš„ç†è§£ï¼‰</p>
<p><img src="/2020/03/28/TPOT%E4%BC%98%E5%8C%96%E5%8E%9F%E7%90%86%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/2.png" alt></p>
<h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><ul>
<li><a href="https://blog.csdn.net/hgy0403/article/details/81291307" target="_blank" rel="noopener external nofollow noreferrer">TPOTé—ä¼ ç®—æ³•</a></li>
</ul>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨Githubåˆ†æ”¯å¤‡ä»½Hexoåšå®¢æºæ–‡ä»¶</title>
    <url>/2020/03/21/%E5%88%A9%E7%94%A8Github%E5%88%86%E6%94%AF%E5%A4%87%E4%BB%BDHexo%E5%8D%9A%E5%AE%A2%E6%BA%90%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>Hexo éƒ¨ç½²åšå®¢å¾ˆæ–¹ä¾¿ï¼Œæˆ‘çš„è¿™ä¸ªåšå®¢ä¹Ÿæ˜¯ç”¨ Hexo éƒ¨ç½²åœ¨ GitHub Pages ä¸Šçš„ï¼Œæœ‰å¾—äººå¯èƒ½åœ¨å¤šå°ç”µè„‘ä¸Šå†™åšå®¢ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æŠŠåšå®¢çš„æºæ–‡ä»¶å¤‡ä»½åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œè¿™æ ·åªéœ€æŠŠåšå®¢æºæ–‡ä»¶å¤åˆ¶ä¸‹æ¥å°±å¯ä»¥åœ¨å¦ä¸€ä¸ªåœ°æ–¹å†™åšå®¢å¹¶éƒ¨ç½²åˆ° GitHub Pagesä¸Šäº†</p>
<a id="more"></a>
<p>æœ¬ç¯‡ä»‹ç»çš„å°±æ˜¯åˆ©ç”¨åšå®¢çš„ repo åˆ†æ”¯ï¼ˆ master åˆ†æ”¯çš„å¿…é¡»ç”¨æ¥å­˜æ”¾ä½ åšå®¢ç½‘ç«™æ–‡ä»¶ï¼‰æ‰˜ç®¡ Hexo æºæ–‡ä»¶å’Œé…ç½®è¾¾åˆ°å¤‡ä»½çš„ç›®çš„ï¼Œä¸‹é¢å¼€å§‹æ­£é¢˜</p>
<h4 id="æŠŠåšå®¢ç›®å½•çš„æºæ–‡ä»¶pushåˆ°repoåˆ†æ”¯ä¸Š"><a href="#æŠŠåšå®¢ç›®å½•çš„æºæ–‡ä»¶pushåˆ°repoåˆ†æ”¯ä¸Š" class="headerlink" title="æŠŠåšå®¢ç›®å½•çš„æºæ–‡ä»¶pushåˆ°repoåˆ†æ”¯ä¸Š"></a>æŠŠåšå®¢ç›®å½•çš„æºæ–‡ä»¶pushåˆ°repoåˆ†æ”¯ä¸Š</h4><p>cd è¿›å…¥åšå®¢ç›®å½•ï¼ŒGit åˆå§‹åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<p>å®Œæˆä¹‹åï¼Œæ·»åŠ ä¿®æ”¹çš„æ–‡ä»¶ï¼ŒHexo å°±è‡ªå¸¦äº† .gitignore æ–‡ä»¶éœ€è¦å¿½ç•¥çš„æ–‡ä»¶ éƒ½å·²ç»é»˜è®¤é…ç½®å¥½äº†ï¼Œadd å…¨éƒ¨æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure>
<p>ç„¶åcommitï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git commit -m &quot;commit first time&quot;</span><br></pre></td></tr></table></figure>
<p>æäº¤æˆåŠŸä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ push åˆ°githubäº†ï¼Œéœ€è¦å…ˆæŠŠè¿™ Hexo æºæ–‡ä»¶æ˜ å°„åˆ°è¿œç¨‹ repo ä¸Šï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote add origin https:&#x2F;&#x2F;github.com&#x2F;your-name&#x2F;your-name.github.io.git</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±æ˜¯æŠŠHexoæºæ–‡ä»¶ push ä¸Šå»ï¼Œä½†æ˜¯å…³é”®çš„åœ°æ–¹åˆ°äº†ï¼Œmasterä¸Šæ˜¯ Hexo ç”Ÿæˆåšå®¢ç½‘é¡µçš„ä»£ç ï¼Œè€Œæˆ‘ä»¬ Hexo æºæ–‡ä»¶æ˜¯è¦ push åˆ°ä¸€ä¸ªåˆ†æ”¯ä¸Šé¢çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å…ˆè¦åœ¨ repo ä¸Šæ–°å»ºä¸€ä¸ªåˆ†æ”¯</p>
<p>æ–°å»ºä¸€ä¸ªå«åšblogSourceçš„åˆ†æ”¯(æ³¨æ„ï¼šåˆ†æ”¯åè¦å’Œæœ¬åœ°hexoé¡¹ç›®åä¸€è‡´ï¼Œä¸ç„¶pushä¼šå‡ºé”™)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch blogSource</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ï¼Œå¹¶ä¸”åˆ‡æ¢åˆ° blogSource åˆ†æ”¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch</span><br><span class="line">git checkout blogSource</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‹‰å–è¿œç¨‹ä»£ç ï¼Œå†æŠŠåˆšæ‰æ·»åŠ çš„ Hexo æºæ–‡ä»¶ä»£ç  push åˆ°blogSourceè¿™ä¸ªåˆ†æ”¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git pull origin master</span><br><span class="line">git push -u origin blogSource</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±å¯ä»¥åœ¨ repo ä¸Šçœ‹åˆ°åˆ†æ”¯é‡Œé¢å·²ç»æœ‰åšå®¢çš„æºæ–‡ä»¶äº†</p>
<h4 id="æ—¥å¸¸æ›´æ–°åšå®¢æºæ–‡ä»¶"><a href="#æ—¥å¸¸æ›´æ–°åšå®¢æºæ–‡ä»¶" class="headerlink" title="æ—¥å¸¸æ›´æ–°åšå®¢æºæ–‡ä»¶"></a>æ—¥å¸¸æ›´æ–°åšå®¢æºæ–‡ä»¶</h4><p>ä»¥åä½ æœ¬åœ°çš„åšå®¢æºæ–‡ä»¶çš„ä¿®æ”¹å°±å¯ä»¥ç›´æ¥ç”¨ git å‘½ä»¤ push åˆ° repo çš„ blogSource åˆ†æ”¯ä¸Šäº†:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git add .  &#x2F;&#x2F;æ·»åŠ ä¿®æ”¹å†…å®¹åˆ°æœ¬åœ°ä»“å‚¨</span><br><span class="line">git commit -m &#39;modify blog&#39;  &#x2F;&#x2F;æäº¤ä¿®æ”¹å†…å®¹åˆ°æœ¬åœ°ä»“åº“</span><br><span class="line">git push --set-upstream origin blogSource  &#x2F;&#x2F;é…ç½®pushï¼Œä»¥æ–¹ä¾¿åæœŸç›´æ¥git pushæ¨é€</span><br><span class="line">git push  &#x2F;&#x2F;å°†æœ¬åœ°åˆ†æ”¯å’Œåˆ†æ”¯ä¸‹çš„å†…å®¹æ¨é€åˆ°è¿œç¨‹</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæ‰§è¡Œ git push â€“set-upstream origin blogSource å‘½ä»¤ä¹‹åï¼Œä»¥åä¿®æ”¹åšå®¢æºæ–‡ä»¶ä»£ç ä¹‹åï¼Œç›´æ¥ä½¿ç”¨ git push ä¸ç”¨å†æŒ‡å®šåˆ†æ”¯ï¼Œå°±å¯ä»¥æŠŠä»£ç  push åˆ° blogSource åˆ†æ”¯ä¸Šäº†</p>
<h4 id="æ›´æ¢åœ°ç‚¹ä½¿ç”¨-repo-åˆ†æ”¯ä¸Šçš„åšå®¢æºæ–‡ä»¶"><a href="#æ›´æ¢åœ°ç‚¹ä½¿ç”¨-repo-åˆ†æ”¯ä¸Šçš„åšå®¢æºæ–‡ä»¶" class="headerlink" title="æ›´æ¢åœ°ç‚¹ä½¿ç”¨ repo åˆ†æ”¯ä¸Šçš„åšå®¢æºæ–‡ä»¶"></a>æ›´æ¢åœ°ç‚¹ä½¿ç”¨ repo åˆ†æ”¯ä¸Šçš„åšå®¢æºæ–‡ä»¶</h4><p>æ¢ä¸€å°ç”µè„‘ï¼Œé…ç½®å¥½ Hexo çš„ç¯å¢ƒï¼Œ<a href="https://xiaovv.me/2017/04/06/GitHub%E9%85%8D%E7%BD%AESSH-key/" target="_blank" rel="noopener external nofollow noreferrer">é…ç½® Git SSH key</a>ï¼ŒæŠŠåšå®¢æºæ–‡ä»¶ä»£ç å…‹éš†ä¸‹æ¥:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone xxxxxxxxx.xx (ä½ çš„ github page çš„ repo åœ°å€)</span><br></pre></td></tr></table></figure>

<p>åšå®¢æºæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ä¹‹åï¼Œé»˜è®¤çš„åˆ†æ”¯æ˜¯ masterï¼Œéœ€è¦åˆ‡æ¢åˆ° blogSource åˆ†æ”¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout origin&#x2F;blogSource</span><br></pre></td></tr></table></figure>

<p>ç„¶åcdåˆ°åšå®¢ç›®å½•ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo</span><br><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹æ„‰å¿«çš„å†™åšå®¢äº†ï¼Œå†™å®Œä¹‹åè®°å¾—æŠŠæºæ–‡ä»¶ä»£ç  push åˆ° Github ä¸Šï¼Œç„¶åç”¨ Hexo éƒ¨ç½²åˆ°è‡ªå·±åšå®¢ä¸Šé¢</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo + NexTä¸»é¢˜åšå®¢ç›¸å…³è®¾ç½®</title>
    <url>/2020/03/21/Hexo-NexT%E4%B8%BB%E9%A2%98%E5%8D%9A%E5%AE%A2%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<h4 id="ä¸€ã€æ·»åŠ æ–‡ç« ç‰ˆæƒå£°æ˜åŠŸèƒ½"><a href="#ä¸€ã€æ·»åŠ æ–‡ç« ç‰ˆæƒå£°æ˜åŠŸèƒ½" class="headerlink" title="ä¸€ã€æ·»åŠ æ–‡ç« ç‰ˆæƒå£°æ˜åŠŸèƒ½"></a>ä¸€ã€æ·»åŠ æ–‡ç« ç‰ˆæƒå£°æ˜åŠŸèƒ½</h4><p>æ‰“å¼€åšå®¢ç›®å½•ä¸‹çš„ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼ˆ/themes/next/_config.ymlï¼‰ï¼Œæ‰¾åˆ°Declare license on posts æ ‡ç­¾ï¼Œè¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Declare license on posts</span><br><span class="line">post_copyright:</span><br><span class="line">  enable: true    #æ¿€æ´»ç‰ˆæƒå£°æ˜æ¨¡å—</span><br><span class="line">  license: CC BY-NC-SA 3.0     #ç‰ˆæƒè®¸å¯åè®®</span><br><span class="line">  license_url: https:&#x2F;&#x2F;winney07.github.io&#x2F;      #å£°æ˜çš„æ–‡ç« çš„å¯ç‚¹å‡»é“¾æ¥ï¼ˆåŸŸåï¼‰</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>é…ç½®å®Œåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼Œæ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://winney07.github.io/2018/08/02/Hexo-NexT%E4%B8%BB%E9%A2%98%E5%8D%9A%E5%AE%A2%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE/next-set1.png" alt></p>
<h4 id="äºŒã€è®¾ç½®faviconå›¾æ ‡"><a href="#äºŒã€è®¾ç½®faviconå›¾æ ‡" class="headerlink" title="äºŒã€è®¾ç½®faviconå›¾æ ‡"></a>äºŒã€è®¾ç½®faviconå›¾æ ‡</h4><p>1ã€é€‰æ‹©ä¸€ä¸ªfaviconåˆ¶ä½œç½‘ç«™å®Œæˆåˆ¶ä½œï¼Œä¾‹å¦‚ï¼šæ¯”ç‰¹è™« ï¼Œåˆ¶ä½œä¸€ä¸ª16*16ï¼Œä¸€ä¸ª32*32çš„ï¼›</p>
<p>2ã€ä¸¤ä¸ªä¸åŒå°ºå¯¸å¤§å°çš„æ–‡ä»¶ï¼Œé‡åä¸ºfavicon-16x16-next.pngå’Œfavicon-32x32-next.pngï¼›</p>
<p>3ã€å°†é‡å‘½åçš„ä¸¤ä¸ªå›¾ç‰‡æ–‡ä»¶æ”¾åˆ°åšå®¢ç›®å½•ä¸‹çš„themes/next/source/imagesä¸­ï¼ˆè¦†ç›–åŸæ¥çš„ä¸¤ä¸ªé»˜è®¤çš„ï¼‰<br>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://winney07.github.io/2018/08/02/Hexo-NexT%E4%B8%BB%E9%A2%98%E5%8D%9A%E5%AE%A2%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE/favicon.png" alt></p>
<h3 id="ä¸‰ã€æ·»åŠ å‹æƒ…é“¾æ¥"><a href="#ä¸‰ã€æ·»åŠ å‹æƒ…é“¾æ¥" class="headerlink" title="ä¸‰ã€æ·»åŠ å‹æƒ…é“¾æ¥"></a>ä¸‰ã€æ·»åŠ å‹æƒ…é“¾æ¥</h3><p>æ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼ˆ/themes/next/_config.ymlï¼‰ï¼Œæ‰¾åˆ°ä»¥ä¸‹å†…å®¹è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Blog rolls</span><br><span class="line">links_icon: link</span><br><span class="line">links_title: å‹æƒ…é“¾æ¥ </span><br><span class="line"># links_layout: block   &#x2F;&#x2F;å—çŠ¶æ˜¾ç¤ºï¼ˆé€‰æ‹©äº†è¡Œå†…æ˜¾ç¤ºï¼Œè¿™ä¸ªè¦æ³¨é‡Šæ‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼‰</span><br><span class="line">links_layout: inline    &#x2F;&#x2F;è¡Œå†…æ˜¾ç¤º</span><br><span class="line">links:</span><br><span class="line">  å°è¶…: https:&#x2F;&#x2F;www.xiaochao.me&#x2F;</span><br><span class="line">  Github: https:&#x2F;&#x2F;www.github.com</span><br></pre></td></tr></table></figure>

<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://winney07.github.io/2018/08/02/Hexo-NexT%E4%B8%BB%E9%A2%98%E5%8D%9A%E5%AE%A2%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE/friend-link.png" alt></p>
<h4 id="å››ã€è°ƒæ•´hexoé¡µé¢å®½åº¦"><a href="#å››ã€è°ƒæ•´hexoé¡µé¢å®½åº¦" class="headerlink" title="å››ã€è°ƒæ•´hexoé¡µé¢å®½åº¦"></a>å››ã€è°ƒæ•´hexoé¡µé¢å®½åº¦</h4><p>åšå®¢åœ¨æµè§ˆå™¨ä¸Šçš„ç•™ç™½å¤ªå¤šï¼Œå› æ­¤æƒ³å¢åŠ æ–‡ç« çš„å®½åº¦ã€‚</p>
<p>æ‰“å¼€/themes/next/source/css/_variables/custom.styl æ·»åŠ ä¸¤è¡Œä»£ç å³å¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$main-desktop &#x3D; 1200px </span><br><span class="line">$content-desktop &#x3D; 900px</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨Hexoåšå®¢ä¸­å‘å¸ƒæ–‡ç« </title>
    <url>/2020/03/21/%E5%9C%A8Hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0/</url>
    <content><![CDATA[<h4 id="1ã€æ–°å»ºä¸€ç¯‡æ–‡ç« "><a href="#1ã€æ–°å»ºä¸€ç¯‡æ–‡ç« " class="headerlink" title="1ã€æ–°å»ºä¸€ç¯‡æ–‡ç« "></a>1ã€æ–°å»ºä¸€ç¯‡æ–‡ç« </h4><p>ï¼ˆ1ï¼‰åœ¨hexoåšå®¢ç›®å½•ä¸‹ï¼Œè¿›å…¥Git Bashå‘½ä»¤çª—å£ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new &quot;åœ¨è¿™é‡Œ&quot;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰åœ¨åšå®¢ç›®å½•ä¸‹çš„/source/_posts/ æ–‡ä»¶å¤¹ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæˆäº†æ ‡é¢˜ä¸º(åœ¨è¿™é‡Œ.md)çš„åšå®¢æ–‡ä»¶ï¼š<br>å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://winney07.github.io/2018/08/02/%E5%9C%A8Hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0/zai.png" alt></p>
<a id="more"></a>
<p>ï¼ˆ3ï¼‰åœ¨ï¼ˆåœ¨è¿™é‡Œ.mdï¼‰æ–‡ä»¶ä¸­ç¼–è¾‘è‡ªå·±çš„åšå®¢æ–‡ç« å³å¯ã€‚<br>æ³¨æ„ï¼šHexo å‘å¸ƒçš„æ–‡ç« æ˜¯ Markdown æ ¼å¼çš„æ–‡ä»¶ï¼Œ Markdown åŸºæœ¬è¯­æ³•çš„ç½‘å€ï¼š<a href="https://www.jianshu.com/p/191d1e21f7ed" target="_blank" rel="noopener external nofollow noreferrer">ç‚¹è¿™é‡Œå‰å¾€</a></p>
<h4 id="2ã€ç»™æ–‡ç« æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾"><a href="#2ã€ç»™æ–‡ç« æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾" class="headerlink" title="2ã€ç»™æ–‡ç« æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾"></a>2ã€ç»™æ–‡ç« æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾</h4><p>(1) åœ¨ï¼ˆåœ¨è¿™é‡Œ.mdï¼‰æ–‡ä»¶ä¸­è®¾ç½®tagså’Œcategorieså±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">title: åœ¨è¿™é‡Œ</span><br><span class="line">date: 2018-08-02 11:41:10</span><br><span class="line">tags:</span><br><span class="line">- åšå®¢           &#x2F;&#x2F;å¤šä¸ªæ ‡ç­¾å¯ä»¥è¿™æ ·æ·»åŠ </span><br><span class="line">- hexo</span><br><span class="line">categories: test</span><br></pre></td></tr></table></figure>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://winney07.github.io/2018/08/02/%E5%9C%A8Hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0/zai-edit.png" alt></p>
<h4 id="3ã€å¯åŠ¨æœåŠ¡å™¨ï¼Œæœ¬åœ°æµ‹è¯•"><a href="#3ã€å¯åŠ¨æœåŠ¡å™¨ï¼Œæœ¬åœ°æµ‹è¯•" class="headerlink" title="3ã€å¯åŠ¨æœåŠ¡å™¨ï¼Œæœ¬åœ°æµ‹è¯•"></a>3ã€å¯åŠ¨æœåŠ¡å™¨ï¼Œæœ¬åœ°æµ‹è¯•</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<h4 id="4ã€æ·»åŠ â€œé˜…è¯»å…¨æ–‡â€æŒ‰é’®"><a href="#4ã€æ·»åŠ â€œé˜…è¯»å…¨æ–‡â€æŒ‰é’®" class="headerlink" title="4ã€æ·»åŠ â€œé˜…è¯»å…¨æ–‡â€æŒ‰é’®"></a>4ã€æ·»åŠ â€œé˜…è¯»å…¨æ–‡â€æŒ‰é’®</h4><p>æ–¹æ³•ä¸€ï¼šåœ¨æ–‡ç« ä»»æ„ä½ æƒ³æ·»åŠ çš„ä½ç½®æ·»åŠ å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!--more--&gt;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•äºŒï¼šè®¾ç½®é¦–é¡µæ–‡ç« ä»¥æ‘˜è¦å½¢å¼æ˜¾ç¤ºï¼Œæ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°auto_excerptè¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">auto_excerpt:</span><br><span class="line">  enable: true</span><br><span class="line">  length: 150</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­lengthä»£è¡¨æ˜¾ç¤ºæ‘˜è¦çš„æˆªå–å­—ç¬¦é•¿åº¦ã€‚</p>
<p>æ³¨ï¼šè¿™ä¸¤ç§æ–¹æ³•ï¼Œåœ¨åšå®¢é¦–é¡µæ˜¾ç¤ºçš„æ•ˆæœä¸ä¸€æ ·ï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ–¹æ³•</p>
<h4 id="5ã€åœ¨åšæ–‡ä¸­æ·»åŠ å›¾ç‰‡"><a href="#5ã€åœ¨åšæ–‡ä¸­æ·»åŠ å›¾ç‰‡" class="headerlink" title="5ã€åœ¨åšæ–‡ä¸­æ·»åŠ å›¾ç‰‡"></a>5ã€åœ¨åšæ–‡ä¸­æ·»åŠ å›¾ç‰‡</h4><p>æ–¹æ³•ä¸€ï¼š</p>
<p>(1)åœ¨blogç›®å½•ä¸‹ï¼Œå®‰è£…æ’ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure>
<p>(2)åœ¨blog\source ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªimagesæ–‡ä»¶å¤¹ï¼ŒæŠŠå›¾ç‰‡æ”¾ç½®åœ¨é‡Œé¢ï¼›</p>
<p>(3)åœ¨xxx.mdæ–‡ä»¶ä¸­å¼•ç”¨å›¾ç‰‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">![header]( images&#x2F;header.jpg)</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•äºŒï¼š</p>
<p>(1)åœ¨å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆblog/_config.yml)ä¸­å°†post_asset_folderè®¾ç½®ä¸ºtrueï¼›</p>
<p>(2)åˆ›å»ºæ–‡ç« ï¼ˆåœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šåœ¨blog/source/_postç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªXXX.mdæ–‡ä»¶å’Œä¸€ä¸ªXXXçš„æ–‡ä»¶å¤¹ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new &quot;XXX&quot;</span><br></pre></td></tr></table></figure>

<p>(3)æŠŠXXXè¿™ä¸ªåšæ–‡éœ€è¦å±•ç¤ºçš„å›¾ç‰‡æ”¾åœ¨XXXæ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼›</p>
<p>(4)åœ¨XXX.mdæ–‡ä»¶ä¸­å¼•å…¥å›¾ç‰‡çš„æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">![ä½ æƒ³è¾“å…¥çš„æ›¿ä»£æ–‡å­—](XXX&#x2F;å›¾ç‰‡å.jpg)</span><br></pre></td></tr></table></figure>
<h4 id="6ã€å‘å¸ƒåˆ°Githubä¸Š"><a href="#6ã€å‘å¸ƒåˆ°Githubä¸Š" class="headerlink" title="6ã€å‘å¸ƒåˆ°Githubä¸Š"></a>6ã€å‘å¸ƒåˆ°Githubä¸Š</h4><p>ï¼ˆ1ï¼‰å‘è¡¨çš„æ–‡ç« åœ¨æœ¬åœ°é¢„è§ˆæ— è¯¯åï¼Œåœ¨ Git Bash å‘½ä»¤çª—å£æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰åœ¨æµè§ˆå™¨ï¼Œè®¿é—®è‡ªå·±çš„åšå®¢åŸŸåï¼Œå³å¯çœ‹åˆ°åˆš å‘å¸ƒçš„æ–‡ç« </p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>å°†Hexoåšå®¢ä¸»é¢˜æ›´æ¢ä¸ºNexTä¸»é¢˜</title>
    <url>/2020/03/20/%E5%B0%86Hexo%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2%E4%B8%BANexT%E4%B8%BB%E9%A2%98/</url>
    <content><![CDATA[<p>1ã€æŠŠé»˜è®¤ä¸»é¢˜æ›´æ”¹æˆNextä¸»é¢˜ï¼Œåœ¨blogç›®å½•ä¸­ï¼ˆå°±æ˜¯å‘½ä»¤è¡Œçš„ä½ç½®å¤„äºblogç›®å½•ï¼‰æ‰“å¼€å‘½ä»¤è¡Œè¾“å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;iissnan&#x2F;hexo-theme-next themes&#x2F;next</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å°†Nextä¸»é¢˜ä¸‹è½½åˆ°blogç›®å½•çš„themesä¸»é¢˜ä¸‹çš„nextæ–‡ä»¶å¤¹ä¸­ã€‚æ‰“å¼€ç«™ç‚¹çš„_config.ymlé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä¸»é¢˜ä¸ºnext<br><img src="/2020/03/20/%E5%B0%86Hexo%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2%E4%B8%BANexT%E4%B8%BB%E9%A2%98/1.jpg" alt></p>
<a id="more"></a>
<p>æ‰“å¼€<strong>ä¸»é¢˜theme</strong>çš„_config.ymlé…ç½®æ–‡ä»¶ï¼Œä¸æ˜¯<strong>ç«™ç‚¹site</strong>ä¸»é¢˜æ–‡ä»¶ï¼Œæ‰¾åˆ°Scheme Settings<br><img src="/2020/03/20/%E5%B0%86Hexo%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2%E4%B8%BANexT%E4%B8%BB%E9%A2%98/2.jpg" alt><br>nextä¸»é¢˜æœ‰ä¸‰ä¸ªæ ·å¼ï¼Œæˆ‘ç”¨çš„æ˜¯Piscesï¼Œå¯ä»¥é€‰æ‹©ä½ è‡ªå·±å–œæ¬¢çš„æ ·å¼ï¼ˆåªéœ€è¦æŠŠè¡Œé¦–çš„#å»é™¤ï¼Œ#æ˜¯æ³¨é‡Šï¼‰ï¼Œé€‰æ‹©å¥½åï¼Œå†æ¬¡éƒ¨ç½²ç½‘ç«™ï¼Œhexo gã€hexo dï¼ŒæŸ¥çœ‹æ•ˆæœã€‚é€‰æ‹©å…¶ä»–ä¸»é¢˜ï¼ŒæŒ‰ç…§ä¸Šè¿°è¿‡ç¨‹å³å¯å®ç°ã€‚</p>
<p>2ã€åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.ymlä¸­é…ç½®åšå®¢ç½‘ç«™åº•éƒ¨çš„åŸºæœ¬ä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">footer:</span><br><span class="line">  # Specify the date when the site was setup.</span><br><span class="line">  # If not defined, current year will be used.</span><br><span class="line">  since: 2020      #ç½‘ç«™èµ·å§‹è¿è¥å¹´ä»½</span><br><span class="line"></span><br><span class="line">  # Icon between year and copyright info.</span><br><span class="line">  icon: user     #å£°æ˜å›¾æ ‡</span><br><span class="line"></span><br><span class="line">  # If not defined, will be used &#96;author&#96; from Hexo main config.</span><br><span class="line">  copyright: bryceustc   #ç‰ˆæƒæ‰€æœ‰</span><br><span class="line">  # ------------------------------------------------------------</span><br><span class="line">  # Hexo link (Powered by Hexo).</span><br><span class="line">  powered: true</span><br><span class="line"></span><br><span class="line">  theme:</span><br><span class="line">    # Theme &amp; scheme info link (Theme - NexT.scheme).</span><br><span class="line">    enable: false    #æ˜¯å¦æ˜¾ç¤ºä¸»é¢˜</span><br><span class="line">    # Version info of NexT after scheme info (vX.X.X).</span><br><span class="line">    version: false     #æ˜¯å¦æ˜¾ç¤ºé©±åŠ¨</span><br></pre></td></tr></table></figure>

<p>3ã€åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.ymlä¸­é…ç½®èœå•æŒ‰é’®ï¼Œæ‰¾åˆ°menuå±æ€§ï¼Œåšä»¥ä¸‹é…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">menu:</span><br><span class="line"> home: &#x2F; || home     #é¦–é¡µï¼Œåé¢çš„è¡¨ç¤ºå›¾æ ‡</span><br><span class="line"> categories: &#x2F;categories&#x2F; || th   #åˆ†ç±»</span><br><span class="line"> tags: &#x2F;tags&#x2F; || tags       #æ ‡ç­¾</span><br><span class="line"> archives: &#x2F;archives&#x2F; || archive     #å½’æ¡£</span><br><span class="line"> about: &#x2F;about&#x2F; || user       #å…³äº</span><br><span class="line"> #schedule: &#x2F;schedule&#x2F; || calendar</span><br><span class="line"> #sitemap: &#x2F;sitemap.xml || sitemap</span><br><span class="line"> #commonweal: &#x2F;404&#x2F; || heartbeat</span><br></pre></td></tr></table></figure>
<p>4ã€åˆ›å»ºç›¸åº”çš„é¡µé¢</p>
<p>ï¼ˆ1ï¼‰æ‰§è¡Œå‘½ä»¤hexo sï¼Œæœ¬åœ°é¢„è§ˆæˆ‘ä»¬çš„åšå®¢é¡µé¢ï¼Œä¼šå‘ç°ï¼Œç‚¹å‡»åˆ†ç±»ã€æ ‡ç­¾ã€å…³äºè¿™å‡ ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œä¼šæ˜¾ç¤º404ã€‚</p>
<p>ï¼ˆ2ï¼‰åœ¨Git Bashå‘½ä»¤çª—å£ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºç›¸åº”é¡µé¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new page &#39;categories&#39;</span><br><span class="line">hexo new page &#39;tags&#39;</span><br><span class="line">hexo new page &#39;about&#39;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ3ï¼‰å¯ä»¥åœ¨hexo/sourceç›®å½•ä¸‹çœ‹åˆ°åˆ›å»ºçš„3ä¸ªæ–‡ä»¶å¤¹<br><img src="https://winney07.github.io/2018/08/01/%E5%B0%86Hexo%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2%E4%B8%BANexT%E4%B8%BB%E9%A2%98/source.png" alt></p>
<p>5ã€æ¯ä¸€ä¸ªåˆ†ç±»èœå•éƒ½ç”Ÿæˆäº†ä¸€ä¸ª index.md åˆå§‹æ–‡ä»¶ï¼ˆåœ¨åˆšåˆ›å»ºçš„æ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼‰ï¼Œé»˜è®¤åŒ…å«äº† title å’Œ date å­—æ®µï¼Œæˆ‘ä»¬éœ€è¦ç»™æ¯ä¸€ index.md æ–‡ä»¶æ·»åŠ ä¸Š type å­—æ®µ<br>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: categories</span><br><span class="line">date: 2020-3-20 16:28:33</span><br><span class="line">type: categories</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: tags</span><br><span class="line">date: 2020-3-20 16:28:33</span><br><span class="line">type: tags</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: about</span><br><span class="line">date: 2020-3-20 16:28:33</span><br><span class="line">type: about</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>6ã€é…ç½®æœç´¢èœå•ï¼š<br>ï¼ˆ1ï¼‰å®‰è£… hexo-generator-searchdb ï¼Œåœ¨ Git Bash å‘½ä»¤çª—å£ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æ‰“å¼€å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆhexo/_config.ymlï¼‰ï¼Œæ–°å¢ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰æ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼ˆhexo/themes/next/_config.ymlï¼‰ï¼Œæ‰¾åˆ° local_search å±æ€§ï¼Œå¼€å¯æœ¬åœ°æœç´¢åŠŸèƒ½ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">local_search:</span><br><span class="line">  enable: true</span><br><span class="line">  # if auto, trigger search by changing input</span><br><span class="line">  # if manual, trigger search by pressing enter key or search button</span><br><span class="line">  trigger: auto</span><br><span class="line">  # show top n results per article, show all results by setting to -1</span><br><span class="line">  top_n_per_article: 1</span><br></pre></td></tr></table></figure>
<p>7ã€æ‰§è¡Œå‘½ä»¤hexo sï¼Œæœ¬åœ°é¢„è§ˆæˆ‘ä»¬çš„åšå®¢é¡µé¢ï¼Œå‘ç°åˆšæ‰çš„é…ç½®å·²ç»å®Œæˆ</p>
<p>8ã€åœ¨å‘½ä»¤çª—å£ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå°†ä¿®æ”¹åçš„æœ¬åœ°hexoé¡¹ç›®æ‰˜ç®¡åˆ°GitHubä¸Š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>

<p>9ã€ä¸Šä¼ æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡è‡ªå·±çš„åšå®¢åŸŸåè®¿é—®ä¿®æ”¹ä¸»é¢˜å’Œä¿®æ”¹ç›¸å…³é…ç½®åçš„åšå®¢é¡µé¢</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo + GitHub Pages æ­å»ºä¸ªäººåšå®¢</title>
    <url>/2020/03/19/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h3 id="ä¸€ã€å‡†å¤‡å·¥ä½œ"><a href="#ä¸€ã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="ä¸€ã€å‡†å¤‡å·¥ä½œ"></a>ä¸€ã€å‡†å¤‡å·¥ä½œ</h3><h4 id="1ã€å®‰è£…Node-js"><a href="#1ã€å®‰è£…Node-js" class="headerlink" title="1ã€å®‰è£…Node.js"></a>1ã€å®‰è£…Node.js</h4><p>(1) ä¸‹è½½Node.jsï¼š<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener external nofollow noreferrer">å®˜ç½‘ä¸‹è½½åœ°å€</a> ï¼ˆè¿™é‡Œä»¥Windows ä¸ºä¾‹ï¼‰;</p>
<p><img src="/images/node.png" alt></p>
<a id="more"></a>
<p>(2) åŒå‡»ä¸‹è½½å¥½çš„.msiæ–‡ä»¶ï¼ŒæŒ‰ä¸‹ä¸€æ­¥ä¸‹ä¸€æ­¥ï¼Œå®‰è£…å¥½å°±å¯ä»¥ï¼›</p>
<p>(3) åœ¨cmdå‘½ä»¤çª—å£ï¼Œè¾“å…¥ä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤ï¼Œå¦‚æœèƒ½å¤Ÿæ˜¾ç¤ºNode.jsçš„ç‰ˆæœ¬ï¼Œè¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
<p><img src="/images/node_v.png" alt></p>
<h4 id="2ã€å®‰è£…Git"><a href="#2ã€å®‰è£…Git" class="headerlink" title="2ã€å®‰è£…Git"></a>2ã€å®‰è£…Git</h4><p>(1) ä¸‹è½½Gitï¼š<a href="https://git-scm.com/downloads" target="_blank" rel="noopener external nofollow noreferrer">å®˜ç½‘ä¸‹è½½</a></p>
<p>(2) åŒå‡»ä¸‹è½½å¥½çš„Gitå®‰è£…åŒ…ï¼ŒæŒ‰ä¸‹ä¸€æ­¥ä¸‹ä¸€æ­¥ï¼Œè¿›è¡Œå®‰è£…å³å¯ï¼›</p>
<p>(3) åœ¨cmdå‘½ä»¤çª—å£ï¼Œè¾“å…¥ä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤ï¼Œå¦‚æœèƒ½å¤Ÿæ˜¾ç¤ºGitçš„ç‰ˆæœ¬ï¼Œè¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure>

<p><img src="/images/git_v.png" alt></p>
<h3 id="äºŒã€Hexoæ­å»ºåšå®¢"><a href="#äºŒã€Hexoæ­å»ºåšå®¢" class="headerlink" title="äºŒã€Hexoæ­å»ºåšå®¢"></a>äºŒã€Hexoæ­å»ºåšå®¢</h3><h4 id="1ã€å®‰è£…Hexo"><a href="#1ã€å®‰è£…Hexo" class="headerlink" title="1ã€å®‰è£…Hexo"></a>1ã€å®‰è£…Hexo</h4><p>ï¼ˆ1ï¼‰åœ¨è®¡ç®—æœºä¸­ï¼Œæ–°å»ºä¸€ä¸ªBlogæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾è‡ªå·±çš„åšå®¢å†…å®¹ã€‚</p>
<p>ï¼ˆ2ï¼‰åœ¨Blogæ–‡ä»¶å¤¹å†…ï¼Œé¼ æ ‡å³é”®ï¼Œé€‰æ‹©Git Bash,è¿›å…¥åˆ°å‘½ä»¤çª—å£</p>
<p><img src="/images/blog.png" alt></p>
<p>ï¼ˆ3ï¼‰åœ¨å‘½ä»¤çª—å£ä¸­ï¼Œè¾“å…¥ä¸‹é¢ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<h4 id="2ã€åˆå§‹åŒ–Hexo"><a href="#2ã€åˆå§‹åŒ–Hexo" class="headerlink" title="2ã€åˆå§‹åŒ–Hexo"></a>2ã€åˆå§‹åŒ–Hexo</h4><p>åœ¨å‘½ä»¤çª—å£ä¸­ï¼Œè¾“å…¥ä¸‹é¢ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>

<h4 id="3ã€é…ç½®Hexo"><a href="#3ã€é…ç½®Hexo" class="headerlink" title="3ã€é…ç½®Hexo"></a>3ã€é…ç½®Hexo</h4><p>(1) å®‰è£…ä¾èµ–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>(2) éƒ¨ç½²å½¢æˆçš„æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g &#x2F;&#x2F;æˆ–è€… hexo generate</span><br></pre></td></tr></table></figure>

<h4 id="4ã€å¯åŠ¨æœåŠ¡å™¨"><a href="#4ã€å¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="4ã€å¯åŠ¨æœåŠ¡å™¨"></a>4ã€å¯åŠ¨æœåŠ¡å™¨</h4><p>(1) åœ¨å‘½ä»¤çª—å£æ‰§è¡Œä¸‹é¢ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo s  &#x2F;&#x2F;æˆ–è€… hexo server</span><br></pre></td></tr></table></figure>

<p>(2) åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥<a href="http://localhost:4000/" target="_blank" rel="noopener external nofollow noreferrer">http://localhost:4000/</a> ï¼ˆé»˜è®¤ç«¯å£æ˜¯4000ï¼‰ï¼Œå¦‚æœèƒ½å¤Ÿçœ‹åˆ°å¦‚å›¾æ‰€ç¤ºçš„æ•ˆæœï¼Œè¯´æ˜åˆå§‹åŒ–çš„Hexoåšå®¢æ­å»ºæˆåŠŸäº†ã€‚<br>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/hexo-blog.png" alt></p>
<h4 id="ä¸‰ã€å°†æœ¬åœ°çš„-Hexo-åšå®¢éƒ¨ç½²åˆ°-GitHub-Pagesä¸Š"><a href="#ä¸‰ã€å°†æœ¬åœ°çš„-Hexo-åšå®¢éƒ¨ç½²åˆ°-GitHub-Pagesä¸Š" class="headerlink" title="ä¸‰ã€å°†æœ¬åœ°çš„ Hexo åšå®¢éƒ¨ç½²åˆ° GitHub Pagesä¸Š"></a>ä¸‰ã€å°†æœ¬åœ°çš„ Hexo åšå®¢éƒ¨ç½²åˆ° GitHub Pagesä¸Š</h4><p>ï¼ˆ1ï¼‰æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œä»“åº“åä¸ºbryceustc.github.ioï¼ˆè¿™ä¸ªä»“åº“çš„åç§°å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ username.github.io çš„æ ¼å¼æ¥å‘½åï¼‰ã€å‰ææ˜¯ä½ è¦æœ‰ä¸€ä¸ªGithubè´¦å·ã€‘<br>å¦‚å›¾æ‰€ç¤ºï¼šï¼ˆå› ä¸ºæˆ‘å·²ç»åˆ›å»ºè¿‡è¿™ä¸ªåº“äº†ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºçº¢è‰²è­¦å‘Šï¼Œåªæ˜¯åæ¥ä¸ºäº†æˆªå›¾ï¼Œé‡æ–°å†™ä¸€ä¸ªåŒåçš„ï¼‰</p>
<p><img src="/images/github.png" alt></p>
<p>ï¼ˆ2ï¼‰è¿›å…¥å·²ç»åˆ›å»ºå¥½çš„ä»“åº“ï¼ˆç‚¹å‡»è‡ªå·±çš„å¤´åƒï¼Œé€‰æ‹©Your profileï¼Œç‚¹å‡»åˆšåˆ›å»ºå¥½çš„é‚£ä¸ªä»“åº“è¿›å»ä»“åº“é‡Œé¢ï¼‰ï¼Œç‚¹å‡»settingsï¼Œæ‰¾åˆ°GitHub Pages é€‰é¡¹ï¼Œç‚¹å‡» Choose a theme é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼ˆå¯ä»¥é€‰æ‹©ä¹Ÿå¯ä»¥ä¸é€‰æ‹©ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚å†³å®šæ˜¯å¦æ“ä½œè¿™ä¸€æ­¥ï¼‰<br>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/images/gitpages.png" alt></p>
<p>ï¼ˆ3ï¼‰é…ç½®Gitä¸ªäººä¿¡æ¯ï¼Œåœ¨winneyBlogç›®å½•ä¸‹ï¼Œé¼ æ ‡å³é”®ï¼Œé€‰æ‹©Git Bashï¼Œè¿›å…¥å‘½ä»¤çª—å£ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;Githubç”¨æˆ·å&quot;       &#x2F;&#x2F;è‡ªå·±Githubçš„è´¦å·å</span><br><span class="line">git config --global user.email &quot;Githubé‚®ç®±&quot;        &#x2F;&#x2F;è‡ªå·±æ³¨å†ŒGithubçš„é‚®ç®±åœ°å€</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰ç”ŸæˆSSH KEY,æ„æ€æ˜¯ç”Ÿæˆä¸€ä¸ªå…¬é’¥å’Œå¯†é’¥ï¼Œå› ä¸ºGithubéœ€è¦ä¸€ä¸ªå¯†é’¥æ‰èƒ½ä¸æœ¬åœ°ç›¸è¿æ¥ã€‚åœ¨å‘½ä»¤çª—å£è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œç„¶åéœ€è¦è¿ç»­æŒ‰3æ¬¡å›è½¦ç”Ÿæˆå¯†é’¥ï¼ˆæ¯æŒ‰ä¸€æ¬¡å›è½¦ä½ å¯ä»¥çœ‹åˆ°å¯¹åº”çš„ä¿¡æ¯ï¼‰ ã€ä½ ä¹Ÿå¯ä»¥å…ˆæŸ¥çœ‹æ˜¯å¦å·²ç»æœ‰äº†sshå¯†é’¥ï¼šcd ~/.ssh å¦‚æœæ²¡æœ‰å¯†é’¥åˆ™ä¸ä¼šæœ‰æ­¤æ–‡ä»¶å¤¹ï¼Œæœ‰åˆ™å¤‡ä»½åˆ é™¤ã€‘</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C  &quot;Githubé‚®ç®±&quot;        &#x2F;&#x2F;è‡ªå·±æ³¨å†ŒGithubçš„é‚®ç®±åœ°å€</span><br></pre></td></tr></table></figure>

<p>å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ssh-key.png" alt></p>
<p>ï¼ˆ5ï¼‰ç”Ÿæˆçš„SSH KEYä¼šä¿å­˜åˆ° C:/Users/ç”µè„‘åç”¨æˆ·å/.ssh ç›®å½•ä¸­ï¼ˆæ ¹æ®ä½ è‡ªå·±ç”µè„‘ç”¨æˆ·åï¼Œæ‰“å¼€å¯¹åº”çš„ç›®å½•ï¼‰</p>
<ul>
<li>æ‰“å¼€.ssh è¿™ä¸ªç›®å½•ï¼Œæ‰“å¼€ id_rsa.pub æ–‡ä»¶ï¼Œå¤åˆ¶é‡Œé¢çš„å…¨éƒ¨å†…å®¹ï¼ˆè¿™äº›å†…å®¹å°±æ˜¯å¯†é’¥ï¼‰<br><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/user-ssh.png" alt></li>
</ul>
<p>ï¼ˆ6ï¼‰åœ¨GitHubä¸­æ·»åŠ SSH keys</p>
<ul>
<li><p>æ‰“å¼€Githubï¼Œç‚¹å‡»å¤´åƒï¼Œé€‰æ‹©Settingsï¼›</p>
</li>
<li><p>é€‰æ‹©SSH and GPG keysé¡¹,ç‚¹å‡»å³ä¸Šè§’New SSH keyæŒ‰é’®ï¼Œå°†åˆšåˆšå¤åˆ¶åˆ°çš„å¯†é’¥ç²˜è´´åˆ°keyè¾“å…¥æ¡†ä¸­ï¼Œtitleè‡ªå·±ç»™å®ƒå‘½ä¸€ä¸ªåå°±å¥½<br><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/add-key.png" alt></p>
</li>
<li><p>æœ€åç‚¹å‡»Add Keyï¼Œå¦‚æœæ˜¾ç¤ºè¿™æ ·çš„ç•Œé¢ï¼Œè¯´æ˜SSH KEY é…ç½®æˆåŠŸï¼š<br><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ssh-keys.png" alt></p>
</li>
</ul>
<p>ï¼ˆ7ï¼‰ä¿®æ”¹å…¨å±€é…ç½®æ–‡ä»¶</p>
<ul>
<li><p>åœ¨blogæ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰¾åˆ°_config.ymlæ–‡ä»¶ï¼›å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/deploy.png" alt></p>
</li>
<li><p>å¤åˆ¶ä»“åº“åœ°å€ï¼šå¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/git-href.png" alt></p>
</li>
<li><p>ä¿®æ”¹_config.ymlæ–‡ä»¶é‡Œçš„deployå±æ€§(ç›®çš„æ˜¯å°†æœ¬åœ°hexoé¡¹ç›®æ”¾åˆ°Githubä¸Š)å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/deploy.png" alt></p>
</li>
</ul>
<p><strong>æ³¨ï¼š</strong>ã€å¦‚æœrepositoryä¸­å¡«å†™çš„æ˜¯httpsåè®®çš„ï¼Œhexo dä¸Šä¼ ä»£ç åˆ°Githubæ—¶æœ‰ä¸‹é¢ç±»ä¼¼é”™è¯¯ï¼Œå¯ä»¥å°†repositoryæ”¹ä¸ºsshçš„é“¾æ¥ã€‘<br>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/deploy-error.png" alt></p>
<p><img src="https://winney07.github.io/2018/08/01/Hexo-GitHub-Pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ssh-link.png" alt></p>
<p>ï¼ˆ8ï¼‰å®‰è£…hexo-deployer-git æ’ä»¶ï¼Œç›®çš„æ˜¯å°†ä»£ç å¿«é€Ÿæ‰˜ç®¡åˆ°Githubä¸Š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ9ï¼‰å°†hexoé¡¹ç›®æ‰˜ç®¡åˆ°GitHubä¸Šï¼ˆå‘½ä»¤å¯ä»¥åˆ†å¼€å†™ä¹Ÿå¯ä»¥ä¸€èµ·å†™ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>

<p>å¤‡æ³¨:<br>hexo clean // æ¸…é™¤ç¼“å­˜æ–‡ä»¶ (db.json) å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ (public)</p>
<p>hexo generate // éƒ¨ç½²ä¹‹å‰é¢„å…ˆç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œç®€å†™ä¸ºhexo g</p>
<p>hexo deploy // æ–‡ä»¶ç”Ÿæˆåç«‹å³éƒ¨ç½²ç½‘ç«™ï¼Œç®€å†™ä¸ºhexo d</p>
<p>ï¼ˆ10ï¼‰åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <a href="https://username.github.io/" target="_blank" rel="noopener external nofollow noreferrer">https://username.github.io/</a> å³å¯è®¿é—®ï¼Œï¼ˆusernameä¹Ÿå°±æ˜¯ä½ çš„Githubè´¦æˆ·åï¼‰ï¼Œå¦‚æœèƒ½å¤Ÿæ­£å¸¸è®¿é—®ï¼Œå¹¶ä¸”è·Ÿæœ¬åœ°hexoé¡¹ç›®æ˜¾ç¤ºçš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆè¯´æ˜ä½ å·²ç»æŠŠæœ¬åœ°hexoé¡¹ç›®éƒ¨ç½²åˆ°Githubä¸Šäº†ã€‚</p>
<h4 id="å››ã€é…ç½®åšå®¢çš„ä¸ªäººä¿¡æ¯"><a href="#å››ã€é…ç½®åšå®¢çš„ä¸ªäººä¿¡æ¯" class="headerlink" title="å››ã€é…ç½®åšå®¢çš„ä¸ªäººä¿¡æ¯"></a>å››ã€é…ç½®åšå®¢çš„ä¸ªäººä¿¡æ¯</h4><p>ï¼ˆ1ï¼‰åœ¨hexoç›®å½•ä¸­ï¼Œæ‰¾åˆ°å…¨å±€é…ç½®æ–‡ä»¶_config.yml</p>
<p>ï¼ˆ2ï¼‰é…ç½®ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Hexo Configuration</span><br><span class="line">## Docs: https:&#x2F;&#x2F;hexo.io&#x2F;docs&#x2F;configuration.html</span><br><span class="line">## Source: https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexo&#x2F;</span><br><span class="line"></span><br><span class="line"># Site</span><br><span class="line">title: Bryce&#39;s Blog</span><br><span class="line">subtitle: Learn Everything.</span><br><span class="line">description: A Student From USTC.</span><br><span class="line">author: Bryce</span><br><span class="line">language: zh-Hans</span><br><span class="line">timezone: Asia&#x2F;Shanghai</span><br><span class="line"></span><br><span class="line"># URL åšå®¢åœ°å€</span><br><span class="line">## If your site is put in a subdirectory, set url as &#39;http:&#x2F;&#x2F;yoursite.com&#x2F;child&#39; and root as &#39;&#x2F;child&#x2F;&#39;</span><br><span class="line">url: https:&#x2F;&#x2F;bryceustc.github.io&#x2F;</span><br><span class="line">root: &#x2F;</span><br><span class="line">permalink: :year&#x2F;:month&#x2F;:day&#x2F;:title&#x2F;</span><br><span class="line">permalink_defaults:</span><br><span class="line">pretty_urls:</span><br><span class="line">  trailing_index: true # Set to false to remove trailing &#39;index.html&#39; from permalinks</span><br><span class="line">  trailing_html: true # Set to false to remove trailing &#39;.html&#39; from permalinks</span><br><span class="line"></span><br><span class="line"># Directory ç›®å½•è®¾ç½®</span><br><span class="line">source_dir: source</span><br><span class="line">public_dir: public</span><br><span class="line">tag_dir: tags</span><br><span class="line">archive_dir: archives</span><br><span class="line">category_dir: categories</span><br><span class="line">code_dir: downloads&#x2F;code</span><br><span class="line">i18n_dir: :lang</span><br><span class="line">skip_render:</span><br><span class="line"></span><br><span class="line"># Writing</span><br><span class="line">new_post_name: :title.md # File name of new posts</span><br><span class="line">default_layout: post</span><br><span class="line">titlecase: false # Transform title into titlecase</span><br><span class="line">external_link:</span><br><span class="line">  enable: true # Open external links in new tab</span><br><span class="line">  field: site # Apply to the whole site</span><br><span class="line">  exclude: &#39;&#39;</span><br><span class="line">filename_case: 0</span><br><span class="line">render_drafts: false</span><br><span class="line">post_asset_folder: true</span><br><span class="line">relative_link: false</span><br><span class="line">future: true</span><br><span class="line">highlight:</span><br><span class="line">  enable: true</span><br><span class="line">  line_number: true</span><br><span class="line">  auto_detect: false</span><br><span class="line">  tab_replace: &#39;&#39;</span><br><span class="line">  wrap: true</span><br><span class="line">  hljs: false</span><br><span class="line"></span><br><span class="line"># Home page setting</span><br><span class="line"># path: Root path for your blogs index page. (default &#x3D; &#39;&#39;)</span><br><span class="line"># per_page: Posts displayed per page. (0 &#x3D; disable pagination)</span><br><span class="line"># order_by: Posts order. (Order by date descending by default)</span><br><span class="line">index_generator:</span><br><span class="line">  path: &#39;&#39;</span><br><span class="line">  per_page: 5 #æ¯é¡µæ–‡ç« æ•°é‡</span><br><span class="line">  order_by: -date</span><br><span class="line"></span><br><span class="line"># Category &amp; Tag</span><br><span class="line">default_category: uncategorized</span><br><span class="line">category_map:</span><br><span class="line">tag_map:</span><br><span class="line"></span><br><span class="line"># Metadata elements</span><br><span class="line">## https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;HTML&#x2F;Element&#x2F;meta</span><br><span class="line">meta_generator: true</span><br><span class="line"></span><br><span class="line"># Date &#x2F; Time format</span><br><span class="line">## Hexo uses Moment.js to parse and display date</span><br><span class="line">## You can customize the date format as defined in</span><br><span class="line">## http:&#x2F;&#x2F;momentjs.com&#x2F;docs&#x2F;#&#x2F;displaying&#x2F;format&#x2F;</span><br><span class="line">date_format: YYYY-MM-DD</span><br><span class="line">time_format: HH:mm:ss</span><br><span class="line">## Use post&#39;s date for updated date unless set in front-matter</span><br><span class="line">use_date_for_updated: false</span><br><span class="line"></span><br><span class="line"># Pagination</span><br><span class="line">## Set per_page to 0 to disable pagination</span><br><span class="line">per_page: 10</span><br><span class="line">pagination_dir: page</span><br><span class="line"></span><br><span class="line"># Include &#x2F; Exclude file(s)</span><br><span class="line">## include:&#x2F;exclude: options only apply to the &#39;source&#x2F;&#39; folder</span><br><span class="line">include:</span><br><span class="line">exclude:</span><br><span class="line">ignore:</span><br><span class="line"></span><br><span class="line"># Extensions</span><br><span class="line">## Plugins: https:&#x2F;&#x2F;hexo.io&#x2F;plugins&#x2F;</span><br><span class="line">## Themes: https:&#x2F;&#x2F;hexo.io&#x2F;themes&#x2F;</span><br><span class="line">theme: next</span><br><span class="line">plugins: hexo-generate-feed</span><br><span class="line"></span><br><span class="line"># Deployment</span><br><span class="line">## Docs: https:&#x2F;&#x2F;hexo.io&#x2F;docs&#x2F;deployment.html</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: https:&#x2F;&#x2F;github.com&#x2F;bryceustc&#x2F;bryceustc.github.io</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š.yml æ–‡ä»¶æœ‰ä¸¥æ ¼çš„æ ¼å¼è¦æ±‚ï¼Œæ–‡ä»¶é‡Œæ‰€æœ‰çš„é…ç½®éƒ½æ˜¯ï¼šå†’å· ç©ºæ ¼ å€¼ï¼Œå¹¶ä¸”å†’å·æ˜¯è‹±æ–‡çŠ¶æ€ä¸‹çš„è¾“å…¥ã€‚æƒ³äº†è§£æ›´å¤šçš„å¯ä»¥å‰å¾€å®˜ç½‘ã€‚</p>
<p>ï¼ˆ3ï¼‰åœ¨åšå®¢ç›®å½•ä¸‹ï¼Œå³é”®ç‚¹å‡»Git Bashï¼Œè¿›å»å‘½ä»¤çª—å£ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå³å¯åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°åˆšåˆšè®¾ç½®çš„å†…å®¹æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo server    &#x2F;&#x2F;ç®€å†™ä¸ºhexo s</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°ç»„ä¸­é‡å¤çš„æ•°å­—</title>
    <url>/2020/03/18/3_%E6%95%B0%E7%BB%84%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97/</url>
    <content><![CDATA[<h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>åœ¨ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨0~n-1èŒƒå›´å†…ã€‚æ•°ç»„ä¸­æŸäº›æ•°å­—æ˜¯é‡å¤çš„ï¼Œä½†ä¸çŸ¥é“æœ‰å‡ ä¸ªæ•°å­—é‡å¤äº†ï¼Œä¹Ÿä¸çŸ¥é“æ¯ä¸ªæ•°å­—é‡å¤äº†å‡ æ¬¡ã€‚è¯·æ‰¾å‡ºæ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªé‡å¤çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥é•¿åº¦ä¸º7çš„æ•°ç»„{2ï¼Œ3ï¼Œ1ï¼Œ0ï¼Œ2ï¼Œ5ï¼Œ3}ï¼Œé‚£ä¹ˆå¯¹åº”çš„è¾“å‡ºæ˜¯é‡å¤çš„æ•°å­—2æˆ–è€…3</p>
<a id="more"></a>

<p>åœ¨ä¸€ä¸ªé•¿åº¦ä¸ºn+1çš„æ•°ç»„é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨1~nèŒƒå›´å†…ã€‚æ‰€ä»¥æ•°ç»„ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ•°æ˜¯é‡å¤çš„ã€‚è¯·æ‰¾å‡ºæ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªé‡å¤çš„æ•°å­—ï¼Œä½†ä¸èƒ½ä¿®æ”¹è¾“å…¥çš„æ•°ç»„ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥é•¿åº¦ä¸º8çš„æ•°ç»„{2ï¼Œ3ï¼Œ5ï¼Œ4ï¼Œ3ï¼Œ2ï¼Œ6ï¼Œ7}ï¼Œé‚£ä¹ˆå¯¹åº”çš„è¾“å‡ºæ˜¯é‡å¤çš„æ•°å­—2æˆ–è€…3ã€‚</p>
<h2 id="æœ¬é¢˜è€ƒç‚¹"><a href="#æœ¬é¢˜è€ƒç‚¹" class="headerlink" title="æœ¬é¢˜è€ƒç‚¹"></a>æœ¬é¢˜è€ƒç‚¹</h2><p>  1). ä¸€ç»´æ•°ç»„çš„ç†è§£ï¼Œä¸€ç»´æ•°ç»„åœ¨å†…å­˜ä¸­å æ®è¿ç»­ç©ºé—´ï¼Œå¯ä»¥æ ¹æ®ä¸‹æ ‡å®šä½å¯¹åº”çš„å…ƒç´ </p>
<p>  2). äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„ç†è§£ï¼Œå¿«é€Ÿæ­£ç¡®å®ç°äºŒåˆ†æŸ¥æ‰¾</p>
<p>  3). æ—¶é—´å¤æ‚åº¦ä¸ç©ºé—´å¤æ‚åº¦çš„ç†è§£</p>
<h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>  1). æŠŠè¾“å…¥çš„æ•°ç»„è¿›è¡Œæ’åºï¼Œæ’åºåå†åˆ¤æ–­æœ‰æ— é‡å¤æ•°å­—ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)</p>
<p>  2). ä½¿ç”¨å“ˆå¸Œè¡¨æ¥è§£å†³ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œä½†ç©ºé—´å¤æ‚åº¦ä¹Ÿä¸ºO(n)</p>
<p>  3). äº¤æ¢ä½ç½®é‡æ’æ³•ï¼ŒæŠŠæ¯ä¸ªæ•°å­—æ”¾å›å¯¹åº”ä½ç½®çš„æ–¹æ³•ã€‚å¦‚æœå‡ºç°ä¸€ä¸ªæ•°å­—æ— æ³•æ”¾å›ï¼ˆæ‰€åœ¨ä½ç½®å·²ç»æ˜¯å¯¹åº”æ•°å­—äº†ï¼‰ï¼Œé‚£ä¹ˆè¯´æ˜è¯¥æ•°å­—é‡å¤ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1)</p>
<p>  4). é¢˜ç›®äºŒå¯ä»¥ä¾ç…§é¢˜ç›®ä¸€çš„æ€è·¯æ¥ï¼Œä¸è¿‡ç”±äºä¸èƒ½ä¿®æ”¹è¾“å…¥æ•°ç»„ï¼Œæ‰€ä»¥å¯ä»¥æ„å»ºä¸€ä¸ªn+1å¤§å°çš„è¾…åŠ©æ•°ç»„ï¼Œæ„å»ºäº†è¾…åŠ©æ•°ç»„ä¹‹åå¯ä»¥ä½¿ç”¨hashè¡¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ¢ä½ç½®çš„æ€è·¯æ¥åš </p>
<p>  5). ä½¿ç”¨äºŒåˆ†çš„æ€æƒ³æ¥åšï¼ŒäºŒåˆ†åŸºæ•°ç»„ï¼Œä½†è¿™ç§æ–¹æ³•ä¸èƒ½æ‰¾å‡ºæ‰€æœ‰é‡å¤çš„æ•°å­—ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1)ï¼Œç›¸å½“äºç”¨æ—¶é—´æ¢å–ç©ºé—´</p>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><h4 id="æ–¹æ³•ä¸€ï¼šæ’åºåç›´æ¥æŸ¥æ‰¾"><a href="#æ–¹æ³•ä¸€ï¼šæ’åºåç›´æ¥æŸ¥æ‰¾" class="headerlink" title="æ–¹æ³•ä¸€ï¼šæ’åºåç›´æ¥æŸ¥æ‰¾"></a>æ–¹æ³•ä¸€ï¼šæ’åºåç›´æ¥æŸ¥æ‰¾</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">Duplication</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums,<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;res)</span></span>&#123;</span><br><span class="line">            <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums.empty()||n&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] &lt; <span class="number">0</span> || nums[i] &gt; n - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sort(nums.<span class="built_in">begin</span>(),nums.<span class="built_in">end</span>());</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i]==nums[i+<span class="number">1</span>])</span><br><span class="line">                &#123;</span><br><span class="line">                    res.push_back(nums[i]);</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> flag;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ³•äºŒï¼šåˆ©ç”¨å“ˆå¸Œè¡¨"><a href="#æ–¹æ³•äºŒï¼šåˆ©ç”¨å“ˆå¸Œè¡¨" class="headerlink" title="æ–¹æ³•äºŒï¼šåˆ©ç”¨å“ˆå¸Œè¡¨"></a>æ–¹æ³•äºŒï¼šåˆ©ç”¨å“ˆå¸Œè¡¨</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">Duplication</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums,<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;res)</span></span>&#123;</span><br><span class="line">            <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span>(nums.empty() || n &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] &lt; <span class="number">0</span> || nums[i] &gt; n<span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; m;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> i : nums)</span><br><span class="line">            &#123;</span><br><span class="line">                m[i]++;</span><br><span class="line">                <span class="keyword">if</span>(m[i]&gt;<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    res.push_back(i);</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> flag;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ³•ä¸‰ï¼šäº¤æ¢ä½ç½®é‡æ’"><a href="#æ–¹æ³•ä¸‰ï¼šäº¤æ¢ä½ç½®é‡æ’" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šäº¤æ¢ä½ç½®é‡æ’"></a>æ–¹æ³•ä¸‰ï¼šäº¤æ¢ä½ç½®é‡æ’</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">Duplication</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;nums,<span class="keyword">int</span> n,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;res)</span></span>&#123;</span><br><span class="line">            <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">//å¼‚å¸¸å€¼æ£€æµ‹</span></span><br><span class="line">            <span class="keyword">if</span> (nums.empty() || n &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è¶Šç•Œæ£€æµ‹</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; n; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i]&lt; <span class="number">0</span> || nums[i] &gt; n<span class="number">-1</span>) </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//åªè¦å½“å‰æ•°å€¼ä¸ç´¢å¼•ä¸ç­‰ï¼Œå°±è¦ä¸€ç›´æ›¿æ¢</span></span><br><span class="line">                <span class="keyword">while</span> (nums[i]!=i)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//ä¸€æ—¦é‡åˆ°å½“å‰çš„æ•°å€¼ä¸å¦å¤–ä¸€ä¸ªæ¢ä½çš„å€¼ç›¸ç­‰ï¼Œå°±åœæ­¢ï¼Œè¯´æ˜æ‰¾åˆ°äº†é‡å¤çš„æ•°å­—</span></span><br><span class="line">                    <span class="keyword">if</span> (nums[i] == nums[nums[i]])</span><br><span class="line">                    &#123;</span><br><span class="line">                        res.push_back(nums[i]);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        flag = <span class="literal">true</span>;  <span class="comment">//returnç›´æ¥è·³å‡ºæ‰€æœ‰å¾ªç¯</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">int</span> temp = nums[i];</span><br><span class="line">                    nums[i] = nums[temp];</span><br><span class="line">                    nums[temp] = temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> flag;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ³•å››ï¼šäºŒåˆ†æ³•æŸ¥æ‰¾"><a href="#æ–¹æ³•å››ï¼šäºŒåˆ†æ³•æŸ¥æ‰¾" class="headerlink" title="æ–¹æ³•å››ï¼šäºŒåˆ†æ³•æŸ¥æ‰¾"></a>æ–¹æ³•å››ï¼šäºŒåˆ†æ³•æŸ¥æ‰¾</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getDuplication</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums, <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">      <span class="keyword">if</span> ( nums.empty() || n &lt;=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">int</span> start = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">int</span> <span class="built_in">end</span> = n;</span><br><span class="line">      <span class="keyword">while</span>(<span class="built_in">end</span> &gt; start)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> mid = start + (<span class="built_in">end</span>-start)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n+<span class="number">1</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]&gt;=start &amp;&amp; nums[i]&lt;=mid)</span><br><span class="line">            &#123;</span><br><span class="line">              m++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (m &gt; mid - start+<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="built_in">end</span> = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">           start = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><p><a href="https://blog.csdn.net/hunanchenxingyu/article/details/8101795" target="_blank" rel="noopener external nofollow noreferrer">å¾ªç¯ç»“æ„ä¸­breakã€continueã€returnå’Œexitçš„åŒºåˆ«</a></p>
</li>
<li><p><a href="https://blog.csdn.net/zolalad/article/details/11848739" target="_blank" rel="noopener external nofollow noreferrer">æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦</a></p>
</li>
<li><p><a href="https://github.com/bryceustc/LeetCode_Note/blob/master/cpp/Find-First-And-Last-Position-Of-Element-In-Sorted-Array/BinarySearch.md" target="_blank" rel="noopener external nofollow noreferrer">äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
</search>
